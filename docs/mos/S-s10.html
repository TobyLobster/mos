<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 10: Resets</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><span class="unlink"><b>$D940</b>: chapter 10</span></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 10: Resets' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 10: Resets</b></li></ul></div>
<p class="purpose">OSBYTE 142; Default vector table; Default MOS variables table; Reset entry point - 732 bytes (4.4%)</p>

<ul class="toc"><li><a href="S-s10.html#SP1">&#167;1. Default vector table</a></li><li><a href="S-s10.html#SP2">&#167;2. MOS Variables Default Values</a></li><li><a href="S-s10.html#SP3">&#167;3. Reset entry point</a></li><li><a href="S-s10.html#SP4">&#167;4. clearRAM</a></li><li><a href="S-s10.html#SP5">&#167;5. setUpSystemVIA</a></li><li><a href="S-s10.html#SP6">&#167;6. Read the keyboard 8 times with internal key numbers 9-1</a></li><li><a href="S-s10.html#SP7">&#167;7. Initialise keyboard lights, Work out what variables to reset</a></li><li><a href="S-s10.html#SP8">&#167;8. Reset OS Variables</a></li><li><a href="S-s10.html#SP9">&#167;9. Copy the default vectors and MOS variables</a></li><li><a href="S-s10.html#SP10">&#167;10. Put a SPACE in the first key pressed variable</a></li><li><a href="S-s10.html#SP11">&#167;11. Set system and user VIA registers</a></li><li><a href="S-s10.html#SP12">&#167;12. Check for initialising JIM device</a></li><li><a href="S-s10.html#SP13">&#167;13. Enable interrupts</a></li><li><a href="S-s10.html#SP14">&#167;14. Clear all sounds; Initialise the Serial ULA; Reset soft key definitions</a></li><li><a href="S-s10.html#SP15">&#167;15. Read ROM Types</a></li><li><a href="S-s10.html#SP16">&#167;16. Check for speech system</a></li><li><a href="S-s10.html#SP17">&#167;17. Initialise screen, execute any BOOT interception code</a></li><li><a href="S-s10.html#SP18">&#167;18. Initialise Tube</a></li><li><a href="S-s10.html#SP19">&#167;19. Initialize ROMs, claim memory from OSHWM</a></li><li><a href="S-s10.html#SP20">&#167;20. Show bootup message</a></li><li><a href="S-s10.html#SP21">&#167;21. Execute user BREAK intercept, set keyboard LEDs</a></li><li><a href="S-s10.html#SP22">&#167;22. Get !BOOT options, and ask ROMs to handle it</a></li><li><a href="S-s10.html#SP23">&#167;23. Select the *ROM filing system</a></li><li><a href="S-s10.html#SP24">&#167;24. Execute !BOOT</a></li><li><a href="S-s10.html#SP25">&#167;25. Select TAPE filing system</a></li><li><a href="S-s10.html#SP26">&#167;26. Look for language ROM</a></li><li><a href="S-s10.html#SP27">&#167;27. No language ROM present, so check for second processor</a></li><li><a href="S-s10.html#SP28">&#167;28. brkNoLanguageError</a></li><li><a href="S-s10.html#SP29">&#167;29. resetAndEnterLanguageROM</a></li><li><a href="S-s10.html#SP30">&#167;30. OSBYTE 142 - Enter language ROM (at $8000)</a></li><li><a href="S-s10.html#SP31">&#167;31. tubeCopyLanguageROMToSecondProcessorLocal</a></li><li><a href="S-s10.html#SP32">&#167;32. Read a byte from a given ROM</a></li><li><a href="S-s10.html#SP33">&#167;33. Select ROM</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Default vector table. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Default handlers for vectors, used at RESET time.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">defaultVectorTable</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">defaultVectorTable</span></span>:<br/><a href="S-s10.html#SP7">&#167;7</a>, <a href="S-s10.html#SP9">&#167;9</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d940</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">    value                     name           address      address label</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">USERV          $0200-1      .vectorUSERV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP3" class="function-link"><span class="ACME-function-syntax">brkHandler</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">BRKV           $0202-3      .vectorBRKV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP6" class="function-link"><span class="ACME-function-syntax">irq1Handler</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">IRQ1V          $0204-5      .vectorIRQ1V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP20" class="function-link"><span class="ACME-function-syntax">irq2Handler</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">IRQ2V          $0206-7      .vectorIRQ2V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP5" class="function-link"><span class="ACME-function-syntax">oscliEntryPoint</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">CLIV           $0208-9      .vectorCLIV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP21" class="function-link"><span class="ACME-function-syntax">osbyteEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">BYTEV          $020A-B      .vectorBYTEV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP26" class="function-link"><span class="ACME-function-syntax">oswordEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">WORDV          $020C-D      .vectorWORDV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s13.html#SP1" class="function-link"><span class="ACME-function-syntax">oswrchEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">WRCHV          $020E-F      .vectorWRCHV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP2" class="function-link"><span class="ACME-function-syntax">osrdchEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">RDCHV          $0210-1      .vectorRDCHV</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">defaultFileSystemVectors</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">defaultFileSystemVectors</span></span>:<br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d952</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP17" class="function-link"><span class="ACME-function-syntax">osfileEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">FILEV          $0212-3      .vectorFILEV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP6" class="function-link"><span class="ACME-function-syntax">osargsEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">ARGSV          $0214-5      .vectorARGSV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">osbgetEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">BGETV          $0216-7      .vectorBGETV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP35" class="function-link"><span class="ACME-function-syntax">osbputEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">BPUTV          $0218-9      .vectorBPUTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">GBPBV          $021A-B      .vectorGBPBV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP28" class="function-link"><span class="ACME-function-syntax">osfindEntryPoint</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">FINDV          $021C-D      .vectorFINDV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP8" class="function-link"><span class="ACME-function-syntax">fscEntryPoint</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">FSCV           $021E-F      .vectorFSCV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">EVNTV          $0220-1      .vectorEVNTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">UPTV           $0222-3      .vectorUPTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">NETV           $0224-5      .vectorNETV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">VDUV           $0226-7      .vectorVDUV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP3" class="function-link"><span class="ACME-function-syntax">keyEntryPoint</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">KEYV           $0228-9      .vectorKEYV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP28" class="function-link"><span class="ACME-function-syntax">insEntryPoint</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">INSBV          $022A-B      .vectorINSV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP24" class="function-link"><span class="ACME-function-syntax">remEntryPoint</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">REMVB          $022C-D      .vectorREMV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s13.html#SP11" class="function-link"><span class="ACME-function-syntax">cnpEntryPoint</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">CNPV           $022E-F      .vectorCNPV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">IND1V          $0230-1      .vectorIND1V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">IND2V          $0232-3      .vectorIND2V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">return</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">IND3V          $0234-5      .vectorIND3V</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">defaultVectorTableEnd</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">defaultVectorTableEnd</span></span>:<br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d976</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. MOS Variables Default Values. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Read/written by OSBYTEs 166-252</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">mosVariablesMinus166</span></a><span class="ACME-plain-syntax">   </span><span class="ACME-comment-syntax">MOS variables address (add OSBYTE number)     $0236-7</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 166/7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP24" class="function-link"><span class="ACME-function-syntax">extendedVectorSpace</span></a><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Address of ROM pointer table                  $0238-9</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 168/9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">romTypeTable</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">ROM information table address                 $023A-B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 170/1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP14" class="function-link"><span class="ACME-function-syntax">keyDataTable1</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">16</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Key translation table address                 $023C-D</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 172/3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">VDU variables start                           $023E-F</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 174/5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">vertical sync counter                         $0240</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 176</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">current input buffer number                   $0241</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 177</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">keyboard interrupt enable flag ($FF=enabled)  $0242</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 178</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">primary OSHWM (default PAGE)                  $0243</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 179</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">current OSHWM (PAGE)                          $0244</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 180</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">RS-423 Mode                                   $0245</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 181</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">character definition explosion state          $0246</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 182</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Filing system flag ROM=2; tape=0              $0247</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 183</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">current Video ULA control register            $0248</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 184</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">current palette setting                       $0249</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 185</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">number of ROM enabled at last BRK             $024A</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 186</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">number of BASIC ROM                           $024B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 187</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">4</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">current ADC channel number                    $024C</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 188</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">4</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">maximum ADC channel number                    $024D</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 189</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">ADC conversion type: 0 or $0C=12 bit; 8=8 Bit $024E</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 190</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">RS-423 busy flag (bit 7 clear=busy)           $024F</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 191</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$56</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">curent ACIA control register setting          $0250</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 192</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$19</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">flash counter                                 $0251</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 193</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$19</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">mark period count                             $0252</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 194</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$19</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">space period count                            $0253</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 195</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">50</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">keyboard Auto-repeat delay                    $0254</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 196</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">8</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">keyboard Auto-repeat rate                     $0255</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 197</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">*EXEC file handle  (0 -not allocated)         $0256</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 198</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">*SPOOL file handle (0 -not allocated)         $0257</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 199</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">bit 0 Escape enable/disable                   $0258</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 200</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">bit 1 BREAK normal/clear memory</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Econet disable keyboard flag                  $0259</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 201</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%00100000</span><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">keyboard status    bit 3=1 SHIFT pressed      $025A</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 202</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">                   bit 4=0 CAPS LOCK</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">                   bit 5=0 SHIFT LOCK</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">                   bit 6=1 CTRL pressed</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">                   bit 7=1 SHIFT enabled</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">9</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">buffer space left at buffer full signal       $025B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 203</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">RS-423 input suppression flag                 $025C</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 204</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">cassette/RS-423 flag (0=tape, $40=RS-423)     $025D</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 205</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Econet OS call interception flag (bit 7)      $025E</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 206</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Econet OSRDCH interception flag (bit 7)       $025F</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 207</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Econet OSWRCH interception flag (bit 7)       $0260</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 208</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$50</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">speech enable/disable flag ($50/$20)          $0261</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 209</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">sound output disable flag                     $0262</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 210</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">3</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">BELL channel number                           $0263</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 211</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$90</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">BELL amplitude (or envelope number)           $0264</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 212</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">100</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">BELL pitch (approx Treble C, 523.013Hz)       $0265</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 213</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">6</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">BELL duration (in 20ths of a second)          $0266</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 214</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$81</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">bit 7=0 ignore start up message               $0267</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 215</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">bit 0=1 lock up if !BOOT error from *disc* and no language</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">set</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">length of KEY string                          $0268</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 216</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">PRINT line counter                            $0269</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 217</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">2s compliment of number of items in VDU queue $026A</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 218</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">9</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">TAB key value                                 $026B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 219</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$1B</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">ESCAPE Character                              $026C</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 220</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">The following four bytes are how characters are interpreted when placed into an input</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">buffer</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">C0-CF                                         $026D</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 221</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$D0</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">D0-DF                                         $026E</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 222</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$E0</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">E0-EF                                         $026F</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 223</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$F0</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">F0-FF                                         $0270</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 224</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">The next four bytes are the key status (soft key or codes) for:</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">           function key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     SHIFT-function key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">      CTRL-function key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">CTRL-SHIFT-function key</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">0 means ignore key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">1 means expand as the normal soft key number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">2-$FF means expand as the normal soft key number + this value</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">80-8F                                         $0271</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 225</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">90-9F                                         $0272</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 226</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$90</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">A0-AF                                         $0273</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 227</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">B0-BF                                         $0274</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 228</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">ESCAPE key status (0=ESC, 1=ASCII)            $0275</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 229</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">ESCAPE action                                 $0276</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 230</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">allBitsSet</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">allBitsSet</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP16">&#167;16</a><br/>Chapter 14: Star commands - <a href="S-s14.html#SP10">&#167;10</a>, <a href="S-s14.html#SP22">&#167;22</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP18">&#167;18</a>, <a href="S-s15.html#SP24">&#167;24</a>, <a href="S-s15.html#SP63">&#167;63</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP6">&#167;6</a>, <a href="S-s17.html#SP20">&#167;20</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9b7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">User VIA 6522 Bit IRQ mask                    $0277</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 231</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">ACIA 6850 Bit IRQ bit mask                    $0278</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 232</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">System VIA 6522 IRQ bit mask                  $0279</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 233</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">Tube presence flag                            $027A</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 234</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">speech processor presence flag                $027B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 235</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">character destination status                  $027C</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 236</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">cursor editing state                          $027D</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 237</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">softResetHWM</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">softResetHWM</span></span>:<br/><a href="S-s10.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9be</span>
<span class="ACME-comment-syntax">************************* SOFT reset high water mark **********************************</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">unused                                        $027E</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 238</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">unused                                        $027F</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 239</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">country code (0=UK,1=US)                      $0280</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 240</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">user flag                                     $0281</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 241</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$64</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">serial ULA control register setting           $0282</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 242</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$05</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">current system clock store pointer            $0283</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 243</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">soft key status (inconsistent)                $0284</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 244</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">printer destination (parallel printer)        $0285</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 245</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">10</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">printer ignore character (line feed)          $0286</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 246</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">hardResetHWM</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">hardResetHWM</span></span>:<br/><a href="S-s10.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9c7</span>
<span class="ACME-comment-syntax">************************* HARD reset high water mark **********************************</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">user BREAK routine address JMP                $0287</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 247</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">user BREAK routine address low                $0288</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 248</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">user BREAK routine address high               $0289</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 249</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">unused                                        $028A</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 250</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">unused                                        $028B</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 251</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">current language ROM number                   $028C</span>
<span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">*FX 252</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">powerOnResetHWM</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">powerOnResetHWM</span></span>:<br/><a href="S-s10.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9cd</span>
<span class="ACME-comment-syntax">********************** RESET High Water mark for Power on *****************************</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Reset entry point. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Called on:</span>
<span class="ACME-plain-syntax">       * Power on</span>
<span class="ACME-plain-syntax">       * when a HARD BREAK occurs      (CTRL BREAK keys)</span>
<span class="ACME-plain-syntax">       * when a SOFT BREAK occurs      (BREAK key)</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       On power on: 6522 System VIA IER bits 0 to 6 will all be clear</span>
<span class="ACME-plain-syntax">       On BREAK   : 6522 System VIA IER bits 0 to 6 at least one bit will be set</span>

<span class="ACME-plain-syntax"> This code runs through a list of steps:</span>

<span class="ACME-plain-syntax">     * Store an RTI instruction at $0D00 (to stop executing any more NMI routines)</span>
<span class="ACME-plain-syntax">     * Disable interrupts (stop executing any more IRQs)</span>
<span class="ACME-plain-syntax">     * Clear decimal flag (decimal mode is never used within the OS. IRQ interrupts turn</span>
<span class="ACME-plain-syntax">       it off while they run. Decimal mode must be off before calling any OS routine)</span>
<span class="ACME-plain-syntax">     * Reset the stack pointer</span>
<span class="ACME-plain-syntax">     * Clear RAM if needed (also detect amount of RAM present, either 16k or 32k, and</span>
<span class="ACME-plain-syntax">       record this)</span>
<span class="ACME-plain-syntax">     * Initialise System VIA registers</span>
<span class="ACME-plain-syntax">     * Read keyboard</span>
<span class="ACME-plain-syntax">     * Initialise OS vectors and variables ($0200 upwards, amount depending on type of</span>
<span class="ACME-plain-syntax">       reset)</span>
<span class="ACME-plain-syntax">     * Initialise JIM (which gives access to an optional 64k or more of Paged Memory)</span>
<span class="ACME-plain-syntax">     * Enable some interrupts</span>
<span class="ACME-plain-syntax">     * Clear sounds</span>
<span class="ACME-plain-syntax">     * Initialise ROMs</span>
<span class="ACME-plain-syntax">     * Initialise speech system if present</span>
<span class="ACME-plain-syntax">     * Clear the screen</span>
<span class="ACME-plain-syntax">     * Insert F10 key code into keyboard buffer if needed (implements effect of *KEY 10)</span>
<span class="ACME-plain-syntax">     * Execute user boot code if present</span>
<span class="ACME-plain-syntax">     * Set cassette options</span>
<span class="ACME-plain-syntax">     * Initialise Tube</span>
<span class="ACME-plain-syntax">     * Initialise ROMs (post Tube initialisation)</span>
<span class="ACME-plain-syntax">     * Show 'BBC Computer 32K' message (or "16K", or no memory number on a SOFT BREAK)</span>
<span class="ACME-plain-syntax">     * Initialise keyboard LEDs</span>
<span class="ACME-plain-syntax">     * Select Filing System ROM</span>
<span class="ACME-plain-syntax">     * Execute !BOOT if needed</span>
<span class="ACME-plain-syntax">     * Find best language to enter, and enter it</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">resetEntryPoint</span></span>:<br/>Chapter 22: Credits - <a href="S-s22.html#SP1">&#167;1</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9cd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$40</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">the numerical value of the RTI opcode</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP24" class="function-link"><span class="ACME-function-syntax">nmiEntryPoint</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store RTI instruction at the start</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of the NMI routine</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts just in case</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLD</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear decimal flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">reset stack to where it should be</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXS</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">($01FF)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">read interupt enable register of the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">system VIA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">shift bit 7 (reading IER always</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">returns 1 in bit 7) into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save what's left (for use later when</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">setting page 2: just before</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.setUpPage2)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP4" class="function-link"><span class="ACME-function-syntax">clearRAM</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if (power on) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">escapeAndBreakEffect</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">read BREAK Action flags (set by</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">*FX200,n)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">divide by 2 to get the break action</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #1                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP5" class="function-link"><span class="ACME-function-syntax">setUpSystemVIA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (break action says we don't need</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to clear RAM) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set A=0 (since A=1 at this point)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. clearRAM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Clears all of RAM except the first byte in each Page. This avoids overwriting the RTI instruction at $0D00.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">clearRAM</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">clearRAM</span></span>:<br/><a href="S-s10.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d9e7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">start clearing memory from page 4</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">($0400)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">store a non-zero number at $01</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">store A (currently zero) at $00</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">and set Y (loop counter) to zero</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (</span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">clear RAM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">check high byte of address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (zero) then branch:</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">This happens when we clear byte $4001 on a 16k machine the RAM memory addressing loops</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">it around to write a zero into $0001. We are done at this point and branch out to avoid</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">overwriting the rest of zero page.</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not zero) then branch (loop back)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment again (Y=1) this avoids</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">overwriting RTI instruction at $D00</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">increment high byte of address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">loop until A=$80 then exit</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">systemAvailableRAM</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">writes marker for available RAM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">($40=16k; $80=32k)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyConsistencyFlag</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">write non-zero value in soft key</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">consistency flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. setUpSystemVIA. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setUpSystemVIA</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">setUpSystemVIA</span></span>:<br/><a href="S-s10.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $da03</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00001111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set System VIA PORT B to output on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bits 0-3; input on bits 4-7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP12" class="function-link"><span class="ACME-function-syntax">systemVIADataDirectionRegisterB</span></a><span class="ACME-plain-syntax">                </span>

<span class="ACME-comment-syntax">The next loop writes 14, 13, 12, 11, 10, 9, 8 in turn to System VIA Register B which:</span>
<span class="ACME-comment-syntax">      - turns CAPS LOCK off;</span>
<span class="ACME-comment-syntax">      - sets the hardware scroll address to $3000;</span>
<span class="ACME-comment-syntax">      - enables keyboard auto scanning;</span>
<span class="ACME-comment-syntax">      - enable read/write speech;</span>
<span class="ACME-comment-syntax">      - disable sound;</span>

<span class="ACME-comment-syntax">(See .</span><a href="S-s3.html#SP10" class="internal">systemVIARegisterB</a><span class="ACME-comment-syntax">)</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">write system VIA register B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #9                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (X&gt;=9) then branch (loop back and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">do it again)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Read the keyboard 8 times with internal key numbers 9-1. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This reads the state of the CTRL key and the 'keyboard links', a set of DIP switches next</span>
<span class="ACME-plain-syntax"> to the keyboard. See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a><span class="ACME-plain-syntax"> for internal key numbers.</span>

<span class="ACME-plain-syntax"> These are rotated into the 8 bits of .interruptAccumulator for further processing</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=9 (loop counter)</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Start of loop to interrogate keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">with A = 9...1 which reads keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">links 9-2 and CTRL key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">set carry if the 'key' or 'link' is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'pressed' or 'set'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">interruptAccumulator</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">rotate carry into MSB into bit 7 of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.interruptAccumulator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back value of X for loop</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not zero) then branch (do loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">again)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">At this point Carry(C) and .interruptAccumulator holds:</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">C = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">0 = } screen MODE on startup</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">1 = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">2 = if clear reverse SHIFT BREAK action</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">3 = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">4 = } set disc drive timings</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">5 = not used</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">6 = not used</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">7 = CTRL key</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastResetType</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">set last reset type = 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">interruptAccumulator</span></a><span class="ACME-plain-syntax">                           </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">At this point .interruptAccumulator holds keyboard links:</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">0 = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">1 = } screen MODE on startup</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">2 = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">3 = if clear reverse SHIFT BREAK action</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">4 = }</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">5 = } set disc drive timings</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">6 = not used</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">7 = not used</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">C = CTRL key</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Initialise keyboard lights, Work out what variables to reset. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP2" class="function-link"><span class="ACME-function-syntax">keyboardIndicators</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">set LEDs. carry flag (CTRL key) is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">put into bit zero of A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put bit zero of A (CTRL key) into</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">carry flag</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">set up page 2 based on reset type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softResetLWM</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">X = low water mark for setting OS</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">variables (writes to range $200+X -&gt;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$2FF)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">powerOnResetHWM</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP1" class="function-link"><span class="ACME-function-syntax">defaultVectorTable</span></a><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">Y = high water mark for writing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">default values into OS variables</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(writes to range $200+Y -&gt; $0200)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A (which is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.systemVIAInterruptEnableRegister</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">shifted left once)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (A=0) then branch (power on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">reset, with X=$9C Y=$8D)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">softResetHWM</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP1" class="function-link"><span class="ACME-function-syntax">defaultVectorTable</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">set value for soft reset HWM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP8" class="function-link"><span class="ACME-function-syntax">setUpPage2</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">if (soft reset) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">hardResetHWM</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP1" class="function-link"><span class="ACME-function-syntax">defaultVectorTable</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">hard reset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastResetType</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">reset type=1</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastResetType</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">'power on' or hard reset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">interruptAccumulator</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get keyboard links set</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%11111111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">invert all bits</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startUpOptions</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">and record as start up options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">hardResetLWM</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Reset OS Variables. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       .lastResetType is reset type:</span>

<span class="ACME-plain-syntax">        0    Soft reset    X=&lt;.softResetLWM    Y=.softResetHWM    - .defaultVectorTable</span>
<span class="ACME-plain-syntax">        1    Power on      X=&lt;.hardResetLWM    Y=.powerOnResetHWM - .defaultVectorTable</span>
<span class="ACME-plain-syntax">        2    Hard reset    X=&lt;.hardResetLWM    Y=.hardResetHWM    - .defaultVectorTable</span>

<span class="ACME-plain-syntax">   - Set variables at $200+X and up to zero or 255</span>
<span class="ACME-plain-syntax">   - Copy default values for variables into $0200+Y-1 and below from .defaultVectorTable</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setUpPage2</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">setUpPage2</span></span>:<br/><a href="S-s10.html#SP3">&#167;3</a>, <a href="S-s10.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $da42</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$CE</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">this loop writes zero into the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">addresses in range $0290/C to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$02CD...</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">... and writes 255 into addresses in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">range $02CE to $02FF</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">page2Start</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">At this point A=$FF and X=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP21" class="function-link"><span class="ACME-function-syntax">userVIADataDirectionRegisterA</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">set port A of user VIA to all</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">outputs (printer out)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$E2</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} this loop stores zero in zero-page</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} memory locations $E2 to $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Copy the default vectors and MOS variables. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Y is the loop counter (set up above, depending on boot type).</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP1" class="function-link"><span class="ACME-function-syntax">defaultVectorTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">read data from default table+Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">page2Start</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">write data to $0200+Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">branch back</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. Put a SPACE in the first key pressed variable. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP3" class="function-link"><span class="ACME-function-syntax">internalKeyNumberSPACEBAR</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">} store SPACE in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} .firstKeyPressedInternal</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP3" class="function-link"><span class="ACME-function-syntax">setupACIA</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set up ACIA</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">X=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. Set system and user VIA registers. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$7F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">Disable interrupts (top bit clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and all others set means disable all</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">interrupts)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=1</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP19" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptFlagRegister</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">Set</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.systemVIAInterruptEnableRegister</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and .systemVIAInterruptFlagRegister</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP23" class="function-link"><span class="ACME-function-syntax">userVIAInterruptFlagRegister</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">Set</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.userVIAInterruptEnableRegister and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax"> .userVIAInterruptFlagRegister</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X--</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">loop back if X &gt;= 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. Check for initialising JIM device. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">briefly allow interrupts to clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">anything pending</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">then disallow again (N.B. All VIA</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">IRQs are disabled)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">interruptAccumulator</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">check bit 6=1 (keyboard link 2)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (keyboard link 2 clear) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch over next instruction</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP17" class="function-link"><span class="ACME-function-syntax">jimPagedEntryJumper</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">This calls the JIM paged entry point</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(to initialise JIM based hardware)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. Enable interrupts. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Initialises System VIA registers to enable a default set of interrupts:</span>

<span class="ACME-plain-syntax">       The Vertical sync interrupt (50Hz)</span>
<span class="ACME-plain-syntax">       The Analogue to Digital Converter complete interrupt</span>
<span class="ACME-plain-syntax">       A timer interrupt for Speech</span>
<span class="ACME-plain-syntax">       The 100Hz timer</span>

<span class="ACME-plain-syntax"> Initialises the 100Hz timer to $270E = 9998 uS (close enough for most purposes to 100Hz)</span>
<span class="ACME-plain-syntax"> Initialises other devices to default settings (light pen strobe, printer, user port)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%11110010</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">enable some System VIA interrupts:</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">  1   Vertical sync</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  4   Analogue conversion finished</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  5   Timer 2 counter (for speech)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  6   Timer 1 counter (100Hz)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00000100</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set system VIA PCR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP18" class="function-link"><span class="ACME-function-syntax">systemVIAPeripheralControlRegister</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">set the PCR:</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CA1 has negative active edge       (vertical sync)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CA2 positive edges active on input (keyboard)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CB1 has negative active edge       (end of analogue conversion)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CB2 negative active edges on input (light pen strobe)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01100000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set system VIA ACR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP17" class="function-link"><span class="ACME-function-syntax">systemVIAAuxiliaryControlRegister</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">Disable latches and shift register</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(bits 0-4 = %00000)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">timer 2 countdown (for Speech)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with pulses on input pin PB6</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(bit 5 = %1)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">timer 1 free-run mode (100Hz timer)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with PB7 disabled</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(bit 6-7 = %01)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$0E</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">set system VIA Timer 1 counter (Low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP14" class="function-link"><span class="ACME-function-syntax">systemVIATimer1LatchLow</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">this becomes effective when Timer 1</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Counter High set</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP22" class="function-link"><span class="ACME-function-syntax">userVIAPeripheralControlRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">set user VIA PCR:</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CA1 interrupt on -ve edge     (usually printer Acknowledge)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CA2 high output               (usually printer strobe)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CB1 interrupt on -ve edge     (user port)</span>
<span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">CB2 negative edge             (user port)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP26" class="function-link"><span class="ACME-function-syntax">adcStartConversionRegister</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">Start analogue to digital conversion</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">A=%1110, meaning channel 2 of range</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">0-3,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">twelve bit conversion.</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP22" class="function-link"><span class="ACME-function-syntax">userVIAPeripheralControlRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">check user VIA PCR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (printer present) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">userVIAIRQBitMask</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">increment user VIA mask to 0 to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">ignore all user VIA interrupts</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$27</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">set Timer 1 (high byte) to $27.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">this sets Timer 1 to $270E (=9998 uS)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP14" class="function-link"><span class="ACME-function-syntax">systemVIATimer1LatchHigh</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">so interrupt occurs approximately</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">every 100th of a second</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP14" class="function-link"><span class="ACME-function-syntax">systemVIATimer1CounterHigh</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">set counter (high byte) which</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">actually starts the timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. Clear all sounds; Initialise the Serial ULA; Reset soft key definitions. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetClearAllSounds</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $daaa</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s16.html#SP7" class="function-link"><span class="ACME-function-syntax">clearSoundChannels</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">clear the sound channels</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Initialise the serial ULA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">serialULARegisterCopy</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">read serial ULA control register (OS</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">copy)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$7F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">zero bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP9" class="function-link"><span class="ACME-function-syntax">setSerialULADirectly</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">and set up serial ULA</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">reset function keys</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyConsistencyFlag</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get soft key status flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">selectROMLoop</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (keys OK) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP55" class="function-link"><span class="ACME-function-syntax">osbyte18EntryPoint</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">reset function keys</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. Read ROM Types. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Check each sideways ROM (aka Paged ROM) and make a catalogue of their types X = 0...15</span>

<span class="ACME-plain-syntax"> Note that the OS itself is not a Paged ROM. As originally shipped, BASIC is the only</span>
<span class="ACME-plain-syntax"> Paged ROM present. The OS supports 16 Paged ROMS (0-15). There are only five slots in</span>
<span class="ACME-plain-syntax"> the original machine, so extra hardware is required to support more Paged ROMs.</span>

<span class="ACME-plain-syntax"> ROM Header</span>
<span class="ACME-plain-syntax"> ----------</span>
<span class="ACME-plain-syntax"> $8000 = language entry point      (.romLanguageEntry)</span>
<span class="ACME-plain-syntax"> $8003 = service entry point       (.romServiceEntry)</span>
<span class="ACME-plain-syntax"> $8006 = ROM Type byte (see below) (.romTypeByte)</span>
<span class="ACME-plain-syntax"> $8007 = copyright message         (.romCopyrightOffsetPointer)</span>
<span class="ACME-plain-syntax"> $8009 = offset to title string    (.romTitleString)</span>

<span class="ACME-plain-syntax"> ROM Type Byte</span>
<span class="ACME-plain-syntax"> -------------</span>
<span class="ACME-plain-syntax"> bits 0-3  Processor Type (see below)</span>
<span class="ACME-plain-syntax"> bit 4     not used (Electron only)</span>
<span class="ACME-plain-syntax"> bit 5     Language ROM has a relocation address provided. The ROM can only run on the second</span>
<span class="ACME-plain-syntax">           processor when located at that address.</span>
<span class="ACME-plain-syntax"> bit 6     If set, this is a language ROM (and can be chosen on RESET). Otherwise this is</span>
<span class="ACME-plain-syntax">           a utility or Filing System ROM.</span>
<span class="ACME-plain-syntax"> bit 7     ROM has a service entry. All ROMs should have this bit set. (The BASIC ROM is the</span>
<span class="ACME-plain-syntax">           exception, it does not have this bit set).</span>

<span class="ACME-plain-syntax"> Processor Type</span>
<span class="ACME-plain-syntax"> --------------</span>
<span class="ACME-plain-syntax"> Language ROMs can be copied across to a second processor and run there. Processor codes</span>
<span class="ACME-plain-syntax"> have been assigned:</span>

<span class="ACME-plain-syntax">  0 = 6502 BASIC</span>
<span class="ACME-plain-syntax">  1 = 6502 Turbo code</span>
<span class="ACME-plain-syntax">  2 = 6502 machine code</span>
<span class="ACME-plain-syntax">  3 = 68000 code</span>
<span class="ACME-plain-syntax">  4 = -</span>
<span class="ACME-plain-syntax">  5 = -</span>
<span class="ACME-plain-syntax">  6 = -</span>
<span class="ACME-plain-syntax">  7 = PDP-11 code</span>
<span class="ACME-plain-syntax">  8 = Z80 code</span>
<span class="ACME-plain-syntax">  9 = 32016 code</span>
<span class="ACME-plain-syntax"> 10 = -</span>
<span class="ACME-plain-syntax"> 11 = 80186 code</span>
<span class="ACME-plain-syntax"> 12 = 80286 code</span>
<span class="ACME-plain-syntax"> 13 = ARM code</span>
<span class="ACME-plain-syntax"> 14 = -</span>
<span class="ACME-plain-syntax"> 15 = -</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">selectROMLoop</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">selectROMLoop</span></span>:<br/><a href="S-s10.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dabd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP33" class="function-link"><span class="ACME-function-syntax">selectROM</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">select ROM X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">set X to point to offset in table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romCopyrightOffsetPointer</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">get copyright offset from ROM</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romStartAddress</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get first byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP3" class="function-link"><span class="ACME-function-syntax">copyrightString</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">compare it with table byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">noCopyright</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (no copyright) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">point to next byte in ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">point to previous byte in ")C(",0</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (still +ve) then branch (go back</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to check next byte)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">this point is reached if 4 bytes</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">indicate valid ROM</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Check the first 1K of each ROM against higher priority ROMs to ensure that</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">there are no matches. If a match is found, ignore the lower priority ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get RAM copy of ROM number in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">and Y</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">nextROM</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dad5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment Y to check</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">check ROM number against 16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">romComparisonDone</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (ROM number is 16 or more) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (done checking each ROM,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">store catalogue byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put Y in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">invert it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">and store at .tempStoreFA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$7F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">} store $7F at .tempStoreFB to get</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} address $7FFF-Y</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">nextByteInROM</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dae3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the original ROM into the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">and compare with previous byte called</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">nextROM</span></a><span class="ACME-plain-syntax">                                        </span><span class="ACME-comment-syntax">if (not the same) then branch (go</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back and do it again with next ROM)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">increment .tempStoreFA to point to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">new location</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">nextByteInROM</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (.tempStoreFA is not zero) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (check next byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">increment tempStoreFB (high byte of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">load it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$84</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check if it has reached $84 = $80 +</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(4*256 bytes), i.e. 1k checked</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">nextByteInROM</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (not checked 1k yet) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(check next 256 bytes)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">noCopyright</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dafb</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">X=current ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (+ve) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">romComparisonDone</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $daff</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romTypeByte</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">get rom type byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">romTypeTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store it in catalogue</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$8F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check for BASIC</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not BASIC) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">basicROMNumber</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store X at BASIC pointer</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment X to point to next ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">check X against 16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP15" class="function-link"><span class="ACME-function-syntax">selectROMLoop</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (15 or less) then branch (back</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for next ROM)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. Check for speech system. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">check for speech system</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP17" class="function-link"><span class="ACME-function-syntax">skipSpeech</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">if (bit 7 set) then branch (no</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">speech system fitted)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">speechSystemPresentFlag</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">.speechSystemPresentFlag set to $FF</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to indicate speech present</span>

<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">Y=$FF (speech 'reset' command)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s16.html#SP24" class="function-link"><span class="ACME-function-syntax">osbyte159EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">initialise speech generator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">loop counter X from 16 to zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">branch back unless zero</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP15" class="function-link"><span class="ACME-function-syntax">systemVIATimer2CounterLow</span></a><span class="ACME-plain-syntax">                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP15" class="function-link"><span class="ACME-function-syntax">systemVIATimer2CounterHigh</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">clear Timer 2 to zero (used for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Speech)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. Initialise screen, execute any BOOT interception code. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipSpeech</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">skipSpeech</span></span>:<br/><a href="S-s10.html#SP16">&#167;16</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $db27</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startUpOptions</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">get back start up options (bits 0-2</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">are MODE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP2" class="function-link"><span class="ACME-function-syntax">initialiseScreenOnReset</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">then jump to screen initialisation</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">*KEY 10 facility (insert the *KEY 10 character code into the keyboard buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charKEY10</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP30" class="function-link"><span class="ACME-function-syntax">insertByteIntoKeyboardBuffer</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">} enter $CA in keyboard buffer. This</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} activates the *KEY 10 facility.</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">execute any user BOOT interception code, if present (with carry clear)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP68" class="function-link"><span class="ACME-function-syntax">osbyte247EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">call user boot routine if present,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with carry clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">it's called again later with carry</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">set</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP3" class="function-link"><span class="ACME-function-syntax">setupTapeOptions</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">set up cassette options [normally</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">at 300 baud, but if the user BOOT</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">interception code sets Z then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">1200 baud]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. Initialise Tube. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10000001</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">test for Tube to FIFO buffer 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP27" class="function-link"><span class="ACME-function-syntax">tubeULAStatusRegister</span></a><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP27" class="function-link"><span class="ACME-function-syntax">tubeULAStatusRegister</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">test for Tube presence</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put bit 0 into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (no Tube present) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallTubeMainInitialisation</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} initialise Tube system (issue ROM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} service call)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Tube not initialised) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tubePresentFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">set Tube flag to show it's active</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. Initialize ROMs, claim memory from OSHWM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Note that OSBYTE 143 issues the service call to all ROMs in turn (in slot order 15-0).</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s2.html#SP25" class="function-link"><span class="ACME-function-syntax">initialOSHWM</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">set default value of PAGE: $0E00</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallAbsoluteWorkspaceClaim</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">issue claim absolute workspace call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">via .osbyte143EntryPoint</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallPrivateWorkspaceClaim</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">send private workspace claim call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">via .osbyte143EntryPoint</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">defaultOSHWM</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">set primary OSHWM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">currentOSHWM</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">set current OSHWM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallTubeSystemPostInitialisation</span></a><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">send to the Tube with the 'post</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">initialisation' reason (e.g.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">second processor can decide to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">explode the character set etc.)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tubePresentFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">Y=$FF if Tube present else Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">and make call via</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.osbyte143EntryPoint</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. Show bootup message. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The startup message can only be suppressed if a ROM requests it on initialisation. Otherwise</span>
<span class="ACME-plain-syntax"> the .startupMessageSuppressionAndBootOptions variable was reset to its default value when</span>
<span class="ACME-plain-syntax"> resetting MOS variables above.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startupMessageSuppressionAndBootOptions</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">check (result of post-init AND bit 7</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of</span>
<span class="ACME-plain-syntax">                                                        </span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.startupMessageSuppressionAndBootOptions)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP21" class="function-link"><span class="ACME-function-syntax">skipStartupMessage</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (result clear) then branch (skip</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">startup message)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s4.html#SP3" class="function-link"><span class="ACME-function-syntax">bootMessage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP2" class="function-link"><span class="ACME-function-syntax">vduBaseAddress</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">             </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP22" class="function-link"><span class="ACME-function-syntax">displayString</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">output 'BBC Computer ' message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastResetType</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">0=soft reset, anything else continue</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP20" class="function-link"><span class="ACME-function-syntax">outputTwoNewlines</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (soft reset) then branch (skip</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">forward)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s4.html#SP3" class="function-link"><span class="ACME-function-syntax">bootMessageMemory32</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP2" class="function-link"><span class="ACME-function-syntax">vduBaseAddress</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">set to point to 32k message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">systemAvailableRAM</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">read available RAM ($40 = 16k</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$80 = 32k)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (32k RAM available) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s4.html#SP3" class="function-link"><span class="ACME-function-syntax">bootMessageMemory16</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP2" class="function-link"><span class="ACME-function-syntax">vduBaseAddress</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">set to point to 16K message</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP22" class="function-link"><span class="ACME-function-syntax">displayString</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">write message with '16K' or '32K'</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">outputTwoNewlines</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $db82</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s4.html#SP3" class="function-link"><span class="ACME-function-syntax">bootMessageEnding</span></a><span class="ACME-plain-syntax">  </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP2" class="function-link"><span class="ACME-function-syntax">vduBaseAddress</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">and two newlines</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP22" class="function-link"><span class="ACME-function-syntax">displayString</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. Execute user BREAK intercept, set keyboard LEDs. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipStartupMessage</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">skipStartupMessage</span></span>:<br/><a href="S-s10.html#SP20">&#167;20</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $db87</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP68" class="function-link"><span class="ACME-function-syntax">osbyte247EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">call user break intercept if present</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(with carry set)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP56" class="function-link"><span class="ACME-function-syntax">osbyte118EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">set up keyboard LEDs to reflect</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current keyboard status</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP22" class="paragraph-anchor"></a><b>&#167;22. Get !BOOT options, and ask ROMs to handle it. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Note that OSBYTE 143 issues the service call to all ROMs in turn (in slot order 15-0).</span>
<span class="ACME-plain-syntax"> This stops when one of the ROMs returns zero, indicating it will accept the auto-boot.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">and recall flags in A = nvbdizc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=0000nvbd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startUpOptions</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">EOR with start up options, in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">particular check bit 3 (if clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">reverse SHIFT BREAK action)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #8                                              </span><span class="ACME-comment-syntax">isolate bit 3 only</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=0 (execute !BOOT) or 8 (don't</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">execute !BOOT)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallAutoBoot</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">X = rom service call for auto-boot</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">ask each ROM in turn if they want</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to handle it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP26" class="function-link"><span class="ACME-function-syntax">checkForFindingLanguageROM</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">if (a ROM accepts this call) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (to enter language ROM)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put result from ROM (Y register) in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">A (to test if it's zero)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP25" class="function-link"><span class="ACME-function-syntax">setTapeFSAndFindLanguageROM</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">if (Y != 0, i.e. no filing system</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">accepts it) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP23" class="paragraph-anchor"></a><b>&#167;23. Select the *ROM filing system. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #141                                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP2" class="function-link"><span class="ACME-function-syntax">osbyte141EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} select ROM filing system</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP24" class="paragraph-anchor"></a><b>&#167;24. Execute !BOOT. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s15.html#SP67" class="function-link"><span class="ACME-function-syntax">runBootString</span></a><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s15.html#SP67" class="function-link"><span class="ACME-function-syntax">runBootString</span></a><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startupMessageSuppressionAndBootOptions</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">decrement boot options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSCLI</span></a><span class="ACME-plain-syntax">                                          </span><span class="ACME-comment-syntax">and execute */!BOOT</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">startupMessageSuppressionAndBootOptions</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">restore boot options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP26" class="function-link"><span class="ACME-function-syntax">checkForFindingLanguageROM</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">if (not zero) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP25" class="paragraph-anchor"></a><b>&#167;25. Select TAPE filing system. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setTapeFSAndFindLanguageROM</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">setTapeFSAndFindLanguageROM</span></span>:<br/><a href="S-s10.html#SP22">&#167;22</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbb8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} set tape filing system</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP2" class="function-link"><span class="ACME-function-syntax">setTapeOrROMFS</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP26" class="paragraph-anchor"></a><b>&#167;26. Look for language ROM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Looks for the 'best' language ROM (the language with the highest ROM slot number) and</span>
<span class="ACME-plain-syntax"> enters it</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkForFindingLanguageROM</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">checkForFindingLanguageROM</span></span>:<br/><a href="S-s10.html#SP22">&#167;22</a>, <a href="S-s10.html#SP24">&#167;24</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbbe</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastResetType</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get last RESET Type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP26" class="function-link"><span class="ACME-function-syntax">findBestLanguageROM</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (not soft reset) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">languageROMNumber</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get current language ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP29" class="function-link"><span class="ACME-function-syntax">resetAndEnterLanguageROM</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">if (language available) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(initialise and enter ROM)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">findBestLanguageROM</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbc8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #15                                             </span><span class="ACME-comment-syntax">set pointer to highest available ROM</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">romTypeTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">get ROM type from map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put bit 6 into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP29" class="function-link"><span class="ACME-function-syntax">resetAndEnterLanguageROM</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">if (bit 7 set then ROM has a</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">language entry) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(initialise and enter ROM)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">search for language until X=255</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP27" class="paragraph-anchor"></a><b>&#167;27. No language ROM present, so check for second processor. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> If present, ask the second processor to copy an appropriate language ROM onto the second</span>
<span class="ACME-plain-syntax"> processor and run there. The Tube interface is implemented by the 'DNFS' ROM. Initialising</span>
<span class="ACME-plain-syntax"> the DNFS ROM copies Tube service code into the current language workspace at $0400-$07FF.</span>
<span class="ACME-plain-syntax"> Calling .tubeCopyLanguageROMToSecondProcessor ($0400) is therefore calling into the Tube</span>
<span class="ACME-plain-syntax"> service code, to find and copy the code of an appropriate language ROM into the second</span>
<span class="ACME-plain-syntax"> processor and run it there. The language ROM identifies the processor type it's designed</span>
<span class="ACME-plain-syntax"> for by the ROM header's processor type byte (See .</span><a href="S-s10.html#SP15" class="internal">selectROMLoop</a><span class="ACME-plain-syntax">).</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">No language found.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tubePresentFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check if Tube is present</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP31" class="function-link"><span class="ACME-function-syntax">tubeCopyLanguageROMToSecondProcessorLocal</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">if (Tube present) then branch (call</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">into Tube code)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP28" class="paragraph-anchor"></a><b>&#167;28. brkNoLanguageError. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">brkNoLanguageError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbda</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$F9</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Language?"</span><span class="ACME-plain-syntax">,0                                 </span><span class="ACME-comment-syntax">message</span>
</pre>
<p class="commentary firstcommentary"><a id="SP29" class="paragraph-anchor"></a><b>&#167;29. resetAndEnterLanguageROM. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetAndEnterLanguageROM</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">resetAndEnterLanguageROM</span></span>:<br/><a href="S-s10.html#SP26">&#167;26</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbe6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP30" class="paragraph-anchor"></a><b>&#167;30. OSBYTE 142 - Enter language ROM (at $8000). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = ROM number</span>
<span class="ACME-plain-syntax">       C set if OSBYTE call;</span>
<span class="ACME-plain-syntax">       C clear if initialisation</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte142EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte142EntryPoint</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP12">&#167;12</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dbe7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">languageROMNumber</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">put X in current ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP33" class="function-link"><span class="ACME-function-syntax">selectROM</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">select that ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;(.</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romTitleString</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">)                         </span><span class="ACME-comment-syntax">} AY=address of ROM title string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&lt;(.</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romTitleString</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">)                         </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP22" class="function-link"><span class="ACME-function-syntax">displayStringAY</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">display text string held in ROM at</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.romTitleString</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">languageVersionString</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">save Y on exit (end of language</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">string)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSNEWL</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">two line feeds</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSNEWL</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">are output</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">then get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">A=1 required for language entry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tubePresentFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check if the Tube is present</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP31" class="function-link"><span class="ACME-function-syntax">tubeCopyLanguageROMToSecondProcessorLocal</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">and branch if so</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romLanguageEntry</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">enter language at $8000</span>
</pre>
<p class="commentary firstcommentary"><a id="SP31" class="paragraph-anchor"></a><b>&#167;31. tubeCopyLanguageROMToSecondProcessorLocal. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tubeCopyLanguageROMToSecondProcessorLocal</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">tubeCopyLanguageROMToSecondProcessorLocal</span></span>:<br/><a href="S-s10.html#SP27">&#167;27</a>, <a href="S-s10.html#SP30">&#167;30</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dc08</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP18" class="function-link"><span class="ACME-function-syntax">tubeCopyLanguageROMToSecondProcessor</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">enter Tube environment</span>
</pre>
<p class="commentary firstcommentary"><a id="SP32" class="paragraph-anchor"></a><b>&#167;32. Read a byte from a given ROM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y = ROM number</span>
<span class="ACME-plain-syntax"> $F6/$F7 = address</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osrdrmEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">osrdrmEntryPoint</span></span>:<br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dc0b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get current ROM number into X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store new number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">get current PHROM address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">romAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">and get byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP33" class="paragraph-anchor"></a><b>&#167;33. Select ROM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = ROM number (0-15)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">selectROM</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">selectROM</span></span>:<br/><a href="S-s10.html#SP15">&#167;15</a>, <a href="S-s10.html#SP30">&#167;30</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $dc16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">RAM copy of current ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s9.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresscurrent">10</li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s11.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

