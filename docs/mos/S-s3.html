<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 3: Memory Mapped IO</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><span class="unlink">memory-mapped i/o</span></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 3: Memory Mapped IO' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 3: Memory Mapped IO</b></li></ul></div>
<p class="purpose">Register locations for memory-mapped hardware</p>

<ul class="toc"><li><a href="S-s3.html#SP1">&#167;1. Memory Mapping</a></li><li><a href="S-s3.html#SP2">&#167;2. FRED</a></li><li><a href="S-s3.html#SP3">&#167;3. JIM</a></li><li><a href="S-s3.html#SP4">&#167;4. SHEILA</a></li><li><a href="S-s3.html#SP5">&#167;5. ACIA 6850, Control Register ($FE08)</a></li><li><a href="S-s3.html#SP6">&#167;6. ACIA 6850, Status Register ($FE08)</a></li><li><a href="S-s3.html#SP7">&#167;7. Serial ULA, Control Register ($FE10)</a></li><li><a href="S-s3.html#SP8">&#167;8. Video ULA Control Register ($FE20)</a></li><li><a href="S-s3.html#SP9">&#167;9. Video ULA Palette Register ($FE21)</a></li><li><a href="S-s3.html#SP10">&#167;10. System VIA, Register B ($FE40)</a></li><li><a href="S-s3.html#SP11">&#167;11. System VIA, Register A ($FE41)</a></li><li><a href="S-s3.html#SP12">&#167;12. System VIA, Data Direction Register B ($FE42) (aka 'DDRB')</a></li><li><a href="S-s3.html#SP13">&#167;13. System VIA, Data Direction Register A ($FE43) (aka 'DDRA')</a></li><li><a href="S-s3.html#SP14">&#167;14. System VIA, Timer 1 registers ($FE44-7)</a></li><li><a href="S-s3.html#SP15">&#167;15. System VIA, Timer 2 registers ($FE48-9)</a></li><li><a href="S-s3.html#SP16">&#167;16. The System VIA, Shift Register ($FE4A)</a></li><li><a href="S-s3.html#SP17">&#167;17. System VIA, Auxiliary Control Register ($FE4B) (aka 'ACR')</a></li><li><a href="S-s3.html#SP18">&#167;18. System VIA, Peripheral Control Register ($FE4C) (aka 'PCR')</a></li><li><a href="S-s3.html#SP19">&#167;19. System VIA, Interrupt Flag Register ($FE4D) (aka 'IFR')</a></li><li><a href="S-s3.html#SP20">&#167;20. System VIA, Interrupt Enable Register ($FE4E) (aka 'IER')</a></li><li><a href="S-s3.html#SP21">&#167;21. User VIA</a></li><li><a href="S-s3.html#SP22">&#167;22. User VIA, peripheral control register ($FE6C)</a></li><li><a href="S-s3.html#SP23">&#167;23. User VIA, interrupt flag register ($FE6D)</a></li><li><a href="S-s3.html#SP24">&#167;24. User VIA, interrupt enable register ($FE6E)</a></li><li><a href="S-s3.html#SP25">&#167;25. User VIA, Register B no handshake ($FE6F)</a></li><li><a href="S-s3.html#SP26">&#167;26. ADC 7002 - Analogue to digital conversion</a></li><li><a href="S-s3.html#SP27">&#167;27. The Tube - Registers</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Memory Mapping. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Addresses in the range $FC00-$FEFF are not mapped to the OS ROM as might be expected, but</span>
<span class="ACME-plain-syntax"> are connected to hardware devices. Consequently the CPU can communicate with hardware</span>
<span class="ACME-plain-syntax"> devices by reading and writing to specific addresses in this range.</span>

<span class="ACME-plain-syntax"> $FC00-$FCFF   - FRED      - Addresses are assigned to external devices:</span>
<span class="ACME-plain-syntax">                             Winchester Disc / Teletext / Prestel / IEEE488 etc</span>
<span class="ACME-plain-syntax"> $FD00-$FDFF   - JIM       - Access to an optional extra 64K of RAM. See .</span><a href="S-s3.html#SP3" class="internal">jimPage</a><span class="ACME-plain-syntax">.</span>
<span class="ACME-plain-syntax"> $FE00-$FEFF   - SHEILA    - Read / Write hardware internal to the BBC Micro (see next</span>
<span class="ACME-plain-syntax">                             section).</span>

<span class="ACME-plain-syntax"> The OS provides OSBYTE calls for user programs to access these locations.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s24.html#SP2" class="internal">osbyte146EntryPoint</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> Unlike the Commodore 64, this region of memory is permanently assigned to memory mapped IO,</span>
<span class="ACME-plain-syntax"> and is not bank switchable.</span>

<span class="ACME-plain-syntax"> Because of this address mapping, the underlying memory in the ROM can't be read or written</span>
<span class="ACME-plain-syntax"> by the OS. This memory stores credits text instead. See </span><a href="S-s22.html" class="internal">Chapter 22: Credits</a><span class="ACME-plain-syntax">.</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. FRED. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Accesses peripherals on the 1Mhz bus. Peripherals are allocated address ranges as follows:</span>

<span class="ACME-plain-syntax">   Address range      Hardware allocated           Later additions</span>
<span class="ACME-plain-syntax">   ---------------------------------------------------------------------</span>
<span class="ACME-plain-syntax">   $FC00 - $FC0F      Test hardware                -</span>
<span class="ACME-plain-syntax">   $FC10 - $FC13      Teletext                     -</span>
<span class="ACME-plain-syntax">   $FC14 - $FC1F      Prestel                      -</span>
<span class="ACME-plain-syntax">   $FC20 - $FC27      IEEE 488 Interface           -</span>
<span class="ACME-plain-syntax">   $FC28 - $FC2F      -                            Econet (Electron)</span>
<span class="ACME-plain-syntax">   $FC30 - $FC3F      Cambridge Ring Interface     -</span>
<span class="ACME-plain-syntax">   $FC40 - $FC47      Winchester Disc              } Compact Flash Interface</span>
<span class="ACME-plain-syntax">   $FC48 - $FC4F      Reserved                     }</span>
<span class="ACME-plain-syntax">   $FC50 - $FC5F      -                            -</span>
<span class="ACME-plain-syntax">   $FC60 - $FC6F      Serial expansion             -</span>
<span class="ACME-plain-syntax">   $FC70 - $FC7F      -                            -</span>
<span class="ACME-plain-syntax">   $FC80 - $FC8F      Test hardware                -</span>
<span class="ACME-plain-syntax">   $FC90 - $FC9F      -                            -</span>
<span class="ACME-plain-syntax">   $FCA0 - $FCAF      -                            -</span>
<span class="ACME-plain-syntax">   $FCB0 - $FCBF      -                            6522 VIA (Electron)</span>
<span class="ACME-plain-syntax">   $FCC0 - $FCCF      -                            1770 FDC (Electron)</span>
<span class="ACME-plain-syntax">   $FCD0 - $FCDF      -                            -</span>
<span class="ACME-plain-syntax">   $FCE0 - $FCEF      -                            Tube (Electron)</span>
<span class="ACME-plain-syntax">   $FCF0 - $FCF7      -                            -</span>
<span class="ACME-plain-syntax">   $FCF8 - $FCFD      -                            RetroClinic DataCentre</span>
<span class="ACME-plain-syntax">   $FCFE              JIM paging register MSB      -</span>
<span class="ACME-plain-syntax">   $FCFF              JIM paging register LSB      -</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fredPage</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">fredPage</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP70">&#167;70</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax">                                   = </span><span class="ACME-constant-syntax">$FC00</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. JIM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> If fitted JIM allows access to either an optional 64K of RAM or even up to 16Mb of RAM, one</span>
<span class="ACME-plain-syntax"> page at a time. Select which page by writing to location $FCFF (the JIM paging register)</span>
<span class="ACME-plain-syntax"> and if a 16 bit register is available also write to $FCFE. Then $FD00-$FDFF can be read</span>
<span class="ACME-plain-syntax"> or written to as RAM. Reading and writing is about half the speed of regular RAM.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">jimPage</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">jimPage</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP71">&#167;71</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">                                    = </span><span class="ACME-constant-syntax">$FD00</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">jimPagedEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">jimPagedEntryPoint</span></span>:<br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax">                         = </span><span class="ACME-constant-syntax">$FDFE</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">at reset time, holds the address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to call to initialise JIM hardware</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. SHEILA. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sheilaPage</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">sheilaPage</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP72">&#167;72</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax">                                 = </span><span class="ACME-constant-syntax">$FE00</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">crtcAddressRegister</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">crtcAddressRegister</span></span>:<br/>Chapter 5: VDU and OSWORD routines - <a href="S-s5.html#SP54">&#167;54</a>, <a href="S-s5.html#SP60">&#167;60</a></span></button><span class="ACME-plain-syntax">                        = </span><span class="ACME-constant-syntax">$FE00</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">crtcAddressWrite</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">crtcAddressWrite</span></span>:<br/>Chapter 5: VDU and OSWORD routines - <a href="S-s5.html#SP54">&#167;54</a>, <a href="S-s5.html#SP60">&#167;60</a></span></button><span class="ACME-plain-syntax">                           = </span><span class="ACME-constant-syntax">$FE01</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. ACIA 6850, Control Register ($FE08). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is used for writing values. By convention (for clarity) we use the Status Register</span>
<span class="ACME-plain-syntax"> (See .</span><a href="S-s3.html#SP6" class="internal">acia6850StatusRegister</a><span class="ACME-plain-syntax"> below) for reading values. Even though they both refer to</span>
<span class="ACME-plain-syntax"> the same memory location, they have different meanings depending on whether it's being</span>
<span class="ACME-plain-syntax"> read or written.</span>

<span class="ACME-plain-syntax">     bits 0,1 - the counter divide select bits (CR0/CR1)</span>
<span class="ACME-plain-syntax">          %00 - divide counter by 1</span>
<span class="ACME-plain-syntax">          %01 - divide counter by 16                     (used for 1200 baud tape)</span>
<span class="ACME-plain-syntax">          %10 - divide counter by 64 (default for RS-423) (used for 300 baud tape)</span>
<span class="ACME-plain-syntax">          %11 - master reset</span>
<span class="ACME-plain-syntax">     bit 2 - set means odd parity; otherwise even parity</span>
<span class="ACME-plain-syntax">     bit 3 - set means 1 stop bit; otherwise 2 stop bits</span>
<span class="ACME-plain-syntax">     bit 4 - set means 8 bit word; otherwise 7 bit word</span>
<span class="ACME-plain-syntax">     bits 5,6:</span>
<span class="ACME-plain-syntax">          %00 - 'Request To Send' ('RTS') low, transmit interrupt disabled</span>
<span class="ACME-plain-syntax">          %01 - RTS low, transmit interrupt enabled</span>
<span class="ACME-plain-syntax">          %10 - RTS high, transmit interrupt disabled</span>
<span class="ACME-plain-syntax">          %11 - RTS low, break level on data output, transmit interrupt disabled</span>
<span class="ACME-plain-syntax">     bit 7 - enable receive data register full, overrun, DCD transition interrupts</span>

<span class="ACME-plain-syntax">         DCD = Data Carrier Detect interrupt occurs when the tone at the end of a cassette</span>
<span class="ACME-plain-syntax">               block is discontinued</span>

<span class="ACME-plain-syntax">     RTS low is the active state ('Request To Send')</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">acia6850ControlRegister</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">acia6850ControlRegister</span></span>:<br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP5">&#167;5</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP12">&#167;12</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE08</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. ACIA 6850, Status Register ($FE08). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is used for reading values. By convention (for clarity) we use the Control Register</span>
<span class="ACME-plain-syntax"> (See .</span><a href="S-s3.html#SP5" class="internal">acia6850ControlRegister</a><span class="ACME-plain-syntax"> above) for writing values. Even though they both refer to</span>
<span class="ACME-plain-syntax"> the same memory location, they have different meanings depending on whether it's being</span>
<span class="ACME-plain-syntax"> read or written.</span>

<span class="ACME-plain-syntax">     bit 0 - set when a receiver interrupt is generated</span>
<span class="ACME-plain-syntax">     bit 1 - set when a transmit interrupt is generated</span>
<span class="ACME-plain-syntax">     bit 2 - set when a Data Carrier Detect ('DCD') interrupt is generated</span>
<span class="ACME-plain-syntax">     bit 3 - set if the 6850 is not clear to send ('CTS')</span>
<span class="ACME-plain-syntax">     bit 4 - framing error     } only valid if bit 0 set</span>
<span class="ACME-plain-syntax">     bit 5 - receiver over run } only valid if bit 0 set</span>
<span class="ACME-plain-syntax">     bit 6 - parity error      } only valid if bit 0 set</span>
<span class="ACME-plain-syntax">     bit 7 - set if the 6850 generated the current interrupt</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">acia6850StatusRegister</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">acia6850StatusRegister</span></span>:<br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP5">&#167;5</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP7">&#167;7</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP1">&#167;1</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax">                     = </span><span class="ACME-constant-syntax">$FE08</span><span class="ACME-plain-syntax">     </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">acia6850DataRegister</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">acia6850DataRegister</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP5">&#167;5</a>, <a href="S-s11.html#SP8">&#167;8</a>, <a href="S-s11.html#SP10">&#167;10</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP12">&#167;12</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP1">&#167;1</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax">                       = </span><span class="ACME-constant-syntax">$FE09</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">ACIA 6850, transmit / receive data</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">register ('TDR'/'RDR')</span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Serial ULA, Control Register ($FE10). </b></p>

<p class="center-p"><img src="ula.png" alt="ula.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">     bits 0-2 - transmit rate</span>
<span class="ACME-plain-syntax">     bits 3-5 - receive rate</span>
<span class="ACME-plain-syntax">                   %000    19200 baud</span>
<span class="ACME-plain-syntax">                   %001     9600 baud</span>
<span class="ACME-plain-syntax">                   %010     4800 baud</span>
<span class="ACME-plain-syntax">                   %011     2400 baud</span>
<span class="ACME-plain-syntax">                   %100     1200 baud</span>
<span class="ACME-plain-syntax">                   %101      300 baud</span>
<span class="ACME-plain-syntax">                   %110      150 baud</span>
<span class="ACME-plain-syntax">                   %111       75 baud</span>
<span class="ACME-plain-syntax">     bit 6 - if set, the RS-423 system has control of the serial system; otherwise the cassette system has control</span>
<span class="ACME-plain-syntax">     bit 7 - if set, switch on the cassette motor and relay</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">serialULAControlRegister</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">serialULAControlRegister</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP9">&#167;9</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP2">&#167;2</a>, <a href="S-s21.html#SP9">&#167;9</a>, <a href="S-s21.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax">                   = </span><span class="ACME-constant-syntax">$FE10</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Serial ULA control register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Video ULA Control Register ($FE20). </b></p>

<p class="center-p"><img src="vula.png" alt="vula.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> </span><a href="https://github.com/YazanMehyar/FPGA-BBC-micro/blob/master/docs/VULA.txt" class="external">https://github.com/YazanMehyar/FPGA-BBC-micro/blob/master/docs/VULA.txt</a>

<span class="ACME-plain-syntax"> bit 0   = flash on/off</span>
<span class="ACME-plain-syntax"> bit 1   = teletext / normal</span>
<span class="ACME-plain-syntax"> bit 2/3 = number of characters per line</span>
<span class="ACME-plain-syntax">           %00=10 characters</span>
<span class="ACME-plain-syntax">           %01=20 characters</span>
<span class="ACME-plain-syntax">           %10=40 characters</span>
<span class="ACME-plain-syntax">           %11=80 characters</span>
<span class="ACME-plain-syntax"> bit 4   = 0 means low clock frequency,  used in MODES 4-7</span>
<span class="ACME-plain-syntax">           1 means high clock frequency, used in MODES 0-3</span>
<span class="ACME-plain-syntax"> bit 5-7 = cursor width</span>
<span class="ACME-plain-syntax">           %000  hide cursor</span>
<span class="ACME-plain-syntax">           %100  MODE 0,3,4,6</span>
<span class="ACME-plain-syntax">           %110  MODE 1,5</span>
<span class="ACME-plain-syntax">           %111  MODE 2</span>
<span class="ACME-plain-syntax">           %010  MODE 7</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">videoULAControlRegister</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">videoULAControlRegister</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP11">&#167;11</a>, <a href="S-s15.html#SP59">&#167;59</a></span></button><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE20</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Video ULA control register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Video ULA Palette Register ($FE21). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Write to this register to change the palette. The top four bits define the logical colour</span>
<span class="ACME-plain-syntax"> field, and the bottom four bits are the physical colour EOR 7. Changing the palette is a</span>
<span class="ACME-plain-syntax"> little more work than you might expect however:</span>

<span class="ACME-plain-syntax"> 16 colour MODEs (MODE 2)</span>
<span class="ACME-plain-syntax"> ------------------------</span>
<span class="ACME-plain-syntax"> This is straightforward. Write the logical colour to the top four bits, and the physical</span>
<span class="ACME-plain-syntax"> colour EOR 7 in the bottom four bits.</span>

<span class="ACME-plain-syntax"> 2 colour MODEs (MODE 0,3,4,6)</span>
<span class="ACME-plain-syntax"> -----------------------------</span>
<span class="ACME-plain-syntax"> Bit 7 defines the logical colour, but ALL combinations of bits 4-6 must be set individually</span>
<span class="ACME-plain-syntax"> in order to make the change properly. e.g. to change logical colour 1 to physical colour 2:</span>

<span class="ACME-plain-syntax">     LDA #$85</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$95</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$A5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$B5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$C5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$D5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$E5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$F5</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>

<span class="ACME-plain-syntax"> 4 colour MODEs (MODE 1,5)</span>
<span class="ACME-plain-syntax"> -------------------------</span>
<span class="ACME-plain-syntax"> Bits 5 and 7 define the logical colour. But ALL combinations of bits 4 and 6 must also be</span>
<span class="ACME-plain-syntax"> set to make the change properly. e.g. to change logical colour 1 to physical colour 2:</span>

<span class="ACME-plain-syntax">     LDA #$25</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$35</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$65</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>
<span class="ACME-plain-syntax">     LDA #$75</span>
<span class="ACME-plain-syntax">     STA .videoULAPaletteRegister</span>

<span class="ACME-plain-syntax"> More OS friendly ways to set the palette are VDU 19; OSWORD 12 (which is faster than the</span>
<span class="ACME-plain-syntax"> VDU 19 sequence of calls and can be used in interrupts); or OSBYTE 155 (but this only writes</span>
<span class="ACME-plain-syntax"> to the ULA register once, so multiple calls are still needed as above).</span>

<span class="ACME-plain-syntax"> If using one of the OS friendly ways above to change the palette then the physical colours</span>
<span class="ACME-plain-syntax"> are:</span>
<span class="ACME-plain-syntax">                 0 = black             8 = flashing black-white</span>
<span class="ACME-plain-syntax">                 1 = red               9 = flashing red-cyan</span>
<span class="ACME-plain-syntax">                 2 = green            10 = flashing green-magenta</span>
<span class="ACME-plain-syntax">                 3 = yellow           11 = flashing yellow-blue</span>
<span class="ACME-plain-syntax">                 4 = blue             12 = flashing blue-yellow</span>
<span class="ACME-plain-syntax">                 5 = magenta          13 = flashing magenta-green</span>
<span class="ACME-plain-syntax">                 6 = cyan             14 = flashing cyan-red</span>
<span class="ACME-plain-syntax">                 7 = white            15 = flashing white-black</span>

<span class="ACME-plain-syntax"> If writing directly to .videoULAPaletteRegister ($FE21) then the values for the physical</span>
<span class="ACME-plain-syntax"> colour are different:</span>

<span class="ACME-plain-syntax">      value to write = physical colour from table above EOR 7.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">videoULAPaletteRegister</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">videoULAPaletteRegister</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP60">&#167;60</a></span></button><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE21</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Video ULA palette register</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">romSelectRegister</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">romSelectRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP15">&#167;15</a>, <a href="S-s10.html#SP32">&#167;32</a>, <a href="S-s10.html#SP33">&#167;33</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP5">&#167;5</a><br/>Chapter 23: Extended vectors - <a href="S-s23.html#SP2">&#167;2</a>, <a href="S-s23.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">                          = </span><span class="ACME-constant-syntax">$FE30</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. System VIA, Register B ($FE40). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Notes:</span>
<span class="ACME-plain-syntax">     The bottom four bits are used for writing, and the top four bits are used for reading.</span>
<span class="ACME-plain-syntax">     (See .</span><a href="S-s3.html#SP12" class="internal">systemVIADataDirectionRegisterB</a><span class="ACME-plain-syntax">)</span>

<span class="ACME-plain-syntax">     Values 0-15 can be written to System VIA Register B (Output):</span>

<span class="ACME-plain-syntax">         Value   Effect</span>
<span class="ACME-plain-syntax">         -------------------------</span>
<span class="ACME-plain-syntax">         0       Enable sound chip</span>
<span class="ACME-plain-syntax">         1       Enable Read Speech</span>
<span class="ACME-plain-syntax">         2       Enable Write Speech</span>
<span class="ACME-plain-syntax">         3       Disable Keyboard auto scanning</span>
<span class="ACME-plain-syntax">         4       Hardware scrolling - set C0=0 (See below)</span>
<span class="ACME-plain-syntax">         5       Hardware scrolling - set C1=0 (See below)</span>
<span class="ACME-plain-syntax">         6       Turn on CAPS LOCK LED</span>
<span class="ACME-plain-syntax">         7       Turn on SHIFT LOCK LED</span>
<span class="ACME-plain-syntax">         8       Disable sound chip</span>
<span class="ACME-plain-syntax">         9       Disable Read Speech</span>
<span class="ACME-plain-syntax">         10      Disable Write Speech</span>
<span class="ACME-plain-syntax">         11      Enable Keyboard auto scanning</span>
<span class="ACME-plain-syntax">         12      Hardware scrolling - set C0=1 (See below)</span>
<span class="ACME-plain-syntax">         13      Hardware scrolling - set C1=1 (See below)</span>
<span class="ACME-plain-syntax">         14      Turn off CAPS LOCK LED</span>
<span class="ACME-plain-syntax">         15      Turn off SHIFT LOCK LED</span>

<span class="ACME-plain-syntax">  The values of C0 and C1 together determine the start scroll address for the screen:</span>

<span class="ACME-plain-syntax">         C0   C1      Screen       Used in</span>
<span class="ACME-plain-syntax">                      Address   Regular MODEs</span>
<span class="ACME-plain-syntax">         ------------------------------------</span>
<span class="ACME-plain-syntax">          0    0      $4000           3</span>
<span class="ACME-plain-syntax">          0    1      $5800          4,5</span>
<span class="ACME-plain-syntax">          1    0      $6000           6</span>
<span class="ACME-plain-syntax">          1    1      $3000         0,1,2</span>

<span class="ACME-plain-syntax"> When reading from this address the top four bits are read:</span>

<span class="ACME-plain-syntax"> bit 7:    Speech processor 'ready' signal</span>
<span class="ACME-plain-syntax"> bit 6:    Speech processor 'interrupt' signal</span>
<span class="ACME-plain-syntax"> bit 4-5:  joystick buttons (bit is zero when button pressed)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIARegisterB</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIARegisterB</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP5">&#167;5</a>, <a href="S-s10.html#SP16">&#167;16</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP20">&#167;20</a>, <a href="S-s15.html#SP57">&#167;57</a>, <a href="S-s15.html#SP58">&#167;58</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP3">&#167;3</a>, <a href="S-s16.html#SP25">&#167;25</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP2">&#167;2</a>, <a href="S-s17.html#SP13">&#167;13</a>, <a href="S-s17.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax">                         = </span><span class="ACME-constant-syntax">$FE40</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA Register B (Input and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Output)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. System VIA, Register A ($FE41). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This register is not used. The non-handshaking variant is used instead.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s3.html#SP13" class="internal">systemVIADataDirectionRegisterA</a><span class="ACME-plain-syntax"> for details.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIARegisterA</span><span class="ACME-plain-syntax">                         = </span><span class="ACME-constant-syntax">$FE41</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA Register A (Input and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Output)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. System VIA, Data Direction Register B ($FE42) (aka 'DDRB'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> When writing data into Register B (.systemVIARegisterB), the bits that are set on DDRB</span>
<span class="ACME-plain-syntax"> indicate which bits are actually written into Register B. The bits that are clear on DDRB</span>
<span class="ACME-plain-syntax"> are used to read from Register B.</span>

<span class="ACME-plain-syntax"> DDRB is only written once on startup where it is initialised to %00001111</span>
<span class="ACME-plain-syntax"> (see .</span><a href="S-s10.html#SP5" class="internal">setUpSystemVIA</a><span class="ACME-plain-syntax">) and the OS expects it to remain that way. Only the bottom four bits</span>
<span class="ACME-plain-syntax"> of .systemVIARegisterB are used when writing, and only the upper four bits are read from</span>
<span class="ACME-plain-syntax"> .systemVIARegisterB. See .</span><a href="S-s3.html#SP10" class="internal">systemVIARegisterB</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIADataDirectionRegisterB</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIADataDirectionRegisterB</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax">            = </span><span class="ACME-constant-syntax">$FE42</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA data direction register B</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(DDRB)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. System VIA, Data Direction Register A ($FE43) (aka 'DDRA'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The keyboard, sound and speech systems use Data Direction Register A. Each bit of DDRA</span>
<span class="ACME-plain-syntax"> indicates whether data can be written or read on that bit when data is accessed via</span>
<span class="ACME-plain-syntax"> .systemVIARegisterANoHandshake. This is similar to DDRB. Unlike DDRB, the OS modifies</span>
<span class="ACME-plain-syntax"> DDRA frequently to set the appropriate bits for accessing the device (often in the IRQ</span>
<span class="ACME-plain-syntax"> interrupt code). Once set, data is read or written to .systemVIARegisterANoHandshake as</span>
<span class="ACME-plain-syntax"> needed. See .</span><a href="S-s3.html#SP20" class="internal">systemVIARegisterANoHandshake</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> Sound:    When outputting sound, DDRA is set to %11111111 meaning all bits of data</span>
<span class="ACME-plain-syntax">           that are subsequently written to .systemVIARegisterANoHandshake are output bits.</span>
<span class="ACME-plain-syntax">           (See .</span><a href="S-s16.html#SP3" class="internal">sendToSoundChipFlagsAreadyPushed</a><span class="ACME-plain-syntax">)</span>

<span class="ACME-plain-syntax"> Speech:   For speech, DDRA is set to %00000000 (for reading) or %11111111 (for writing) as</span>
<span class="ACME-plain-syntax">           needed. (See .</span><a href="S-s16.html#SP25" class="internal">readWriteSpeechProcessorPushedFlags</a><span class="ACME-plain-syntax">)</span>

<span class="ACME-plain-syntax"> Keyboard: When reading the keyboard, DDRA is set to (%011111111). The key to read is written</span>
<span class="ACME-plain-syntax">           into bits 0-6 of .systemVIARegisterANoHandshake, and the 'pressed' state of that</span>
<span class="ACME-plain-syntax">           key is then read from bit 7.</span>
<span class="ACME-plain-syntax">           (See .</span><a href="S-s17.html#SP13" class="internal">interrogateKeyboard</a><span class="ACME-plain-syntax">)</span>
<span class="ACME-plain-syntax">           (See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a><span class="ACME-plain-syntax">)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIADataDirectionRegisterA</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIADataDirectionRegisterA</span></span>:<br/><a href="S-s3.html#SP20">&#167;20</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP3">&#167;3</a>, <a href="S-s16.html#SP25">&#167;25</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP13">&#167;13</a>, <a href="S-s17.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax">            = </span><span class="ACME-constant-syntax">$FE43</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA data direction register A</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(DDRA)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. System VIA, Timer 1 registers ($FE44-7). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is a 1Mhz countdown timer. An IRQ is triggered when the timer reaches zero. The OS</span>
<span class="ACME-plain-syntax"> uses this timer as a 100Hz timer to update various parts of the OS. It is expected to</span>
<span class="ACME-plain-syntax"> remain as a 100Hz timer if the OS is to continue working properly. User VIA Timers are</span>
<span class="ACME-plain-syntax"> available for user programs instead.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s11.html#SP16" class="internal">irq1CheckSystemVIA100HzTimer</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> Timer 1 can be configured in one of two modes by writing to the ACR</span>
<span class="ACME-plain-syntax"> (see .</span><a href="S-s3.html#SP17" class="internal">systemVIAAuxiliaryControlRegister</a><span class="ACME-plain-syntax">):</span>

<span class="ACME-plain-syntax"> One-shot mode:</span>
<span class="ACME-plain-syntax">   .systemVIATimer1LatchLow and .systemVIATimer1CounterHigh form a 16 bit countdown value.</span>
<span class="ACME-plain-syntax">   Write to .systemVIATimer1LatchLow first then writing to .systemVIATimer1CounterHigh</span>
<span class="ACME-plain-syntax">   starts the timer. When the timer is complete a timer IRQ interrupt is generated. This</span>
<span class="ACME-plain-syntax">   only happens once.</span>

<span class="ACME-plain-syntax"> Free-run mode (aka 'Continuous interrupts'):</span>
<span class="ACME-plain-syntax">   .systemVIATimer1LatchLow and .systemVIATimer1LatchHigh are initialised to the initial</span>
<span class="ACME-plain-syntax">   timeout value for the timer. The timer starts when .systemVIATimer1CounterHigh is</span>
<span class="ACME-plain-syntax">   also written. Unlike one-shot mode, once the timeout interrupt has happened the counter</span>
<span class="ACME-plain-syntax">   is reset to the values in the latches and the process repeats. The process can be stopped</span>
<span class="ACME-plain-syntax">   by writing .systemVIATimer1CounterHigh, by reading .systemVIATimer1CounterLow, or by</span>
<span class="ACME-plain-syntax">   writing to the interrupt flag.</span>
<span class="ACME-plain-syntax">   This is the mode set by the OS for Timer 1 at startup. See .</span><a href="S-s10.html#SP8" class="internal">setUpPage2</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer1CounterLow</span><span class="ACME-plain-syntax">                  = </span><span class="ACME-constant-syntax">$FE44</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer1CounterHigh</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIATimer1CounterHigh</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax">                 = </span><span class="ACME-constant-syntax">$FE45</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer1LatchLow</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIATimer1LatchLow</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE46</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer1LatchHigh</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIATimer1LatchHigh</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax">                   = </span><span class="ACME-constant-syntax">$FE47</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. System VIA, Timer 2 registers ($FE48-9). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Timer 2 (like Timer 1) is a 1MHz countdown timer with an IRQ being generated when the</span>
<span class="ACME-plain-syntax"> counter reaches zero. It is used by the OS to update the Speech system if present. It also</span>
<span class="ACME-plain-syntax"> has two modes of operation, selected by writing to the ACR. (See .</span><a href="S-s3.html#SP17" class="internal">systemVIAAuxiliaryControlRegister</a><span class="ACME-plain-syntax">).</span>

<span class="ACME-plain-syntax"> One-shot mode:</span>
<span class="ACME-plain-syntax">   This is similar to Timer 1 (above). Write the low byte of the timer first</span>
<span class="ACME-plain-syntax">   .systemVIATimer2CounterLow then writing to the high byte of the counter</span>
<span class="ACME-plain-syntax">   .systemVIATimer2CounterHigh starts the timer. When the timer is countdown reaches zero</span>
<span class="ACME-plain-syntax">   a timer IRQ interrupt is generated. This only happens once.</span>

<span class="ACME-plain-syntax"> Pulse counting mode:</span>
<span class="ACME-plain-syntax">   This is unlike Timer 1. It counts down the number of negative going pulses applied to</span>
<span class="ACME-plain-syntax">   System VIA input pin PB6. Firstly write to .systemVIATimer2CounterLow, then writing to</span>
<span class="ACME-plain-syntax">   .systemVIATimer2CounterHigh will start the countdown. When PB6 is pulsed low for the</span>
<span class="ACME-plain-syntax">   appropriate number of times then an IRQ interrupt occurs. This only happens once. This</span>
<span class="ACME-plain-syntax">   is the default mode as initialised at startup.</span>

<span class="ACME-plain-syntax"> Timer 2 is started by the Speech system (if present) as needed to time Speech. The timer</span>
<span class="ACME-plain-syntax"> is cleared by the OS when a Timer 2 IRQ is received (see .</span><a href="S-s11.html#SP15" class="internal">irq1CheckSystemVIASpeech</a><span class="ACME-plain-syntax">).</span>
<span class="ACME-plain-syntax"> It is also cleared at startup. See .</span><a href="S-s10.html#SP8" class="internal">setUpPage2</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer2CounterLow</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIATimer2CounterLow</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP16">&#167;16</a></span></button><span class="ACME-plain-syntax">                  = </span><span class="ACME-constant-syntax">$FE48</span><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIATimer2CounterHigh</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIATimer2CounterHigh</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP16">&#167;16</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax">                 = </span><span class="ACME-constant-syntax">$FE49</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. The System VIA, Shift Register ($FE4A). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is not used in this OS. It is designed to be used for serial data I/O by shifting</span>
<span class="ACME-plain-syntax"> bits one at a time under the control of an internal modulo-8 counter.</span>
<span class="ACME-plain-syntax"> See NAUG Section 22.4.9, Page 395.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIAShiftRegister</span><span class="ACME-plain-syntax">                     = </span><span class="ACME-constant-syntax">$FE4A</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. System VIA, Auxiliary Control Register ($FE4B) (aka 'ACR'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> bit 0:    PA latch enable</span>
<span class="ACME-plain-syntax"> bit 1:    PB latch enable</span>
<span class="ACME-plain-syntax"> bits 2-4: Shift register mode</span>
<span class="ACME-plain-syntax"> bit 5:    Timer 2 mode: 0=One-shot mode; 1=Pulse counting mode.</span>
<span class="ACME-plain-syntax"> bit 6:    Timer 1 mode: 0=One shot mode; 1=Free-run mode.</span>
<span class="ACME-plain-syntax"> bit 7:    Enable pulsing of System VIA output pin PB7.</span>
<span class="ACME-plain-syntax">           When enabled, Timer 1 will set PB7 as follows:</span>
<span class="ACME-plain-syntax">           In One-shot mode:</span>
<span class="ACME-plain-syntax">               PB7 is cleared when Timer 1 started,</span>
<span class="ACME-plain-syntax">               PB7 is set when Timer 1 one-shot mode times out.</span>
<span class="ACME-plain-syntax">           In Free-run mode:</span>
<span class="ACME-plain-syntax">               PB7 is inverted when Timer 1 times out.</span>

<span class="ACME-plain-syntax"> In the reset code (see .</span><a href="S-s10.html#SP8" class="internal">setUpPage2</a><span class="ACME-plain-syntax">) this register is initialised to:</span>

<span class="ACME-plain-syntax">   (a) disable the latches and the shift register,</span>
<span class="ACME-plain-syntax">   (b) set Timer 2 as an interval timer,</span>
<span class="ACME-plain-syntax">   (c) set Timer 1 as free-run mode (aka continuous interrupts).</span>

<span class="ACME-plain-syntax"> Otherwise this register is not used by the OS.</span>

<span class="ACME-plain-syntax"> See NAUG Section 22.4.8, Page 395.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIAAuxiliaryControlRegister</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIAAuxiliaryControlRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax">          = </span><span class="ACME-constant-syntax">$FE4B</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. System VIA, Peripheral Control Register ($FE4C) (aka 'PCR'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> bit 0    = CA1 interrupt control</span>
<span class="ACME-plain-syntax">            Writing to CA1 means "data taken"</span>
<span class="ACME-plain-syntax">            0 means negative active edge</span>
<span class="ACME-plain-syntax">            1 means positive active edge</span>

<span class="ACME-plain-syntax"> bits 1-3 = CA2 control mode</span>
<span class="ACME-plain-syntax">            CA2 signifies "data ready"</span>

<span class="ACME-plain-syntax"> bit 4    = CB1 interrupt control</span>
<span class="ACME-plain-syntax">            Writing to CB1 means "data taken"</span>
<span class="ACME-plain-syntax">            0 means negative active edge</span>
<span class="ACME-plain-syntax">            1 means positive active edge</span>

<span class="ACME-plain-syntax"> bits 5-7 = CB2 control mode</span>
<span class="ACME-plain-syntax">            CB2 signifies "data ready"</span>

<span class="ACME-plain-syntax"> control mode:</span>
<span class="ACME-plain-syntax">   000 = negative edges active on input</span>
<span class="ACME-plain-syntax">   001 = independent interrupt; input negative edge</span>
<span class="ACME-plain-syntax">   010 = positive edges active on input</span>
<span class="ACME-plain-syntax">   011 = independent interrupt; input positive edge</span>
<span class="ACME-plain-syntax">   100 = handshake output mode</span>
<span class="ACME-plain-syntax">   101 = pulse output mode</span>
<span class="ACME-plain-syntax">   110 = low output</span>
<span class="ACME-plain-syntax">   111 = high output</span>

<span class="ACME-plain-syntax"> The System VIA PCR initialises like so (See .</span><a href="S-s10.html#SP8" class="internal">setUpPage2</a><span class="ACME-plain-syntax">):</span>
<span class="ACME-plain-syntax">       CA1 has negative active edge       (vertical sync)</span>
<span class="ACME-plain-syntax">       CA2 positive edges active on input (keyboard)</span>
<span class="ACME-plain-syntax">       CB1 has negative active edge       (end of analogue conversion)</span>
<span class="ACME-plain-syntax">       CB2 negative active edges on input (light pen strobe)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIAPeripheralControlRegister</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIAPeripheralControlRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax">         = </span><span class="ACME-constant-syntax">$FE4C</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. System VIA, Interrupt Flag Register ($FE4D) (aka 'IFR'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">   bit 0 = key pressed</span>
<span class="ACME-plain-syntax">   bit 1 = vertical sync occurred</span>
<span class="ACME-plain-syntax">   bit 2 = shift register timeout (unused)</span>
<span class="ACME-plain-syntax">   bit 3 = lightpen strobe off screen</span>
<span class="ACME-plain-syntax">   bit 4 = analogue conversion completed</span>
<span class="ACME-plain-syntax">   bit 5 = timer 2 has timed out (used for speech)</span>
<span class="ACME-plain-syntax">   bit 6 = timer 1 has timed out (100Hz signal)</span>
<span class="ACME-plain-syntax">   bit 7 = (when reading) master interrupt flag (0-6 invalid if clear)</span>

<span class="ACME-plain-syntax"> Used in interrupt code:</span>

<span class="ACME-plain-syntax"> Reading</span>
<span class="ACME-plain-syntax"> -------</span>
<span class="ACME-plain-syntax"> If bit 7 is set then the System VIA caused the current interrupt. The remaining bits can</span>
<span class="ACME-plain-syntax"> then be checked to see the exact cause.</span>

<span class="ACME-plain-syntax"> Writing</span>
<span class="ACME-plain-syntax"> -------</span>
<span class="ACME-plain-syntax"> Clear bit 7 and set a bit 0-6 to clear that interrupt.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIAInterruptFlagRegister</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIAInterruptFlagRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP11">&#167;11</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP13">&#167;13</a>, <a href="S-s11.html#SP15">&#167;15</a>, <a href="S-s11.html#SP16">&#167;16</a>, <a href="S-s11.html#SP17">&#167;17</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax">             = </span><span class="ACME-constant-syntax">$FE4D</span><span class="ACME-plain-syntax">     </span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. System VIA, Interrupt Enable Register ($FE4E) (aka 'IER'). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Each bit controls whether an interrupt is enabled or disabled.</span>

<span class="ACME-plain-syntax"> bit 0 = key pressed</span>
<span class="ACME-plain-syntax"> bit 1 = vertical sync occurred</span>
<span class="ACME-plain-syntax"> bit 2 = shift register timeout (unused)</span>
<span class="ACME-plain-syntax"> bit 3 = light pen strobe off screen</span>
<span class="ACME-plain-syntax"> bit 4 = analogue conversion completed</span>
<span class="ACME-plain-syntax"> bit 5 = timer 2 timed out (used for speech)</span>
<span class="ACME-plain-syntax"> bit 6 = timer 1 timed out (100Hz signal)</span>
<span class="ACME-plain-syntax"> bit 7 = enable/disable interrupt value (see below)</span>

<span class="ACME-plain-syntax"> Writing:</span>
<span class="ACME-plain-syntax"> --------</span>
<span class="ACME-plain-syntax"> To enable  an interrupt, write a byte with bit 7 set   and set the desired bit(s) (0-6).</span>
<span class="ACME-plain-syntax"> To disable an interrupt, write a byte with bit 7 clear and set the desired bit(s) (0-6).</span>

<span class="ACME-plain-syntax"> Reading:</span>
<span class="ACME-plain-syntax"> --------</span>
<span class="ACME-plain-syntax"> Bits 0-6 are read as expected.</span>
<span class="ACME-plain-syntax"> Bit 7 is always set when read.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span><button class="popup" onclick="togglePopup('usagePopup25')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup25">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP3">&#167;3</a>, <a href="S-s10.html#SP7">&#167;7</a>, <a href="S-s10.html#SP11">&#167;11</a>, <a href="S-s10.html#SP13">&#167;13</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP13">&#167;13</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP1">&#167;1</a>, <a href="S-s17.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">           = </span><span class="ACME-constant-syntax">$FE4E</span><span class="ACME-plain-syntax">     </span>

<span class="ACME-comment-syntax">See .</span><a href="S-s3.html#SP13" class="internal">systemVIADataDirectionRegisterA</a><span class="ACME-comment-syntax">.</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span><button class="popup" onclick="togglePopup('usagePopup26')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup26">Usage of <span class="code-font"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></span>:<br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP3">&#167;3</a>, <a href="S-s16.html#SP25">&#167;25</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP13">&#167;13</a>, <a href="S-s17.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax">              = </span><span class="ACME-constant-syntax">$FE4F</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA Register A without</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">handshaking</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. User VIA. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Port A is the (Centronics) parallel printer port (output only)</span>
<span class="ACME-plain-syntax"> Port B is the user port (input and output) (unused by the OS)</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s13.html#SP3" class="internal">openPrinterChannel</a><span class="ACME-plain-syntax"> for details of how to write to the printer.</span>

<span class="ACME-plain-syntax"> The data direction registers work as they do on the System VIA</span>
<span class="ACME-plain-syntax"> (see .</span><a href="S-s3.html#SP12" class="internal">systemVIADataDirectionRegisterB</a><span class="ACME-plain-syntax">)</span>

<span class="ACME-plain-syntax"> The User VIA has Timer 1 and Timer 2. They work in the same way as the timers on the</span>
<span class="ACME-plain-syntax"> System VIA. These are not used by the OS so are available for user programs.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s3.html#SP14" class="internal">systemVIATimer1CounterLow</a><span class="ACME-plain-syntax">.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s3.html#SP15" class="internal">systemVIATimer2CounterLow</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> The auxiliary control register works the same way as on the System VIA.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s3.html#SP17" class="internal">systemVIAAuxiliaryControlRegister</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> The shift register is unused.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIARegisterB</span><span class="ACME-plain-syntax">                           = </span><span class="ACME-constant-syntax">$FE60</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Register B (input/output)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIARegisterA</span><button class="popup" onclick="togglePopup('usagePopup27')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup27">Usage of <span class="code-font"><span class="ACME-function-syntax">userVIARegisterA</span></span>:<br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">                           = </span><span class="ACME-constant-syntax">$FE61</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Register A (output)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIADataDirectionRegisterB</span><span class="ACME-plain-syntax">              = </span><span class="ACME-constant-syntax">$FE62</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">data direction register B</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIADataDirectionRegisterA</span><button class="popup" onclick="togglePopup('usagePopup28')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup28">Usage of <span class="code-font"><span class="ACME-function-syntax">userVIADataDirectionRegisterA</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax">              = </span><span class="ACME-constant-syntax">$FE63</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">data direction register A</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer1CounterLow</span><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE64</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 1 counter (low)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer1CounterHigh</span><span class="ACME-plain-syntax">                   = </span><span class="ACME-constant-syntax">$FE65</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 1 counter (high)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer1LatchLow</span><span class="ACME-plain-syntax">                      = </span><span class="ACME-constant-syntax">$FE66</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 1 latch (low)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer1LatchHigh</span><span class="ACME-plain-syntax">                     = </span><span class="ACME-constant-syntax">$FE67</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 1 latch (high)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer2CounterLow</span><span class="ACME-plain-syntax">                    = </span><span class="ACME-constant-syntax">$FE68</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 2 counter (low)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIATimer2CounterHigh</span><span class="ACME-plain-syntax">                   = </span><span class="ACME-constant-syntax">$FE69</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Timer 2 counter (high)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIAShiftRegister</span><span class="ACME-plain-syntax">                       = </span><span class="ACME-constant-syntax">$FE6A</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">shift register</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIAAuxiliaryControlRegister</span><span class="ACME-plain-syntax">            = </span><span class="ACME-constant-syntax">$FE6B</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">auxiliary control register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP22" class="paragraph-anchor"></a><b>&#167;22. User VIA, peripheral control register ($FE6C). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This works the same as on the System VIA (See .</span><a href="S-s3.html#SP18" class="internal">systemVIAPeripheralControlRegister</a><span class="ACME-plain-syntax">).</span>

<span class="ACME-plain-syntax"> The User VIA PCR initialises like so (See .</span><a href="S-s10.html#SP8" class="internal">setUpPage2</a><span class="ACME-plain-syntax">):</span>
<span class="ACME-plain-syntax">           CA1 interrupt on -ve edge     (usually printer Acknowledge)</span>
<span class="ACME-plain-syntax">           CA2 high output               (usually printer strobe)</span>
<span class="ACME-plain-syntax">           CB1 interrupt on -ve edge     (user port)</span>
<span class="ACME-plain-syntax">           CB2 negative edge             (user port)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIAPeripheralControlRegister</span><button class="popup" onclick="togglePopup('usagePopup29')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup29">Usage of <span class="code-font"><span class="ACME-function-syntax">userVIAPeripheralControlRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">           = </span><span class="ACME-constant-syntax">$FE6C</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Peripheral control register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP23" class="paragraph-anchor"></a><b>&#167;23. User VIA, interrupt flag register ($FE6D). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> bit 1 = printer interrupt</span>
<span class="ACME-plain-syntax"> bit 5 = timer 2 timed out interrupt</span>
<span class="ACME-plain-syntax"> bit 6 = timer 1 timed out interrupt</span>

<span class="ACME-plain-syntax"> Writing:</span>
<span class="ACME-plain-syntax"> Clear bit 7 to clear each of the interrupts indicated by the other set bits.</span>
<span class="ACME-plain-syntax"> Or set bit 7 to raise each of the interrupts.</span>
<span class="ACME-plain-syntax">   e.g. To clear a printer interrupt, clear bit 7 and set bit 1</span>

<span class="ACME-plain-syntax"> Reading:</span>
<span class="ACME-plain-syntax"> bit 1 set signifies a parallel printer interrupt.</span>
<span class="ACME-plain-syntax"> bit 5 set signifies timer 2 timed out</span>
<span class="ACME-plain-syntax"> bit 6 set signifies timer 1 timed out</span>
<span class="ACME-plain-syntax"> bit 7 set means the current interrupt is from the User VIA</span>
<span class="ACME-plain-syntax"> (See .</span><a href="S-s11.html#SP14" class="internal">irq1CheckUserVIA</a><span class="ACME-plain-syntax">)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIAInterruptFlagRegister</span><button class="popup" onclick="togglePopup('usagePopup30')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup30">Usage of <span class="code-font"><span class="ACME-function-syntax">userVIAInterruptFlagRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP11">&#167;11</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax">               = </span><span class="ACME-constant-syntax">$FE6D</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Interrupt flag register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP24" class="paragraph-anchor"></a><b>&#167;24. User VIA, interrupt enable register ($FE6E). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> bit 1 = printer interrupt</span>
<span class="ACME-plain-syntax"> bit 5 = timer 2 timed out interrupt</span>
<span class="ACME-plain-syntax"> bit 6 = timer 1 timed out interrupt</span>

<span class="ACME-plain-syntax"> Writing:</span>
<span class="ACME-plain-syntax"> Clear bit 7 to disable each of the interrupts indicated by the other set bits.</span>
<span class="ACME-plain-syntax"> Or set bit 7 to enable each of the interrupts.</span>

<span class="ACME-plain-syntax"> e.g. To disable printer interrupts, clear bit 7 and set bit 1</span>
<span class="ACME-plain-syntax">      To  enable printer interrupts,   set bit 7 and set bit 1</span>

<span class="ACME-plain-syntax"> Reading:</span>
<span class="ACME-plain-syntax"> bit 7 is always read as set when reading.</span>
<span class="ACME-plain-syntax"> (See .</span><a href="S-s11.html#SP14" class="internal">irq1CheckUserVIA</a><span class="ACME-plain-syntax">)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIAInterruptEnableRegister</span><button class="popup" onclick="togglePopup('usagePopup31')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup31">Usage of <span class="code-font"><span class="ACME-function-syntax">userVIAInterruptEnableRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP11">&#167;11</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP14">&#167;14</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax">             = </span><span class="ACME-constant-syntax">$FE6E</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Interrupt enable register</span>
</pre>
<p class="commentary firstcommentary"><a id="SP25" class="paragraph-anchor"></a><b>&#167;25. User VIA, Register B no handshake ($FE6F). </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">userVIARegisterBNoHandshake</span><span class="ACME-plain-syntax">                = </span><span class="ACME-constant-syntax">$FE6F</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Register B but no handshake</span>
</pre>
<p class="commentary firstcommentary"><a id="SP26" class="paragraph-anchor"></a><b>&#167;26. ADC 7002 - Analogue to digital conversion. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See .</span><a href="S-s11.html#SP21" class="internal">osbyte17EntryPoint</a>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">adcDataStatusRegister</span><button class="popup" onclick="togglePopup('usagePopup32')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup32">Usage of <span class="code-font"><span class="ACME-function-syntax">adcDataStatusRegister</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP16">&#167;16</a></span></button><span class="ACME-plain-syntax">                      = </span><span class="ACME-constant-syntax">$FEC0</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">For reading the current ADC</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">conversion state</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">adcStartConversionRegister</span><button class="popup" onclick="togglePopup('usagePopup33')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup33">Usage of <span class="code-font"><span class="ACME-function-syntax">adcStartConversionRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP13">&#167;13</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax">                 = </span><span class="ACME-constant-syntax">$FEC0</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">For writing when we want to start</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">an ADC conversion</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">adcDataHighByte</span><button class="popup" onclick="togglePopup('usagePopup34')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup34">Usage of <span class="code-font"><span class="ACME-function-syntax">adcDataHighByte</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax">                            = </span><span class="ACME-constant-syntax">$FEC1</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">ADC (7002) high data byte</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">adcDataLowByte</span><button class="popup" onclick="togglePopup('usagePopup35')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup35">Usage of <span class="code-font"><span class="ACME-function-syntax">adcDataLowByte</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax">                             = </span><span class="ACME-constant-syntax">$FEC2</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">ADC (7002) low data byte</span>
</pre>
<p class="commentary firstcommentary"><a id="SP27" class="paragraph-anchor"></a><b>&#167;27. The Tube - Registers. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See NAUG Section 18.3, Page 328</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tubeULAStatusRegister</span><button class="popup" onclick="togglePopup('usagePopup36')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup36">Usage of <span class="code-font"><span class="ACME-function-syntax">tubeULAStatusRegister</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax">                      = </span><span class="ACME-constant-syntax">$FEE0</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">Tube ULA Status Register</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tubeULADataRegister3</span><button class="popup" onclick="togglePopup('usagePopup37')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup37">Usage of <span class="code-font"><span class="ACME-function-syntax">tubeULADataRegister3</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP5">&#167;5</a>, <a href="S-s19.html#SP23">&#167;23</a></span></button><span class="ACME-plain-syntax">                       = </span><span class="ACME-constant-syntax">$FEE5</span><span class="ACME-plain-syntax">     </span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s2.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresscurrent">3</li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s4.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

