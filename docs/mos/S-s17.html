<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 17: Keyboard processing</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><span class="unlink"><b>$EEDA</b>: chapter 17</span></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 17: Keyboard processing' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 17: Keyboard processing</b></li></ul></div>
<p class="purpose">OSBYTE 15, 21, 120-122, 131; Keyboard processing, translation table, scanning code; KEYV entry point; Speech table; *HELP - 603 bytes (3.6%)</p>

<ul class="toc"><li><a href="S-s17.html#SP1">&#167;1. tidyUpAfterKeyboardProcessing</a></li><li><a href="S-s17.html#SP2">&#167;2. keyboardIndicators</a></li><li><a href="S-s17.html#SP3">&#167;3. KEYV - Default main keyboard handling routine</a></li><li><a href="S-s17.html#SP4">&#167;4. keyVClear</a></li><li><a href="S-s17.html#SP5">&#167;5. keyboardTimerInterrupt</a></li><li><a href="S-s17.html#SP6">&#167;6. Test SHIFT and CTRL</a></li><li><a href="S-s17.html#SP7">&#167;7. checkForKeyAutorepeat</a></li><li><a href="S-s17.html#SP8">&#167;8. testCapsLock</a></li><li><a href="S-s17.html#SP9">&#167;9. Get ASCII code</a></li><li><a href="S-s17.html#SP10">&#167;10. testCapsLockEngaged</a></li><li><a href="S-s17.html#SP11">&#167;11. Check for key pressed and store</a></li><li><a href="S-s17.html#SP12">&#167;12. resetAutorepeatCounters</a></li><li><a href="S-s17.html#SP13">&#167;13. Read a single key's state from the keyboard</a></li><li><a href="S-s17.html#SP14">&#167;14. The seven 'key data' tables</a></li><li><a href="S-s17.html#SP15">&#167;15. OSBYTE 120 - Write key pressed data</a></li><li><a href="S-s17.html#SP16">&#167;16. keyDataTable2</a></li><li><a href="S-s17.html#SP17">&#167;17. jimPagedEntryJumper</a></li><li><a href="S-s17.html#SP18">&#167;18. osbyteOrOSWORDJumper</a></li><li><a href="S-s17.html#SP19">&#167;19. keyDataTable3</a></li><li><a href="S-s17.html#SP20">&#167;20. keyboardInterruptRoutine</a></li><li><a href="S-s17.html#SP21">&#167;21. keyDataTable4</a></li><li><a href="S-s17.html#SP22">&#167;22. Tables for reading or writing speech</a></li><li><a href="S-s17.html#SP23">&#167;23. keyDataTable5</a></li><li><a href="S-s17.html#SP24">&#167;24. OSBYTE 131 - Read OSHWM (OS High Water Mark)</a></li><li><a href="S-s17.html#SP25">&#167;25. keyDataTable6</a></li><li><a href="S-s17.html#SP26">&#167;26. flushCurrentInputBuffer</a></li><li><a href="S-s17.html#SP27">&#167;27. keyDataTable7</a></li><li><a href="S-s17.html#SP28">&#167;28. OSBYTE 15 - Flush selected buffer class</a></li><li><a href="S-s17.html#SP29">&#167;29. OSBYTE 21 - Flush specific buffer</a></li><li><a href="S-s17.html#SP30">&#167;30. *HELP</a></li><li><a href="S-s17.html#SP31">&#167;31. Keyboard scan ignoring SHIFT and CTRL, without KEYV vector</a></li><li><a href="S-s17.html#SP32">&#167;32. OSBYTE 122 - Keyboard scan ignoring SHIFT and CTRL</a></li><li><a href="S-s17.html#SP33">&#167;33. OSBYTE 121 - Keyboard scan from value in X</a></li><li><a href="S-s17.html#SP34">&#167;34. Scan Keyboard</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. tidyUpAfterKeyboardProcessing. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tidyUpAfterKeyboardProcessing</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">tidyUpAfterKeyboardProcessing</span></span>:<br/><a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $eeda</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">assume enable keyboard interrupt</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">processing</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">} check for any key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (anything pressed) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(skip forward, don't ignore keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">interrupts)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10000001</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">enable keyboard interrupt (by</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">writing bit 7 and</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">bit 0 of system VIA interrupt enable</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">register)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set X=0 (ignore keyboard interrupts)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">enableKeyboardInterruptProcessingFlag</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">set keyboard interrupt processing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">flag</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(0 means ignore keyboard interrupts,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">255 means don't ignore keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">interrupts)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>

</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. keyboardIndicators. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> write to the keyboard LEDs (SHIFT LOCK and CAPS LOCK)</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       .keyboardStatusFlags contains the SHIFT / CAPS LOCK state to write to the LEDs</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A contains the value of the flags register on entry</span>
<span class="ACME-plain-syntax">       Preserves N and V flags</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyboardIndicators</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">keyboardIndicators</span></span>:<br/><a href="S-s17.html#SP6">&#167;6</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP7">&#167;7</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $eeeb</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read keyboard status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 4 = 0 means CAPS LOCK engaged (c)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 5 = 0 means SHIFT LOCK engaged</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(s)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">A = %xxscxxxx</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A = %0xxscxxx</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00011000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A = %000sc000</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #6                                              </span><span class="ACME-comment-syntax">A = %000sc110</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">write the bottom nybble to turn on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">or off CAPS LOCK light</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A = %0000sc11</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">A = %0000s111</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">write the bottom nybble to turn on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">or off SHIFT LOCK light</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">enableKeyboardScanning</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">enable keyboard scanning</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. KEYV - Default main keyboard handling routine. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">  Flags</span>
<span class="ACME-plain-syntax">   C V                                                             Resolved to:</span>
<span class="ACME-plain-syntax">   0 0 - Test SHIFT and CTRL keys (exit with N=1 if CTRL pressed;</span>
<span class="ACME-plain-syntax">                                   V=1 if SHIFT pressed)           See .</span><a href="S-s17.html#SP6" class="internal">keyTestSHIFTAndCTRLOrTimerInterrupt</a>
<span class="ACME-plain-syntax">   1 0 - Scan keyboard (as OSBYTE 121)                             See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a>
<span class="ACME-plain-syntax">   0 1 - Key pressed interrupt entry                               See .</span><a href="S-s17.html#SP11" class="internal">keyPressedInterrupt</a>
<span class="ACME-plain-syntax">   1 1 - Timer interrupt entry                                     See .</span><a href="S-s17.html#SP5" class="internal">keyboardTimerInterrupt</a>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">keyEntryPoint</span></span>:<br/><a href="S-s17.html#SP33">&#167;33</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef02</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP4" class="function-link"><span class="ACME-function-syntax">keyVClear</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (V is clear) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">disable keyboard interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptEnableRegister</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">by writing to VIA interrupt vector</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP5" class="function-link"><span class="ACME-function-syntax">keyboardTimerInterrupt</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (timer interrupt) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP11" class="function-link"><span class="ACME-function-syntax">keyPressedInterrupt</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">jump</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. keyVClear. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyVClear</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">keyVClear</span></span>:<br/><a href="S-s17.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef0e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">keyTestSHIFTAndCTRLOrTimerInterrupt</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">if (carry clear) then branch (test</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">SHIFT and CTRL)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">scanKeyboard</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">jump to scan keyboard</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. keyboardTimerInterrupt. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyboardTimerInterrupt</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">keyboardTimerInterrupt</span></span>:<br/><a href="S-s17.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef13</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">enableKeyboardInterruptProcessingFlag</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">increment keyboard flag to zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to stop further key processing</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Test SHIFT and CTRL. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Carry CLEAR if entered here for testing the SHIFT and CTRL keys</span>
<span class="ACME-plain-syntax">       Carry SET   if entered via the keyboard timer interrupt</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       N=1 if CTRL pressed</span>
<span class="ACME-plain-syntax">       V=1 if SHIFT pressed</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyTestSHIFTAndCTRLOrTimerInterrupt</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">keyTestSHIFTAndCTRLOrTimerInterrupt</span></span>:<br/><a href="S-s17.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read keyboard status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 3 = 1 means SHIFT pressed</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 4 = 0 means CAPS LOCK engaged</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 5 = 0 means SHIFT LOCK engaged</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 6 = 1 means CTRL pressed</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 7 = 1 means SHIFT enabled</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10110111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">zero bits 3 and 6 (SHIFT and CTRL</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pressed)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">zero X to test for SHIFT key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">interrogate keyboard. Returns with</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">X=$80 if SHIFT is pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">save X (SHIFT key status)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLV</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">testCTRL</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if (no key pressed) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(check for CTRL key)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">allBitsSet</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">set N and V flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00001000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set bit 3 to indicate SHIFT was</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pressed</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testCTRL</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef2a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">(X=$01 or X=$81 but top bit is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">ignored by .interrogateKeyboard)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">check the CTRL key (key X)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP2" class="function-link"><span class="ACME-function-syntax">keyboardIndicators</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (entered routine just for testing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">SHIFT and CTRL status) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">                       (to turn on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">keyboard lights as required and exit)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">at this point we are here because of a timer interrupt</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (key not pressed) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01000000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">or set CTRL pressed bit in keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">status byte in A</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">save the updated status byte</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">noLastKeyPressed</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (no key pressed) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">check to see if last key is still</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP7" class="function-link"><span class="ACME-function-syntax">checkForKeyAutorepeat</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (key pressed) then branch (enter</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">repeat routine)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">compare X (zero) with last key</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pressed</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">storeLastKeyPressed</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">storeLastKeyPressed</span></span>:<br/><a href="S-s17.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef42</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">store X in last key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">noLastKeyPressed</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (no key recently pressed) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">} store zero as the last key pressed</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetAutorepeatAndContinue</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">resetAutorepeatAndContinue</span></span>:<br/><a href="S-s17.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef4a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP12" class="function-link"><span class="ACME-function-syntax">resetAutorepeatCounters</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">and reset repeat system</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">noLastKeyPressed</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef4d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">keyboardRolloverChecks</span></a><span class="ACME-plain-syntax">                         </span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. checkForKeyAutorepeat. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This looks the see if the current key pressed is the same as the previous key pressed</span>
<span class="ACME-plain-syntax"> If so we handle auto-repeat.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkForKeyAutorepeat</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">checkForKeyAutorepeat</span></span>:<br/><a href="S-s17.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef50</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">storeLastKeyPressed</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (X is not the same as the last</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">key pressed) then branch back</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">new key pressed is same as last key pressed, so handle auto-repeat</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get auto repeat countdown timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP7" class="function-link"><span class="ACME-function-syntax">afterModifiers</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (auto repeat countdown timer is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">zero) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">decrement timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP7" class="function-link"><span class="ACME-function-syntax">afterModifiers</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (not zero) then branch (still</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">waiting for a repeat delay to finish)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardFirstAutorepeatCount</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">get initial autorepeat delay (or</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">repeat interval)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store it in countdown timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardAutoRepeatRate</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get auto repeat interval</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardFirstAutorepeatCount</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">store it as next value for countdown</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get keyboard status</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get last key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$D0</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check for SHIFT LOCK key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP8" class="function-link"><span class="ACME-function-syntax">testCapsLock</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (not SHIFT LOCK) then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">test CAPS LOCK)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with SHIFT LOCK key pressed.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Update keyboard status flags.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10010000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">sets keyboard status flags (enable</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">SHIFT, disengage CAPS LOCK)</span>

<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 3 = 1 means SHIFT pressed</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 4 = 0 means CAPS LOCK engaged</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 5 = 0 means SHIFT LOCK engaged</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 6 = 1 means CTRL pressed</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Bit 7 = 1 means SHIFT enabled</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10100000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">flip SHIFT enabled, and flip SHIFT</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">LOCK engaged</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetKeyboardStatusAndTimer</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">resetKeyboardStatusAndTimer</span></span>:<br/><a href="S-s17.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef74</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">set keyboard status</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">and set timer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">to 0</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">afterModifiers</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef7b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">keyboardRolloverChecks</span></a><span class="ACME-plain-syntax">                         </span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. testCapsLock. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testCapsLock</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">testCapsLock</span></span>:<br/><a href="S-s17.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef7e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$C0</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check for CAPS LOCK</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP9" class="function-link"><span class="ACME-function-syntax">getASCIICode</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (not CAPS LOCK) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(decode key to ASCII etc)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with CAPS LOCK key pressed.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Update keyboard status flags.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$A0</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">enable shift flag, and disengage</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">SHIFT LOCK</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">check for SHIFT pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (SHIFT not pressed) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$10</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">set CAPS LOCK disengaged</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">flip SHIFT enabled</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$90</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">reverse both SHIFT enabled and CAPS</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">LOCK</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP7" class="function-link"><span class="ACME-function-syntax">resetKeyboardStatusAndTimer</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">reset keyboard status and set timer</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Get ASCII code. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Handles the conversion of the internal key number (here with the top bit set) into</span>
<span class="ACME-plain-syntax"> the final ASCII code. It takes into account the current state of CTRL key, SHIFT key,</span>
<span class="ACME-plain-syntax"> the SHIFT LOCK and CAPS LOCK engaged states.</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a><span class="ACME-plain-syntax"> for table of internal key numbers.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = key pressed internal number WITH THE TOP BIT SET</span>
<span class="ACME-plain-syntax">           X is at least $90, since the internal key number is at least 16 ($10).</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">getASCIICode</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">getASCIICode</span></span>:<br/><a href="S-s17.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ef91</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP14" class="function-link"><span class="ACME-function-syntax">keyDataTable1</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$90</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">get ASCII code from look up tables</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not zero, i.e. TAB not pressed)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (skip TAB)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with TAB key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">asciiCodeGeneratedByTABKey</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">get TAB character (9 by default)</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get keyboard status</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store keyboard status in temporary</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">storage</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">rotate to get CTRL pressed into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (CTRL not pressed) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(past CTRL processing)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with CTRL key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get number of previously pressed key</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">localResetAutorepeatAndContinue</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">localResetAutorepeatAndContinue</span></span>:<br/><a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efa4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP6" class="function-link"><span class="ACME-function-syntax">resetAutorepeatAndContinue</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">if (not zero) then branch (reset</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">autorepeat counters)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP66" class="function-link"><span class="ACME-function-syntax">implementCTRLCodes</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">perform code changes for CTRL</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">move SHIFT LOCK into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testCapsLockEngaged</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (SHIFT LOCK not engaged) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (skip SHIFT LOCK processing)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with SHIFT LOCK key engaged</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP65" class="function-link"><span class="ACME-function-syntax">implementSHIFT</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">make code changes for SHIFT</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">move CAPS LOCK into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testShiftEnabled</span></a><span class="ACME-plain-syntax">                               </span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. testCapsLockEngaged. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testCapsLockEngaged</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">testCapsLockEngaged</span></span>:<br/><a href="S-s17.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efb5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">move CAPS LOCK into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testShift</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (CAPS LOCK not engaged) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with CAPS LOCK engaged</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP29" class="function-link"><span class="ACME-function-syntax">isLetter</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">make changes for CAPS LOCK on,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">return with C clear for alphabetic</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">codes</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testShift</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (not a letter) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP65" class="function-link"><span class="ACME-function-syntax">implementSHIFT</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">transform the letter via SHIFT</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testShiftEnabled</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">testShiftEnabled</span></span>:<br/><a href="S-s17.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efc1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardStatusFlags</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">check SHIFT enabled bit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testESCAPEcode</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (SHIFT disabled) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testShift</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efc6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">move SHIFT into bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">testESCAPEcode</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (no SHIFT key) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with SHIFT key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get previous key press</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP9" class="function-link"><span class="ACME-function-syntax">localResetAutorepeatAndContinue</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">if (not 0) then branch (reset repeat</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">system etc)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP65" class="function-link"><span class="ACME-function-syntax">implementSHIFT</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">make code changes for SHIFT</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">testESCAPEcode</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efd1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">asciiCodeThatGeneratesESCAPEAction</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">check against ESCAPE action</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (A is not ESCAPE action) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with ESCAPE key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">escapeAction</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">get ESCAPE key action type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (ESCAPE returns ASCII code) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store zero in auto-repeat countdown</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">timer</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">enableKeyboardScanningFlippingInterrupts</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">enable keyboard scanning</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardDisableFlag</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read Keyboard disable flag (used by</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Econet)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">keyboardRolloverChecks</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (keyboard disabled) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">finally put result into keyboard input buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP30" class="function-link"><span class="ACME-function-syntax">insertByteIntoKeyboardBuffer</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">put character in input buffer</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Check for two key rollover</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyboardRolloverChecks</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">keyboardRolloverChecks</span></span>:<br/><a href="S-s17.html#SP6">&#167;6</a>, <a href="S-s17.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $efe9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get first keypress</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (none) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">examine to see if key still pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">store result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (key pressed) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">reset .firstKeyPressedInternal to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">zero</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get .firstKeyPressedInternal</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP11" class="function-link"><span class="ACME-function-syntax">continueKeyProcessing</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (not zero) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get address of last keypress into Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP31" class="function-link"><span class="ACME-function-syntax">clearCarryKeyboardScan</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">scan keyboard from $10 (osbyte 122)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">localTidyUpAfterKeyboardProcessing</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">if (exit is negative) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">make the last key the</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">first key pressed i.e. rollover</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">storeKeyAndReset</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">storeKeyAndReset</span></span>:<br/><a href="S-s17.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f007</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">save X into .lastKeyPressedInternal</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP12" class="function-link"><span class="ACME-function-syntax">resetAutorepeatCounters</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">set keyboard repeat delay</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">localTidyUpAfterKeyboardProcessing</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">localTidyUpAfterKeyboardProcessing</span></span>:<br/><a href="S-s17.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f00c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP1" class="function-link"><span class="ACME-function-syntax">tidyUpAfterKeyboardProcessing</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">finish up</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. Check for key pressed and store. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = key</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyPressedInterrupt</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">keyPressedInterrupt</span></span>:<br/><a href="S-s17.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f00f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">check if key pressed</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">continueKeyProcessing</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">continueKeyProcessing</span></span>:<br/><a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f012</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get previous key press</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">localTidyUpAfterKeyboardProcessing</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">if (none) then branch (back to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">housekeeping routine)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP31" class="function-link"><span class="ACME-function-syntax">clearCarryKeyboardScan</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">and scan keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">localTidyUpAfterKeyboardProcessing</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">if (negative on exit) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(back to housekeeping)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP10" class="function-link"><span class="ACME-function-syntax">storeKeyAndReset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">ALWAYS branch (back to store X;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">reset keyboard delay etc)</span>

</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. resetAutorepeatCounters. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetAutorepeatCounters</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">resetAutorepeatCounters</span></span>:<br/><a href="S-s17.html#SP6">&#167;6</a>, <a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f01f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">set timer to 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">autorepeatCountdownTimer</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardAutoRepeatDelay</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get next timer value</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">keyboardFirstAutorepeatCount</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">and store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. Read a single key's state from the keyboard. </b></p>

<p class="center-p"><img src="return.png" alt="return.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = key to test</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A is preserved</span>
<span class="ACME-plain-syntax">       Carry is preserved</span>

<span class="ACME-plain-syntax">       X = $80 if key pressed (N set)</span>
<span class="ACME-plain-syntax">           $00 otherwise      (N clear)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">interrogateKeyboard</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="ACME-function-syntax">interrogateKeyboard</span></span>:<br/><a href="S-s17.html#SP6">&#167;6</a>, <a href="S-s17.html#SP10">&#167;10</a>, <a href="S-s17.html#SP11">&#167;11</a>, <a href="S-s17.html#SP34">&#167;34</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f02a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">stop keyboard scanning</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">by writing to system VIA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01111111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">input on bit 7, output on bits 0 to 6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP13" class="function-link"><span class="ACME-function-syntax">systemVIADataDirectionRegisterA</span></a><span class="ACME-plain-syntax">                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">write X to Port A system VIA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">read back ($80 + internal key</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">number) if key pressed (or zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">otherwise)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. The seven 'key data' tables. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> What follows is 7 tables of 10 bytes each, spaced 16 bytes apart, giving the 'ASCII'</span>
<span class="ACME-plain-syntax"> character codes for each internal key number on the keyboard row. In the six bytes between</span>
<span class="ACME-plain-syntax"> each table, small snippets of unrelated code are inserted.</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a><span class="ACME-plain-syntax"> for table of internal key numbers.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable1</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="ACME-function-syntax">keyDataTable1</span></span>:<br/><a href="S-s17.html#SP9">&#167;9</a><br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP14">&#167;14</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f03b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     q , 3 , 4 , 5 , f4, 8 , f7, - , ^ ,LEFT</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$71</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$33</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$34</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$35</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$84</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$38</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$87</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$2D</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$5E</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$8C</span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. OSBYTE 120 - Write key pressed data. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte120EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte120EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f045</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">lastKeyPressedInternal</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">store Y as latest key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">firstKeyPressedInternal</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">store X as previous key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">[unused]</span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. keyDataTable2. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable2</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f04b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     f0, w , e , t , 7 , i , 9 , 0 , _ ,DOWN</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$77</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$65</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$74</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$37</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$69</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$39</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$30</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$5F</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$8E</span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. jimPagedEntryJumper. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">jimPagedEntryJumper</span><button class="popup" onclick="togglePopup('usagePopup25')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup25">Usage of <span class="code-font"><span class="ACME-function-syntax">jimPagedEntryJumper</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f055</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">jimPagedEntryPoint</span></a><span class="ACME-plain-syntax">)                           </span><span class="ACME-comment-syntax">Jim paged entry vector</span>
</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. osbyteOrOSWORDJumper. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyteOrOSWORDJumper</span><button class="popup" onclick="togglePopup('usagePopup26')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup26">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyteOrOSWORDJumper</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP22">&#167;22</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f058</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">)                                  </span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. keyDataTable3. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable3</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f05b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     1 , 2 , d , r , 6 , u , o , p , [ ,UP</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$31</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$32</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$64</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$72</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$36</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$75</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6F</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$70</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$5B</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$8F</span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. keyboardInterruptRoutine. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyboardInterruptRoutine</span><button class="popup" onclick="togglePopup('usagePopup27')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup27">Usage of <span class="code-font"><span class="ACME-function-syntax">keyboardInterruptRoutine</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP16">&#167;16</a>, <a href="S-s11.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f065</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">allBitsSet</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">set N and V flags</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyJumper</span><button class="popup" onclick="togglePopup('usagePopup28')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup28">Usage of <span class="code-font"><span class="ACME-function-syntax">keyJumper</span></span>:<br/><a href="S-s17.html#SP33">&#167;33</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP16">&#167;16</a>, <a href="S-s15.html#SP56">&#167;56</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f068</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorKEYV</span></a><span class="ACME-plain-syntax">)                                   </span><span class="ACME-comment-syntax">i.e. KEYV</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. keyDataTable4. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable4</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f06b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">CAPS LOCK, a , x , f , y , j , k , @ , : ,RETURN</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax">   </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$61</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$78</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$66</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$79</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6A</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6B</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$40</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$3A</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$0D</span>
</pre>
<p class="commentary firstcommentary"><a id="SP22" class="paragraph-anchor"></a><b>&#167;22. Tables for reading or writing speech. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">speechDirectionTable</span><button class="popup" onclick="togglePopup('usagePopup29')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup29">Usage of <span class="code-font"><span class="ACME-function-syntax">speechDirectionTable</span></span>:<br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f075</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA DDRA       (8 bit Read / 8 bit Write)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">speechEnableTable</span><button class="popup" onclick="togglePopup('usagePopup30')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup30">Usage of <span class="code-font"><span class="ACME-function-syntax">speechEnableTable</span></span>:<br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f077</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$02</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA Register B (Enable Read Speech / Enable Write Speech)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">speechDisableTable</span><button class="popup" onclick="togglePopup('usagePopup31')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup31">Usage of <span class="code-font"><span class="ACME-function-syntax">speechDisableTable</span></span>:<br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f079</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$09</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$0A</span><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">System VIA Register B (Disable Read Speech / Disable Write Speech)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP23" class="paragraph-anchor"></a><b>&#167;23. keyDataTable5. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable5</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f07b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">SHIFT LOCK, s , c , g , h , n , l , ; , ] ,DELETE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax">    </span><span class="ACME-constant-syntax">$02</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$73</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$63</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$67</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$68</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6E</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6C</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$3B</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$5D</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$7F</span>
</pre>
<p class="commentary firstcommentary"><a id="SP24" class="paragraph-anchor"></a><b>&#167;24. OSBYTE 131 - Read OSHWM (OS High Water Mark). </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte131EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup32')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup32">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte131EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f085</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">currentOSHWM</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">read current OSHWM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP25" class="paragraph-anchor"></a><b>&#167;25. keyDataTable6. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable6</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f08b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     TAB, Z ,SPACE, V , b , m , , , . , / ,COPY</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax">  </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$7A</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$20</span><span class="ACME-plain-syntax">  ,</span><span class="ACME-constant-syntax">$76</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$62</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$6D</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$2C</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$2E</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$2F</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$8B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">NOTE: TAB returns 0, and is handled as a special case in the code</span>
</pre>
<p class="commentary firstcommentary"><a id="SP26" class="paragraph-anchor"></a><b>&#167;26. flushCurrentInputBuffer. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">flushCurrentInputBuffer</span><button class="popup" onclick="togglePopup('usagePopup33')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup33">Usage of <span class="code-font"><span class="ACME-function-syntax">flushCurrentInputBuffer</span></span>:<br/><a href="S-s17.html#SP28">&#167;28</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f095</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">currentInputBuffer</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">get current input buffer</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">flushBufferXJumper</span><button class="popup" onclick="togglePopup('usagePopup34')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup34">Usage of <span class="code-font"><span class="ACME-function-syntax">flushBufferXJumper</span></span>:<br/><a href="S-s17.html#SP29">&#167;29</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f098</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s13.html#SP10" class="function-link"><span class="ACME-function-syntax">flushBufferX</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">flush it</span>
</pre>
<p class="commentary firstcommentary"><a id="SP27" class="paragraph-anchor"></a><b>&#167;27. keyDataTable7. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyDataTable7</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f09b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">     ESC, f1, f2, f3, f5, f6, f8, f9, \ ,RIGHT</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax">  </span><span class="ACME-constant-syntax">$1B</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$81</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$82</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$83</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$85</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$86</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$88</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$89</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$5C</span><span class="ACME-plain-syntax">,</span><span class="ACME-constant-syntax">$8D</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">eventJumper</span><button class="popup" onclick="togglePopup('usagePopup35')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup35">Usage of <span class="code-font"><span class="ACME-function-syntax">eventJumper</span></span>:<br/>Chapter 14: Star commands - <a href="S-s14.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0a5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorEVNTV</span></a><span class="ACME-plain-syntax">)                                  </span><span class="ACME-comment-syntax">jump to eventV handling routine</span>
</pre>
<p class="commentary firstcommentary"><a id="SP28" class="paragraph-anchor"></a><b>&#167;28. OSBYTE 15 - Flush selected buffer class. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = 0       flush all buffers</span>
<span class="ACME-plain-syntax">       X != 0      flush input buffer</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte15EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup36')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup36">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte15EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0a8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP26" class="function-link"><span class="ACME-function-syntax">flushCurrentInputBuffer</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">if (X is not zero) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(flush input buffer only)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">flushAllBuffers</span><button class="popup" onclick="togglePopup('usagePopup37')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup37">Usage of <span class="code-font"><span class="ACME-function-syntax">flushAllBuffers</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0aa</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">bufferNumberHighest</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">load highest buffer number (8)</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">allow interrupts briefly</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP29" class="function-link"><span class="ACME-function-syntax">osbyte21EntryPoint</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">flush buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement X to point at next buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (X &gt;= 0) then branch (flush next</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through... (at this point X=255)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP29" class="paragraph-anchor"></a><b>&#167;29. OSBYTE 21 - Flush specific buffer. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X=buffer number</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte21EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup38')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup38">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte21EntryPoint</span></span>:<br/><a href="S-s17.html#SP28">&#167;28</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0b4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">bufferNumberHighest</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">test against largest buffer number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP26" class="function-link"><span class="ACME-function-syntax">flushBufferXJumper</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (X &lt; 9) then branch (flush buffer</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">X)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP30" class="paragraph-anchor"></a><b>&#167;30. *HELP. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starHelp</span><button class="popup" onclick="togglePopup('usagePopup39')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup39">Usage of <span class="code-font"><span class="ACME-function-syntax">starHelp</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0b9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallHelp</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} Issue *HELP service request to</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} paged ROMs. Returns with Y = 0</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} if message below is to be</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} suppressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP17" class="function-link"><span class="ACME-function-syntax">printFollowingMessage</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">print following message routine</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">Carriage return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"OS 1.20"</span><span class="ACME-plain-syntax">                                     </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">Carriage return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">terminator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP31" class="paragraph-anchor"></a><b>&#167;31. Keyboard scan ignoring SHIFT and CTRL, without KEYV vector. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Starts scanning from 16 decimal (row 1 of the internal key table).</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y = $EC or $ED, the address of the keyboard table to set:</span>

<span class="ACME-plain-syntax">       .lastKeyPressedInternal  = $EC</span>
<span class="ACME-plain-syntax">       .firstKeyPressedInternal = $ED</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">clearCarryKeyboardScan</span><button class="popup" onclick="togglePopup('usagePopup40')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup40">Usage of <span class="code-font"><span class="ACME-function-syntax">clearCarryKeyboardScan</span></span>:<br/><a href="S-s17.html#SP10">&#167;10</a>, <a href="S-s17.html#SP11">&#167;11</a>, <a href="S-s17.html#SP33">&#167;33</a>, <a href="S-s17.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0cc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">pass through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP32" class="paragraph-anchor"></a><b>&#167;32. OSBYTE 122 - Keyboard scan ignoring SHIFT and CTRL. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Ignores the first row of the keyboard (SHIFT, CTRL, and the hardware DIP switches)</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s17.html#SP34" class="internal">scanKeyboard</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte122EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup41')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup41">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte122EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0cd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">set X to 16 (ignores the first</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">keyboard row containing SHIFT,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">CTRL, and the hardware keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">switches)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">pass through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP33" class="paragraph-anchor"></a><b>&#167;33. OSBYTE 121 - Keyboard scan from value in X. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte121EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup42')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup42">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte121EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0cf</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP20" class="function-link"><span class="ACME-function-syntax">keyJumper</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if entry is via OSBYTE 121 or OSBYTE</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">122 then carry is set. We branch to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">jump through the KEYV vector to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.keyEntryPoint.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(Assuming the default vector routine</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">is in place. If V is set then that</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">code will jump to .scanKeyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">below) if entry is via</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.clearCarryKeyboardScan above then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">carry is clear and we fall</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">through...</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP34" class="paragraph-anchor"></a><b>&#167;34. Scan Keyboard. </b></p>

<p class="center-p"><img src="keyboard.png" alt="keyboard.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The BBC Micro has 74 keys, and 8 DIP switches. All keys can be read as separate values</span>
<span class="ACME-plain-syntax"> except that the two SHIFT keys cannot be distinguished from each other, and the BREAK key</span>
<span class="ACME-plain-syntax"> is hardwired to RESET the machine.</span>

<span class="ACME-plain-syntax"> Internal keyboard numbers:</span>
<span class="ACME-plain-syntax">                                       column</span>
<span class="ACME-plain-syntax">        | 0           1      2       3       4       5       6       7       8       9</span>
<span class="ACME-plain-syntax">    ----+----------------------------------------------------------------------------------</span>
<span class="ACME-plain-syntax">    $00 | SHIFT       CTRL   bit 7   bit 6   bit 5   bit 4   bit 3   bit 2   bit 1   bit 0</span>
<span class="ACME-plain-syntax">    $10 | Q           3      4       5       f4      8       f7      -       ^       LEFT</span>
<span class="ACME-plain-syntax"> r  $20 | f0          W      E       T       7       I       9       0       _       DOWN</span>
<span class="ACME-plain-syntax"> o  $30 | 1           2      D       R       6       U       O       P       [       UP</span>
<span class="ACME-plain-syntax"> w  $40 | CAPS LOCK   A      X       F       Y       J       K       @       :       RETURN</span>
<span class="ACME-plain-syntax">    $50 | SHIFT LOCK  S      C       G       H       N       L       ;       ]       DELETE</span>
<span class="ACME-plain-syntax">    $60 | TAB         Z      SPACE   V       B       M       ,       .       /       COPY</span>
<span class="ACME-plain-syntax">    $70 | ESCAPE      f1     f2      f3      f5      f6      f8      f9      \       RIGHT</span>

<span class="ACME-plain-syntax"> 'bit n' refers to the row of eight hardware DIP switches inside the case at the bottom</span>
<span class="ACME-plain-syntax"> right of the keyboard:</span>
</pre>
<p class="center-p"><img src="dips.png" alt="dips.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">

<span class="ACME-plain-syntax">  dip   bit      Internal Key Number   Description</span>
<span class="ACME-plain-syntax">  ----------------------------------------------------------------------------------</span>
<span class="ACME-plain-syntax">  8-6   bit 0-2        9,8,7           Together these bits determine the startup MODE</span>
<span class="ACME-plain-syntax">  5     bit 3            6             Set if the SHIFT-BREAK action is reversed with BREAK</span>
<span class="ACME-plain-syntax">  4-3   bit 4-5         5,4            Sets disc drive timings (depends on make of drive)</span>
<span class="ACME-plain-syntax">  2-1   bit 6-7         3,2            unused</span>

<span class="ACME-plain-syntax"> The keyboard is scanned by first looping through the columns (see .</span><a href="S-s17.html#SP34" class="internal">loopKeyboardColumns</a>
<span class="ACME-plain-syntax"> below). Each time around the loop we check to see if *any* key in that column is pressed.</span>
<span class="ACME-plain-syntax"> If not we skip to the next column. If we find a column with a key pressed, then we must</span>
<span class="ACME-plain-syntax"> check each row in that column to check which specific key is pressed</span>
<span class="ACME-plain-syntax"> (see .</span><a href="S-s17.html#SP34" class="internal">loopKeyboardRows</a><span class="ACME-plain-syntax">).</span>

<span class="ACME-plain-syntax"> For the keyboard circuit diagram, See </span><a href="S-s25.html" class="internal">Chapter 25: Appendix</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the first key to scan from (if positive)</span>
<span class="ACME-plain-syntax">       X is the specific key to check (if negative)</span>

<span class="ACME-plain-syntax">       Carry set if entry is via an OSBYTE</span>
<span class="ACME-plain-syntax">        or clear if via .clearCarryKeyboardScan</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">scanKeyboard</span><button class="popup" onclick="togglePopup('usagePopup43')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup43">Usage of <span class="code-font"><span class="ACME-function-syntax">scanKeyboard</span></span>:<br/><a href="S-s17.html#SP4">&#167;4</a>, <a href="S-s17.html#SP33">&#167;33</a><br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0d1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">} if X is positive then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} scan all keyboard)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP13" class="function-link"><span class="ACME-function-syntax">interrogateKeyboard</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">interrogate keyboard for specific key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">enableKeyboardScanning</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (carry set, i.e. entry via</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSBYTE) then branch (finish up)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags (to remember carry,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">whether entry if via OSBYTE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry clear, i.e. entry was via</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.clearCarryKeyboardScan) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">entry was via OSBYTE.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">keyToIgnoreWhenScanningWithOSBYTE121or122</span></a><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">set Y so next instruction saves to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.previousKeyPressedWhenReadingOSBYTE</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">previousKeyPressedWhenReadingLastKey</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">keyPressedInternalTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">  </span><span class="ACME-comment-syntax">save first</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">possible key</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">number (address</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">can be $02CB,</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">$02CC or $02CD)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #9                                              </span><span class="ACME-comment-syntax">loop counter: from 9 to 0 to select</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the keyboard column</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">outer loop: loop through the columns of the keyboard</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">loopKeyboardColumns</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f0e3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">enableKeyboardScanningFlippingInterrupts</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">enable keyboard scanning</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01111111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP13" class="function-link"><span class="ACME-function-syntax">systemVIADataDirectionRegisterA</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">} set port A for input on bit 7 (all</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} others are output bits)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} i.e. we write to bits 0-6 of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} .systemVIARegisterANoHandshake,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} and get the result by reading bit 7</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">} stop auto scanning of the keyboard</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #15                                             </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">} select a non-existent keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} column 15 (0-9 only!)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP19" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptFlagRegister</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">} cancel keyboard interrupts</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">select column X (9 max -&gt; 0 min)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP19" class="function-link"><span class="ACME-function-syntax">systemVIAInterruptFlagRegister</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">check for any key in this column</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">being pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">tryNextKeyboardColumn</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (bit 0 clear, i.e. there is no</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">key pressed in this column) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put column number (= first internal</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">key number in column) in A</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">inner loop: loop through the rows of the keyboard</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">loopKeyboardRows</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f103</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">previousKeyPressedWhenReadingLastKey</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">keyPressedInternalTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">  </span><span class="ACME-comment-syntax">compare with</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">first possible</span>
<span class="ACME-plain-syntax">                                                                            </span><span class="ACME-comment-syntax">pressed key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">tryNextKeyboardRow</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (current key number is too low)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">write which specific key to test</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP20" class="function-link"><span class="ACME-function-syntax">systemVIARegisterANoHandshake</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">check for specific key being pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">tryNextKeyboardRow</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (bit 7 is zero, i.e. key not</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pressed) then branch (go to next row)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">at this point key A is pressed. pull</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and push flags (to read carry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">finishKeyboardScanning</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (carry set, i.e. entry via OSBYTE</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">121/122) then branch (finished)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push A (key pressed)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$0000</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">EOR with last key pressed (in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$EC,$ED, or $EE depending on Y value)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">shift left (to ignore the top bit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">set carry if not the same as</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">previous key pressed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Pull A (key pressed)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">finishKeyboardScanning</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (carry set, i.e. not the same as</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">previous key pressed) then branch</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tryNextKeyboardRow</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f11e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">} add 16 to check for key in next row</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">loopKeyboardRows</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">and do it again if 0 &lt;= key &lt; 128</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">goto next column</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tryNextKeyboardColumn</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f123</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">loopKeyboardColumns</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">scan again if greater than 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">finishKeyboardScanning</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f127</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull flags</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">enableKeyboardScanningFlippingInterrupts</span><button class="popup" onclick="togglePopup('usagePopup44')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup44">Usage of <span class="code-font"><span class="ACME-function-syntax">enableKeyboardScanningFlippingInterrupts</span></span>:<br/><a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f129</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP34" class="function-link"><span class="ACME-function-syntax">enableKeyboardScanning</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">enable keyboard scanning</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">allow interrupts briefly</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">enableKeyboardScanning</span><button class="popup" onclick="togglePopup('usagePopup45')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup45">Usage of <span class="code-font"><span class="ACME-function-syntax">enableKeyboardScanning</span></span>:<br/><a href="S-s17.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f12e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #11                                             </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP10" class="function-link"><span class="ACME-function-syntax">systemVIARegisterB</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">} enable auto scan of keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Set X = 11</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s16.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresscurrent">17</li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s18.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

