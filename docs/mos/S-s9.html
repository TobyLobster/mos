<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 9: Cursor editing mode</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><span class="unlink"><b>$D7C2</b>: chapter 9</span></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 9: Cursor editing mode' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 9: Cursor editing mode</b></li></ul></div>
<p class="purpose">OSBYTE 132, 133, 135; Cursor editing mode routines - 382 bytes (2.3%)</p>

<ul class="toc"><li><a href="S-s9.html#SP1">&#167;1. OSBYTE 135 - Read character at text cursor position</a></li><li><a href="S-s9.html#SP2">&#167;2. nonMODE7ReadCharacter</a></li><li><a href="S-s9.html#SP3">&#167;3. Read character from screen pixels</a></li><li><a href="S-s9.html#SP4">&#167;4. Read pixel</a></li><li><a href="S-s9.html#SP5">&#167;5. Check the graphics point on the VDU queue is within the graphics window</a></li><li><a href="S-s9.html#SP6">&#167;6. Check the given point is within the graphics window</a></li><li><a href="S-s9.html#SP7">&#167;7. splitIntoTwoCursors</a></li><li><a href="S-s9.html#SP8">&#167;8. readCharacterFromScreenAndCursorRight</a></li><li><a href="S-s9.html#SP9">&#167;9. terminateEdit</a></li><li><a href="S-s9.html#SP10">&#167;10. OSBYTE 132 - Read HIMEM (start of screen memory)</a></li><li><a href="S-s9.html#SP11">&#167;11. OSBYTE 133 - Read start of screen memory for given MODE</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. OSBYTE 135 - Read character at text cursor position. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte135EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte135EntryPoint</span></span>:<br/><a href="S-s9.html#SP8">&#167;8</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d7c2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduNumberOfLogicalColoursMinusOne</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">get number of logical colours for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP2" class="function-link"><span class="ACME-function-syntax">nonMODE7ReadCharacter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (MODE is not 7) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduWriteCursorScreenAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">read MODE 7 character from screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">Y=2</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP16" class="function-link"><span class="ACME-function-syntax">teletextCharacterConversionTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">compare with conversion table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not equal) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP16" class="function-link"><span class="ACME-function-syntax">teletextCharacterConversionTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">get previous byte from table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y-1</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (+ve) then branch (loop back and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">do it again)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">finishUpFX135</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">finishUpFX135</span></span>:<br/><a href="S-s9.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d7d7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduCurrentScreenMODE</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">Y = current screen MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X = character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. nonMODE7ReadCharacter. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">nonMODE7ReadCharacter</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">nonMODE7ReadCharacter</span></span>:<br/><a href="S-s9.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d7dc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP3" class="function-link"><span class="ACME-function-syntax">readCharacterDefinitionMaskFromScreen</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">read from screen, making a one bit</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">mask of 8 bytes to match against</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">each character, in workspaceA-H</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charSPACE</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">Start with the space character (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">counter)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readCharLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d7e1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Loop through each character in turn</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">looking to see if it matches</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">workspaceA-H</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Save character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s7.html#SP32" class="function-link"><span class="ACME-function-syntax">getCharacterDefinitionAddress</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">get character definition address for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">move to X</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">Y=7</span>
<span class="ACME-identifier-syntax">--</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduWorkspaceA</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get byte in workspaceA-H copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">check against character definition</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not the same) then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">skip to next character)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y--</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">--</span><span class="ACME-plain-syntax">                                              </span><span class="ACME-comment-syntax">if (still non-negative) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(back to loop eight times, to check</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">each row of the character)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">At this point the character matches</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charDELETE</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">but if it's the DELETE character</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then pretend we didn't match and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">carry on</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP1" class="function-link"><span class="ACME-function-syntax">finishUpFX135</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (we are NOT the DELETE character)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (to finish up)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">no match on this character so</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">increment to next character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Add 8 to address of character</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} definition to move on to the next</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #8                                              </span><span class="ACME-comment-syntax">} Affects low byte only as we check</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} one page of characters at a time</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (we have not reached the end of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the page) then branch (back to check</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the character)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP2" class="function-link"><span class="ACME-function-syntax">readCharLoop</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (character number not zero) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (loop back)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP1" class="function-link"><span class="ACME-function-syntax">finishUpFX135</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">ALWAYS branch (finish up)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Read character from screen pixels. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Reads 8x8 cell of pixels from the screen. This will be compared against each of the</span>
<span class="ACME-plain-syntax"> character definitions to determine which character is on screen. This is for the</span>
<span class="ACME-plain-syntax"> cursor editing mode feature.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readCharacterDefinitionMaskFromScreen</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">readCharacterDefinitionMaskFromScreen</span></span>:<br/><a href="S-s9.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d808</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">Y=7</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setupPatternLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d80a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">.vduTempStoreDA=Y (loop counter)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">A=1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDB</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">.vduTempStoreDB=A</span>
<span class="ACME-identifier-syntax">--</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduColourMaskLeft</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">A=left colour mask</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDC</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store in .vduTempStoreDC</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduWriteCursorScreenAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">get a byte from current text</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduBackgroundTextColour</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">EOR with text background colour</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDC</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">and check bits of colour mask</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (result = 0) then branch (this</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">becomes a zero bit in our mask)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry. This becomes a one bit in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">our mask</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDB</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">Rotate left and add the carry in the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">low bit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry now set; bit 7 originally</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">set) then branch (because we are</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">done:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">              the initial value of 1</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">has rotated through the 8 bits and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">into the carry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDC</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">shift mask right one place for the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">next pixel</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry clear; nothing shifted off</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the left) then branch (loop back)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">} Y = Y + 8 (Carry is set, so adding</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} 7 + carry = 8)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">--</span><span class="ACME-plain-syntax">                                              </span><span class="ACME-comment-syntax">if (no overflow from the add) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (loop back, move on to the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">next cell to read from)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">read modified values into Y and A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDB</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduWorkspaceA</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">and do it again</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP3" class="function-link"><span class="ACME-function-syntax">setupPatternLoop</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">until 8 bytes copied</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. Read pixel. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = VDU variable offset for the graphics coordinates to use.</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = current colour at the coordinate specified OR</span>
<span class="ACME-plain-syntax">       A = $FF if coordinate is out of bounds</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readPixel</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">readPixel</span></span>:<br/>Chapter 5: VDU and OSWORD routines - <a href="S-s5.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d839</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s8.html#SP17" class="function-link"><span class="ACME-function-syntax">plotConvertExternalAbsoluteCoordinatesToPixels</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">set up positional data</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP6" class="function-link"><span class="ACME-function-syntax">checkPointXInBoundsAndSetScreenAddresses</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">set a screen address after checking</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for window bounds</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">++</span><span class="ACME-plain-syntax">                                              </span><span class="ACME-comment-syntax">if (out of bounds) then branch (exit</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with A=$FF)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">get row of current graphics cell</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=A*2, Carry=bit 7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">.vduTempStoreDA=.vduTempStoreDA+2</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">+Carry,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">Carry=bit 7 of .vduTempStoreDA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduCurrentPlotByteMask</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">byte mask=byte mask*2 + Carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry set) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">restore .vduTempStoreDA with bit 7=0</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Z set) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">A=.vduTempStoreDA AND number of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">colours in current MODE -1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduNumberOfLogicalColoursMinusOne</span></a><span class="ACME-plain-syntax">              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-identifier-syntax">++</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$FF</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. Check the graphics point on the VDU queue is within the graphics window. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkParameterInBoundsAndSetScreenAddresses</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">checkParameterInBoundsAndSetScreenAddresses</span></span>:<br/>Chapter 8: PLOT - <a href="S-s8.html#SP13">&#167;13</a>, <a href="S-s8.html#SP46">&#167;46</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d85d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s8.html#SP1" class="function-link"><span class="ACME-function-syntax">vdu25ParameterXLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">X is the offset to the desired</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">parameter for the point in graphics</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Check the given point is within the graphics window. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Takes the graphics coordinates pointed to by X, checks whether they are in the bounds of</span>
<span class="ACME-plain-syntax"> the graphics window, and if so sets up screen addresses.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the vdu variables offset to the graphics point to check</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       .vduScreenAddressOfGraphicsCursorCellLow/High is the screen address</span>
<span class="ACME-plain-syntax">       Y is the vertical offset within the character cell (0-7)</span>
<span class="ACME-plain-syntax">       Z is clear (i.e. BNE will branch) if coordinates are outside the graphics area</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkPointXInBoundsAndSetScreenAddresses</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">checkPointXInBoundsAndSetScreenAddresses</span></span>:<br/><a href="S-s9.html#SP4">&#167;4</a><br/>Chapter 8: PLOT - <a href="S-s8.html#SP12">&#167;12</a>, <a href="S-s8.html#SP22">&#167;22</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d85f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s8.html#SP15" class="function-link"><span class="ACME-function-syntax">checkPointXIsWithinGraphicsWindow</span></a><span class="ACME-plain-syntax">              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (point is not in graphics window)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (exit)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setScreenAddress</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">setScreenAddress</span></span>:<br/>Chapter 8: PLOT - <a href="S-s8.html#SP22">&#167;22</a>, <a href="S-s8.html#SP65">&#167;65</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d864</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduGraphicsWindowPixelsBottomLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">read low byte of Y coordinate</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">Flip the coordinates to be from the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">top of the screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Remember in Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">A = row within a character cell</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduGraphicsCursorVerticalOffsetInCell</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">store row (0-7)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} divide by 8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Multiply by two to give the offset</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">in the multiplication table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y = offset into multiplication table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduMultiplicationTableLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">Get high byte of offset from screen</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">RAM start</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduMultiplicationTableLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">get low byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduCurrentScreenMODEGroup</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">check MODE group</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (zero, i.e. MODEs 0,1,2) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (skip this next bit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">} divide the offset by two</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduScreenTopLeftAddressLow</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">add the screen top left address (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">get high byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduScreenTopLeftAddressHigh</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">add with carry the screen top left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address (high)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellHigh</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduGraphicsWindowPixelsLeftHigh</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store x coordinate of point (high)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduGraphicsWindowPixelsLeftLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">get x coordinate of point (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get the horizontal X offset within</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the range of pixelsPerByte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">add the pixels per byte minus one,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">which offsets to (one more than) the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">start of the MODE mask table for the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP11" class="function-link"><span class="ACME-function-syntax">sixteenColourMODEMaskTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">read byte mask</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduCurrentPlotByteMask</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">Y=number of pixels per byte minus one</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">compare with 3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (MODE 1 or 5) then branch forward</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">++</span><span class="ACME-plain-syntax">                                              </span><span class="ACME-comment-syntax">if (MODE 0 or 4) then branch forward</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">} (A,.vduTempStoreDA) *= 2</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">} (A,.vduTempStoreDA) *= 2</span>
<span class="ACME-identifier-syntax">++</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$F8</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">clear bits 0-2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">add A/.vduTempStoreDA to screen</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">        </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellHigh</span></a><span class="ACME-plain-syntax">       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (result +ve) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduScreenSizeHighByte</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">and subtract screen memory size</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">making it wrap round</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellHigh</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduGraphicsCursorVerticalOffsetInCell</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">get line in graphics cell containing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current graphics</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">zeroAReturn</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">zeroAReturn</span></span>:<br/><a href="S-s9.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d8cb</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0 to set Z flag (valid result)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. splitIntoTwoCursors. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">splitIntoTwoCursors</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">splitIntoTwoCursors</span></span>:<br/>Chapter 14: Star commands - <a href="S-s14.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d8ce</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$A0</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$A0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">twosComplimentOfNumberOfBytesInVDUQueue</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">X=number of items in VDU queue</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP8" class="function-link"><span class="ACME-function-syntax">pullAndReturn2</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (not 0) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduStatusByte</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">check VDU status byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP8" class="function-link"><span class="ACME-function-syntax">pullAndReturn2</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (either VDU is disabled, or plot</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">to graphics cursor enabled) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (cursor editing mode enabled)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduLastCursorStartRegisterValue</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">get CRTC register start setting</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10011111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">clear bits 5 and 6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01000000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set bit 6 to modify last cursor size</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">setting</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP52" class="function-link"><span class="ACME-function-syntax">setCursorOnOrOff</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">change cursor format</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduTextCursorXPosition</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">source = text cursor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduTextInputCursorXCoordinate</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">   </span><span class="ACME-comment-syntax">destination = text input</span>
<span class="ACME-plain-syntax">                                                               </span><span class="ACME-comment-syntax">cursor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s8.html#SP40" class="function-link"><span class="ACME-function-syntax">copyTwoBytesWithinVDUVariables</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">set text input cursor from text</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">output cursor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s7.html#SP7" class="function-link"><span class="ACME-function-syntax">restoreWriteCursor</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">modify character at cursor position</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #2                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP14" class="function-link"><span class="ACME-function-syntax">setVDUStatusByteFlags</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">bit 1 of VDU status is set to bar</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">scrolling</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10111111</span><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP16" class="function-link"><span class="ACME-function-syntax">clearVDUStatusByteFlags</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">bit 6 of VDU status (separated</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">cursors) is set to zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Pull A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01111111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">clear high bit (7)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP2" class="function-link"><span class="ACME-function-syntax">vduChrEntryPoint</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">call VDU routine</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01000000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set bit six (separate cursors)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP14" class="function-link"><span class="ACME-function-syntax">setVDUStatusByteFlags</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">set separated cursors and return</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. readCharacterFromScreenAndCursorRight. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readCharacterFromScreenAndCursorRight</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">readCharacterFromScreenAndCursorRight</span></span>:<br/>Chapter 14: Star commands - <a href="S-s14.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d905</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00100000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A=$20</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">vduStatusByte</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP6" class="function-link"><span class="ACME-function-syntax">zeroAReturn</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (bit 6 clear; not in cursor</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">editing mode) then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP6" class="function-link"><span class="ACME-function-syntax">zeroAReturn</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (bit 5 set; graphics cursor</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">enabled) then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP1" class="function-link"><span class="ACME-function-syntax">osbyte135EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read a character from the screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP8" class="function-link"><span class="ACME-function-syntax">exit12</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (A = 0, i.e. failed to read) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP25" class="function-link"><span class="ACME-function-syntax">vdu9EntryPoint</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">perform cursor right</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullAndReturn2</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">pullAndReturn2</span></span>:<br/><a href="S-s9.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d916</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore A</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit12</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d917</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. terminateEdit. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> When editing a line with two cursors, pressing return terminates the edit.</span>
<span class="ACME-plain-syntax"> This clears the VDU status flags and restores the text cursor to normal.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">terminateEdit</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">terminateEdit</span></span>:<br/>Chapter 5: VDU and OSWORD routines - <a href="S-s5.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d918</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10111101</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP16" class="function-link"><span class="ACME-function-syntax">clearVDUStatusByteFlags</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">} clear bits 2 and 6 of VDU status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} (page scrolling; separated cursors)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s5.html#SP52" class="function-link"><span class="ACME-function-syntax">setTextCursor</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">set text cursor (CRTC hardware)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">continue processing as a RETURN</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. OSBYTE 132 - Read HIMEM (start of screen memory). </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte132EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte132EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d923</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduCurrentScreenMODE</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get current screen MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. OSBYTE 133 - Read start of screen memory for given MODE. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte133EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte133EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d926</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=MODE number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">keep it in range 0-7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=MODE number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP13" class="function-link"><span class="ACME-function-syntax">screenDisplayMemoryIndexTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">X = get screen RAM size index</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s4.html#SP14" class="function-link"><span class="ACME-function-syntax">screenMemoryStartHigh</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">A = high byte of start address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">X = 0 (low byte of result)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">systemAvailableRAM</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">get available RAM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP11" class="function-link"><span class="ACME-function-syntax">returnTheScreenAddress</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (32k available) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$3F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">AND A with $3F to bring into memory</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">range for a 16K BBC Micro</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #4                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP11" class="function-link"><span class="ACME-function-syntax">returnTheScreenAddress</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (MODE number &gt;= 4) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(to return the value)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">return zero (Model A can't display</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">MODEs 0-3)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">returnTheScreenAddress</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $d93e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y = high byte of screen address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s8.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresscurrent">9</li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s10.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

