<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 20: Filing System Messaging and Error Reporting</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><span class="unlink"><b>$F8A9</b>: chapter 20</span></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 20: Filing System Messaging and Error Reporting' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 20: Filing System Messaging and Error Reporting</b></li></ul></div>
<p class="purpose">Print progress; Prompt to record on tape; Print four byte hex; Check for ESCAPE during tape operations; Load block from tape; Print following message; Data? File? Block? error messages - 575 bytes (3.5%)</p>

<ul class="toc"><li><a href="S-s20.html#SP1">&#167;1. generateScreenReports</a></li><li><a href="S-s20.html#SP2">&#167;2. Display progress</a></li><li><a href="S-s20.html#SP3">&#167;3. Display Progress (post-filename)</a></li><li><a href="S-s20.html#SP4">&#167;4. Print four bytes from tape filing system block header</a></li><li><a href="S-s20.html#SP5">&#167;5. promptToRecordOnTape</a></li><li><a href="S-s20.html#SP6">&#167;6. Increment load or save address (by one page)</a></li><li><a href="S-s20.html#SP7">&#167;7. printSpaceThenHexByte</a></li><li><a href="S-s20.html#SP8">&#167;8. Print ASCII version of a hex value</a></li><li><a href="S-s20.html#SP9">&#167;9. printSpace</a></li><li><a href="S-s20.html#SP10">&#167;10. checkForEscapeDuringCassetteOperation</a></li><li><a href="S-s20.html#SP11">&#167;11. foundEscapeCondition</a></li><li><a href="S-s20.html#SP12">&#167;12. loadBlock</a></li><li><a href="S-s20.html#SP13">&#167;13. checksumOK</a></li><li><a href="S-s20.html#SP14">&#167;14. blockNumbersMatch</a></li><li><a href="S-s20.html#SP15">&#167;15. dontAbortOnError</a></li><li><a href="S-s20.html#SP16">&#167;16. safePrintFollowingMessage</a></li><li><a href="S-s20.html#SP17">&#167;17. Print the following message</a></li><li><a href="S-s20.html#SP18">&#167;18. compareFilenames</a></li><li><a href="S-s20.html#SP19">&#167;19. Filing System Data Errors</a></li><li><a href="S-s20.html#SP20">&#167;20. postFileError</a></li><li><a href="S-s20.html#SP21">&#167;21. waitForBlockToFinish</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. generateScreenReports. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">generateScreenReports</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">generateScreenReports</span></span>:<br/><a href="S-s20.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8a9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP1" class="function-link"><span class="ACME-function-syntax">newlineAndContinue</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (block number is zero) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (print newline and continue)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLastBlockReadFlagsCopy</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">copy of last read block flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP2" class="function-link"><span class="ACME-function-syntax">updateBlockFlagAndDisplayProgress</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">update block flag, PRINT filename</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(and address if required)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">newlineAndContinue</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">newlineAndContinue</span></span>:<br/><a href="S-s20.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8b6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP13" class="function-link"><span class="ACME-function-syntax">printReturnSafely</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">print newline if needed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Display progress. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">updateBlockFlagAndDisplayProgress</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">updateBlockFlagAndDisplayProgress</span></span>:<br/><a href="S-s20.html#SP1">&#167;1</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP23">&#167;23</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8b9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">reset data error flag to zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get block flag byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLastBlockReadFlagsCopy</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store as copy of last read block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP25" class="function-link"><span class="ACME-function-syntax">shouldPrintMessage</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">check if free to print message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">exit33</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (not safe to print messages) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">print just a carriage return, to return text cursor to the start of the current line</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">(without emitting a linefeed to go down to the next line)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">carriage return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSWRCH</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">print it (note no linefeed; so text</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">will overwrite any previous block's</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">message)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">display filename as printable characters, or '?' otherwise</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">filenameLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8cd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">get byte from filename (zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">terminated)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP3" class="function-link"><span class="ACME-function-syntax">filenameDone</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (filename is ended) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charSPACE</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP2" class="function-link"><span class="ACME-function-syntax">displayQuestionMark</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} if (control code found) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} branch (show '?')</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charDELETE</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">check for being less than DELETE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP2" class="function-link"><span class="ACME-function-syntax">displayPrintableCharacter</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">if (it's a printable character) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">displayQuestionMark</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8da</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charQUESTIONMARK</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">A='?'</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">displayPrintableCharacter</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8dc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSWRCH</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">and print it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP2" class="function-link"><span class="ACME-function-syntax">filenameLoop</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">ALWAYS branch (back to get rest of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">filename)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Display Progress (post-filename). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> John Kortink found a couple of bugs in the filing systems. See .</span><a href="S-s18.html#SP13" class="internal">reachedFinalBlock</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> The first is that in the ROM filing system, .tapeFileLengthLow / High only get set here</span>
<span class="ACME-plain-syntax"> if long messages are enabled, otherwise we early out of this routine. This means OSFILE</span>
<span class="ACME-plain-syntax"> can return an invalid size.</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s18.html#SP13" class="internal">reachedFinalBlock</a><span class="ACME-plain-syntax"> for more information</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">filenameDone</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">filenameDone</span></span>:<br/><a href="S-s20.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f8e2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system switch (0=cassette,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">2=ROM filing system)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (tape filing system active) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">check bit 6 of current options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">exit33</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (long messages not needed) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">print spaces after filename up to 11 characters total</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP9" class="function-link"><span class="ACME-function-syntax">printSpace</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">print a space</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #11                                             </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP3" class="function-link"><span class="ACME-function-syntax">filenameDone</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (Y&lt;11) then branch (loop again to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">fill out filename with spaces)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">print block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember block number in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">printHexByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">print hex byte as ASCII</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">block flag byte (bit 7 is 'last</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block' flag)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">exit33</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (not end of file) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">at this point we are on the last block of the file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">print the file length in hex</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall block number from X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">add block length high byte (to get</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">total file length high)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeFileLengthHigh</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">store as file length (high byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP7" class="function-link"><span class="ACME-function-syntax">printSpaceThenHexByte</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">print space then hex byte as ASCII</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">get block length (low byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeFileLengthLow</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">store as file length (low byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">printHexByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">print hex byte as ASCII</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">current options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">exit33</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (long messages not required) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">print four spaces</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">X=loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP9" class="function-link"><span class="ACME-function-syntax">printSpace</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">print a space</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">loop to print 4 spaces</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">display load address, a space, then executable address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLoadAddressHigh</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">X = offset to load address (high</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">printFourByteAddress</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">print 4 bytes from tape filing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">system block header</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP9" class="function-link"><span class="ACME-function-syntax">printSpace</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">print a space</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressHigh</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">X = offset to execution address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(high byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. Print four bytes from tape filing system block header. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is offset to high byte of address from .fsFilename</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printFourByteAddress</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">printFourByteAddress</span></span>:<br/><a href="S-s20.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f927</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">block header</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">printHexByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">print ASCII equivalent of hex byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit33</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">exit33</span></span>:<br/><a href="S-s20.html#SP2">&#167;2</a>, <a href="S-s20.html#SP3">&#167;3</a>, <a href="S-s20.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f933</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. promptToRecordOnTape. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">promptToRecordOnTape</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">promptToRecordOnTape</span></span>:<br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP18">&#167;18</a>, <a href="S-s18.html#SP30">&#167;30</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f934</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system flag 0=tape; 2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (tape filing system active) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">'Bad command error message'</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP14" class="function-link"><span class="ACME-function-syntax">zeroFileHandleAndMotorOn</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">switch motor on</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP21" class="function-link"><span class="ACME-function-syntax">setupForCassetteWrite</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">set up tape filing system for write</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">operation</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP25" class="function-link"><span class="ACME-function-syntax">shouldPrintMessage</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">check if free to print message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP4" class="function-link"><span class="ACME-function-syntax">exit33</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (not free to print message) exit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP16" class="function-link"><span class="ACME-function-syntax">safePrintFollowingMessage</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">print message following call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"RECORD then RETURN"</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>

<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP10" class="function-link"><span class="ACME-function-syntax">checkForEscapeDuringCassetteOperation</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">check for ESCAPE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSRDCH</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">wait for keypress</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">check for the RETURN key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not RETURN key) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(loop back to test again)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSNEWL</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">output Carriage RETURN and LINE FEED</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then return</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Increment load or save address (by one page). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Add a page onto the load address (.loadAddress) when loading,</span>
<span class="ACME-plain-syntax"> or save start address (.tapeSaveStartAddress) when saving.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">incrementLoadOrSaveAddress</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">incrementLoadOrSaveAddress</span></span>:<br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP12">&#167;12</a>, <a href="S-s18.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f96a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressMid1</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">increment page</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressMid2</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">increment higher bytes as needed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressHigh</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">increment higher bytes as needed</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. printSpaceThenHexByte. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printSpaceThenHexByte</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">printSpaceThenHexByte</span></span>:<br/><a href="S-s20.html#SP3">&#167;3</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f975</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP9" class="function-link"><span class="ACME-function-syntax">printSpace</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">print a space</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Print ASCII version of a hex value. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = value to print</span>
<span class="ACME-plain-syntax">       Preserves X and Y</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printHexByte</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">printHexByte</span></span>:<br/><a href="S-s20.html#SP3">&#167;3</a>, <a href="S-s20.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f97a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} divide by 16 to put high nybble in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">printHexDigit</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">print its ASCII equivalent</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printHexDigit</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f983</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00001111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">clear high nybble. A=0-15</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charZERO</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A = $30 to $3F</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charNINE</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">writeCharJumper</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">} if A &lt;= ASC('9') then print</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charA</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charNINE</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">) </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">Convert $3A-$3F to A=$41-$46 ('A' to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'F')</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">writeCharJumper</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">writeCharJumper</span></span>:<br/><a href="S-s20.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f98e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSWRCH</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">print character and return</span>

<span class="ACME-comment-syntax"> This routine could be three bytes smaller...</span>
<span class="ACME-comment-syntax">printHexByte</span>
<span class="ACME-comment-syntax">   PHA                                                 ; save A on stack</span>
<span class="ACME-comment-syntax">   LSR                                                 ; }</span>
<span class="ACME-comment-syntax">   LSR                                                 ; }</span>
<span class="ACME-comment-syntax">   LSR                                                 ; } divide by 16 to put high nybble</span>
<span class="ACME-comment-syntax">in low</span>
<span class="ACME-comment-syntax">   LSR                                                 ; }</span>
<span class="ACME-comment-syntax">   JSR .printHexDigit                                  ; print its ASCII equivalent</span>
<span class="ACME-comment-syntax">   PLA                                                 ; get back A</span>
<span class="ACME-comment-syntax">   AND #%00001111                                      ; just the lower nybble</span>
<span class="ACME-comment-syntax">printHexDigit</span>
<span class="ACME-comment-syntax">   SED                                                 ; set decimal mode</span>
<span class="ACME-comment-syntax">   CMP #10                                             ; }</span>
<span class="ACME-comment-syntax">   ADC #.charZERO                                      ; } decimal mode arithmetic trick</span>
<span class="ACME-comment-syntax">   CLD                                                 ; clear decimal mode</span>
<span class="ACME-comment-syntax">   JMP .OSWRCH                                         ; print character and return</span>

</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. printSpace. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printSpace</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">printSpace</span></span>:<br/><a href="S-s20.html#SP3">&#167;3</a>, <a href="S-s20.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f991</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charSPACE</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">A=' '</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP8" class="function-link"><span class="ACME-function-syntax">writeCharJumper</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">ALWAYS branch (to print it)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. checkForEscapeDuringCassetteOperation. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkForEscapeDuringCassetteOperation</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">checkForEscapeDuringCassetteOperation</span></span>:<br/><a href="S-s20.html#SP5">&#167;5</a>, <a href="S-s20.html#SP21">&#167;21</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP17">&#167;17</a>, <a href="S-s19.html#SP26">&#167;26</a>, <a href="S-s19.html#SP29">&#167;29</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f995</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCritical</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">first read tape critical flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP10" class="function-link"><span class="ACME-function-syntax">skipESCAPECheck</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (tape critical) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">escapeFlag</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP11" class="function-link"><span class="ACME-function-syntax">foundEscapeCondition</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">} if (ESCAPE condition found) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} branch</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipESCAPECheck</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f99e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. foundEscapeCondition. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">foundEscapeCondition</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">foundEscapeCondition</span></span>:<br/><a href="S-s20.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9a0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP21" class="function-link"><span class="ACME-function-syntax">clearCatalogueStatus</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">clear catalogue status</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP2" class="function-link"><span class="ACME-function-syntax">cancelTapeOperationAndMotor</span></a><span class="ACME-plain-syntax">                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #126                                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSBYTE</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">} Acknowledge ESCAPE condition</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">escapeError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9ab</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">cause error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$11</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error 17</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Escape"</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. loadBlock. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y = 0 for no messages</span>
<span class="ACME-plain-syntax">       otherwise show messages</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">loadBlock</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">loadBlock</span></span>:<br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP12">&#167;12</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9b4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP16" class="function-link"><span class="ACME-function-syntax">safePrintFollowingMessage</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">print message following call</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-string-syntax">"Loading"</span><span class="ACME-plain-syntax">,.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">message text</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">data error = zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">checksumIsValidFlag</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">Checksum result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP12" class="function-link"><span class="ACME-function-syntax">checkForChecksumError</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (checksum failed) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">check if we have the right filename</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP18" class="function-link"><span class="ACME-function-syntax">compareFilenames</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">check filename header block matches</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">searched filename.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">fileError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">fileError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">} YA is set to point to 'File?' error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP13" class="function-link"><span class="ACME-function-syntax">printNewlineThenReportError</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">if (filenames don't match) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (report a query unexpected</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">file name)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkForChecksumError</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">checkForChecksumError</span></span>:<br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP27">&#167;27</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9d9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">dataError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">making Y/A point to 'Data' for CRC</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">checksumIsValidFlag</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">Checksum result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP13" class="function-link"><span class="ACME-function-syntax">checksumOK</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">if (no checksum error) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">dataError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">point to dataError</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP13" class="function-link"><span class="ACME-function-syntax">printNewlineThenReportError</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">ALWAYS branch (to report issue)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. checksumOK. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checksumOK</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">checksumOK</span></span>:<br/><a href="S-s20.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9e3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockNumberLow</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">current block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP13" class="function-link"><span class="ACME-function-syntax">reportBlockError</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (block numbers low byte dont</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">match) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockNumberHigh</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">current block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP14" class="function-link"><span class="ACME-function-syntax">blockNumbersMatch</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (block numbers high byte matches)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">reportBlockError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9f1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">blockError</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">} an error has occurred</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">blockError</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">} point AY to 'Block?' error</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} (unexpected block number)</span>
<span class="ACME-plain-syntax">                                                        </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printNewlineThenReportError</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">printNewlineThenReportError</span></span>:<br/><a href="S-s20.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f9f5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save registers AYX on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP1" class="function-link"><span class="ACME-function-syntax">newlineAndContinue</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">print CR if indicated by current</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} restore XYA from stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP14" class="function-link"><span class="ACME-function-syntax">checkIfWeShouldShowError</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">ALWAYS branch (since the high byte</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of the error message address in A is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">never zero)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. blockNumbersMatch. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">blockNumbersMatch</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">blockNumbersMatch</span></span>:<br/><a href="S-s20.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa04</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP1" class="function-link"><span class="ACME-function-syntax">generateScreenReports</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">report</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP21" class="function-link"><span class="ACME-function-syntax">waitForBlockToFinish</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">wait for block to finish</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeChecksumLow</span></a><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeChecksumHigh</span></a><span class="ACME-plain-syntax">                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP18" class="function-link"><span class="ACME-function-syntax">exit34</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (checksum succeeded) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(exit)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">checksum error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">dataError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s20.html#SP19" class="function-link"><span class="ACME-function-syntax">dataError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">} AY points to 'Data?'</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkIfWeShouldShowError</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">checkIfWeShouldShowError</span></span>:<br/><a href="S-s20.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa18</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">set current block flag to $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCritical</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">read tape critical flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP14" class="function-link"><span class="ACME-function-syntax">tidyUpAndDisplayError</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (tape critical) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system flag 0=tape; 2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP14" class="function-link"><span class="ACME-function-syntax">tidyUpAndDisplayError</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (ROMFS) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00010001</span><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">current options (check for abort)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP15" class="function-link"><span class="ACME-function-syntax">dontAbortOnError</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (not abort on error) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tidyUpAndDisplayError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa2c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressHigh</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">store A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">store Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP10" class="function-link"><span class="ACME-function-syntax">closeSpoolOrExecFile</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">do *EXEC 0 to tidy up</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCritical</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">clear tape critical flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP1" class="function-link"><span class="ACME-function-syntax">beepAndCancelTapeOperation</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">bell, reset ACIA and motor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">)                       </span><span class="ACME-comment-syntax">display selected error report</span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. dontAbortOnError. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">dontAbortOnError</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">dontAbortOnError</span></span>:<br/><a href="S-s20.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa3c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get A from stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">} increment AY</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save AY on stack. This is the</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} (byte before) the error message</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} which will be printed by</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} .printFollowingMessage below</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. safePrintFollowingMessage. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">safePrintFollowingMessage</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="ACME-function-syntax">safePrintFollowingMessage</span></span>:<br/><a href="S-s20.html#SP5">&#167;5</a>, <a href="S-s20.html#SP12">&#167;12</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP13">&#167;13</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa46</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP25" class="function-link"><span class="ACME-function-syntax">shouldPrintMessage</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">check if free to print message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. Print the following message. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Prints the message at the address on the top of the stack (this is usually the</span>
<span class="ACME-plain-syntax"> return address, so represents the data that follows a JSR to this function).</span>
<span class="ACME-plain-syntax"> The alternative route here is that we fall through from .dontAbortOnError above, which</span>
<span class="ACME-plain-syntax"> has put the appropriate address on the stack.</span>

<span class="ACME-plain-syntax"> On returning from this routine, execution continues from the byte directly after the</span>
<span class="ACME-plain-syntax"> message.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       The top two bytes on the stack hold the address of the message - 1</span>
<span class="ACME-plain-syntax">       Y = zero means don't actually output the message</span>
<span class="ACME-plain-syntax">       otherwise print each character of the message using .OSASCI</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = 0</span>
<span class="ACME-plain-syntax">       Z is clear (not equal to zero)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printFollowingMessage</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="ACME-function-syntax">printFollowingMessage</span></span>:<br/><a href="S-s20.html#SP15">&#167;15</a>, <a href="S-s20.html#SP20">&#167;20</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP30">&#167;30</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa4a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">} get calling address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} and store it in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} .printMessageAddressLow/High</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressHigh</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y (used to set Z flag if Y=0)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save Z flag on stack</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressHigh</span></a><span class="ACME-plain-syntax">                        </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">get byte of message to print</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP17" class="function-link"><span class="ACME-function-syntax">printingFinished</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (terminator found) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(jump back to calling function after</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">message)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore flags from stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack again</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Z=1, i.e. don't output message)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (loop back to get next</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSASCI</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">print character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">jump back to get next character</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printingFinished</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa68</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">increment pointers</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressHigh</span></a><span class="ACME-plain-syntax">                        </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">printMessageAddressLow</span></a><span class="ACME-plain-syntax">)                       </span><span class="ACME-comment-syntax">return control to just after the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">error message</span>

</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. compareFilenames. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">compareFilenames</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="ACME-function-syntax">compareFilenames</span></span>:<br/><a href="S-s20.html#SP12">&#167;12</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP26">&#167;26</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa72</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkNextCharacter</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa74</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">filenameToSearchFor</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">get sought filename byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP18" class="function-link"><span class="ACME-function-syntax">checkCharacter</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (non zero) then branch (check</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">this character)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A = filename length</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (zero length) then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">A = filename byte</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkCharacter</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa81</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP29" class="function-link"><span class="ACME-function-syntax">isLetter</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">set carry if byte in A is NOT a</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">letter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">compare with filename character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry set, i.e. not a letter)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$DF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">convert to upper case</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP18" class="function-link"><span class="ACME-function-syntax">checkNextCharacter</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (zero, i.e. filename characters</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">match) then branch (check the next</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit34</span><button class="popup" onclick="togglePopup('usagePopup25')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup25">Usage of <span class="code-font"><span class="ACME-function-syntax">exit34</span></span>:<br/><a href="S-s20.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa8d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. Filing System Data Errors. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Note that these error routines are called if the abort flag is set in the current options.</span>
<span class="ACME-plain-syntax"> If the abort flag is not set, then the routine is not called, but by manipulating the</span>
<span class="ACME-plain-syntax"> address of the routine, the message contained within is printed and execution continues</span>
<span class="ACME-plain-syntax"> after the message. See .</span><a href="S-s20.html#SP14" class="internal">blockNumbersMatch</a><span class="ACME-plain-syntax"> for an example which executes .dontAbortOnError</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s20.html#SP15" class="internal">dontAbortOnError</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">dataError</span><button class="popup" onclick="togglePopup('usagePopup26')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup26">Usage of <span class="code-font"><span class="ACME-function-syntax">dataError</span></span>:<br/><a href="S-s20.html#SP12">&#167;12</a>, <a href="S-s20.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa8e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$D8</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">, </span><span class="ACME-string-syntax">"Data?"</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">postFileError</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">ALWAYs branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fileError</span><button class="popup" onclick="togglePopup('usagePopup27')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup27">Usage of <span class="code-font"><span class="ACME-function-syntax">fileError</span></span>:<br/><a href="S-s20.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fa99</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$DB</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">, </span><span class="ACME-string-syntax">"File?"</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">postFileError</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">ALWAYs branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">blockError</span><button class="popup" onclick="togglePopup('usagePopup28')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup28">Usage of <span class="code-font"><span class="ACME-function-syntax">blockError</span></span>:<br/><a href="S-s20.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $faa4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$DA</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">, </span><span class="ACME-string-syntax">"Block?"</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. postFileError. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">postFileError</span><button class="popup" onclick="togglePopup('usagePopup29')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup29">Usage of <span class="code-font"><span class="ACME-function-syntax">postFileError</span></span>:<br/><a href="S-s20.html#SP19">&#167;19</a><br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $faae</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">get current block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">skipRewindTapeMessage</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (zero) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">skipRewindTapeMessage</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (X == 0) then branch (no retry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00100010</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A=$22</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">check current options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">skipRewindTapeMessage</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (not retry) then branch (no retry)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">rewind tape</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP7" class="function-link"><span class="ACME-function-syntax">resetACIA</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">reset ACIA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP17" class="function-link"><span class="ACME-function-syntax">printFollowingMessage</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">print following message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">Carriage Return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charBELL</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">Beep</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Rewind tape"</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">Message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">, .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">Carriage Return, Carriage Return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                             </span><span class="ACME-comment-syntax">terminator</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit35</span><button class="popup" onclick="togglePopup('usagePopup30')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup30">Usage of <span class="code-font"><span class="ACME-function-syntax">exit35</span></span>:<br/><a href="S-s20.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fad2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipRewindTapeMessage</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fad3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP13" class="function-link"><span class="ACME-function-syntax">saveFlagsPrintCR</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">print CR if tape filing system not</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">critical</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. waitForBlockToFinish. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">waitForBlockToFinish</span><button class="popup" onclick="togglePopup('usagePopup31')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup31">Usage of <span class="code-font"><span class="ACME-function-syntax">waitForBlockToFinish</span></span>:<br/><a href="S-s20.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $fad6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsReadProgressState</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get progress state</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP20" class="function-link"><span class="ACME-function-syntax">exit35</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (zero) then branch (return)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP10" class="function-link"><span class="ACME-function-syntax">checkForEscapeDuringCassetteOperation</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">check for ESCAPE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system flag 0=tape; 2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP21" class="function-link"><span class="ACME-function-syntax">waitForBlockToFinish</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (tape filing system active) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (loop back)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP1" class="function-link"><span class="ACME-function-syntax">updateACIA</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">set up ACIA etc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP21" class="function-link"><span class="ACME-function-syntax">waitForBlockToFinish</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">loop back again</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s19.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresscurrent">20</li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s21.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

