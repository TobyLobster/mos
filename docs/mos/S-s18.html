<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 18: Tape and ROM Filing systems</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Downloads.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><span class="unlink"><b>$F135</b>: chapter 18</span></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 18: Tape and ROM Filing systems' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 18: Tape and ROM Filing systems</b></li></ul></div>
<p class="purpose">OSBYTE 140, 141, 143; OSARGS entry; OSFILE entry; OSFIND entry; OSBGET entry; OSBPUT entry; File system vector table; FSC entry point; Setup tape options; Load and save file; Copy filename; *RUN; *CAT; *OPT; Search for block; Open a file; Save a block to tape - 1107 bytes (6.7%)</p>

<ul class="toc"><li><a href="S-s18.html#SP1">&#167;1. The tape (and ROM) block format</a></li><li><a href="S-s18.html#SP2">&#167;2. OSBYTE 140 - Select TAPE file system, and OSBYTE 141 - Select ROM file system</a></li><li><a href="S-s18.html#SP3">&#167;3. Setup cassette options</a></li><li><a href="S-s18.html#SP4">&#167;4. Set tape baud</a></li><li><a href="S-s18.html#SP5">&#167;5. OSBYTE 143 - Pass service commands to sideways ROMs</a></li><li><a href="S-s18.html#SP6">&#167;6. OSARGS - Read or write a file's attributes</a></li><li><a href="S-s18.html#SP7">&#167;7. Filing system routine table</a></li><li><a href="S-s18.html#SP8">&#167;8. FSC - File System Control</a></li><li><a href="S-s18.html#SP9">&#167;9. *LOAD or *RUN a file</a></li><li><a href="S-s18.html#SP10">&#167;10. checkFileAttributes</a></li><li><a href="S-s18.html#SP11">&#167;11. File locked</a></li><li><a href="S-s18.html#SP12">&#167;12. checkAndSetEscapeEffect</a></li><li><a href="S-s18.html#SP13">&#167;13. Reached final block</a></li><li><a href="S-s18.html#SP14">&#167;14. retryAfterFailure</a></li><li><a href="S-s18.html#SP15">&#167;15. Copy filename from XY</a></li><li><a href="S-s18.html#SP16">&#167;16. terminateFilename</a></li><li><a href="S-s18.html#SP17">&#167;17. OSFILE</a></li><li><a href="S-s18.html#SP18">&#167;18. Save a file to tape</a></li><li><a href="S-s18.html#SP19">&#167;19. starRunEntryPoint</a></li><li><a href="S-s18.html#SP20">&#167;20. sendExecAddressToRunFromTube</a></li><li><a href="S-s18.html#SP21">&#167;21. starCatEntryPoint</a></li><li><a href="S-s18.html#SP22">&#167;22. Clear tape status bits</a></li><li><a href="S-s18.html#SP23">&#167;23. setTapeEOFStatus</a></li><li><a href="S-s18.html#SP24">&#167;24. Set tape status bits</a></li><li><a href="S-s18.html#SP25">&#167;25. Search for the next block, checking for Tape or ROM</a></li><li><a href="S-s18.html#SP26">&#167;26. searchForBlockReadHeaderAndCompare</a></li><li><a href="S-s18.html#SP27">&#167;27. Finish reading block and continue</a></li><li><a href="S-s18.html#SP28">&#167;28. OSFIND - Open or close a file</a></li><li><a href="S-s18.html#SP29">&#167;29. Open a file</a></li><li><a href="S-s18.html#SP30">&#167;30. Open a file for output</a></li><li><a href="S-s18.html#SP31">&#167;31. closeFileThatsOpenForOutput</a></li><li><a href="S-s18.html#SP32">&#167;32. saveSequentialAccessBlockToTape</a></li><li><a href="S-s18.html#SP33">&#167;33. OSBGET - get byte from file</a></li><li><a href="S-s18.html#SP34">&#167;34. eofErrorMessage</a></li><li><a href="S-s18.html#SP35">&#167;35. OSBPUT - Write a byte to file</a></li><li><a href="S-s18.html#SP36">&#167;36. *OPT X,Y</a></li><li><a href="S-s18.html#SP37">&#167;37. opt1</a></li><li><a href="S-s18.html#SP38">&#167;38. opt2</a></li><li><a href="S-s18.html#SP39">&#167;39. tapeSetInterblockGap</a></li><li><a href="S-s18.html#SP40">&#167;40. restoreDefaultOPTs</a></li><li><a href="S-s18.html#SP41">&#167;41. Tape opt byte table</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. The tape (and ROM) block format. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The cassette filing system uses a variant of the 1976 Kansas City standard.</span>
<span class="ACME-plain-syntax"> See </span><a href="https://en.wikipedia.org/wiki/Kansas_City_standard" class="external">https://en.wikipedia.org/wiki/Kansas_City_standard</a>

<span class="ACME-plain-syntax"> Tape signals are a sequence of binary tones, either 2400Hz (representing a set bit) or</span>
<span class="ACME-plain-syntax"> 1200Hz (representing a clear bit). These tones can be recorded and read at a speed of</span>
<span class="ACME-plain-syntax"> either 1200 baud or 300 baud.</span>

<span class="ACME-plain-syntax"> Files are stored on tape as a sequence of 'blocks', each holding (up to) 256 bytes of</span>
<span class="ACME-plain-syntax"> program data. The first block is written with a five second carrier tone (2400 Hz) at the</span>
<span class="ACME-plain-syntax"> start. Subsequent blocks start with a shorter carrier tone. Each block continues as</span>
<span class="ACME-plain-syntax"> follows:</span>

<span class="ACME-plain-syntax"> $2A               - synchronisation byte (%00101010 alternating ones and zeroes)</span>
<span class="ACME-plain-syntax">                   - (see .</span><a href="S-s2.html#SP9" class="internal">fsSynchronisationByte</a><span class="ACME-plain-syntax">)</span>
<span class="ACME-plain-syntax"> &lt;1 to 10 bytes&gt;   - filename</span>
<span class="ACME-plain-syntax"> $00               - filename terminator</span>
<span class="ACME-plain-syntax"> &lt;4 bytes&gt;         - load address</span>
<span class="ACME-plain-syntax"> &lt;4 bytes&gt;         - execution address</span>
<span class="ACME-plain-syntax"> &lt;2 bytes&gt;         - block number</span>
<span class="ACME-plain-syntax"> &lt;2 bytes&gt;         - block length</span>
<span class="ACME-plain-syntax"> &lt;1 byte&gt;          - block flag (bit 7 set for the final block; bit 0 means *RUN only)</span>
<span class="ACME-plain-syntax"> &lt;4 bytes&gt;         - TAPE: four $00 bytes (unused)</span>
<span class="ACME-plain-syntax">                   - ROMFS: address of end byte of file</span>
<span class="ACME-plain-syntax"> &lt;2 bytes&gt;         - CRC on header (all bytes before here except the synchronisation byte)</span>
<span class="ACME-plain-syntax"> &lt;0 to 256 bytes&gt;  - data</span>
<span class="ACME-plain-syntax"> &lt;2 bytes&gt;         - CRC on data (all data bytes)</span>

<span class="ACME-plain-syntax"> The ROM filing system uses a similar format of block, but with shortcuts to save ROM</span>
<span class="ACME-plain-syntax"> space. The first block is as above. Subsequent blocks just have a single byte header of</span>
<span class="ACME-plain-syntax"> $23. The end of all the ROM's data is marked with a single byte $2B.</span>

<span class="ACME-plain-syntax"> For an example of what the cassette sounds like, see </span><a href="http://playuef.8bitkick.cc" class="external">http://playuef.8bitkick.cc</a>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. OSBYTE 140 - Select TAPE file system, and OSBYTE 141 - Select ROM file system. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = 140 to select TAPE filing system</span>
<span class="ACME-plain-syntax">       A = 141 to select ROM filing system</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte140EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte140EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f135</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte141EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte141EntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP23">&#167;23</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f135</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #140                                            </span><span class="ACME-comment-syntax">A=0 for *TAPE; A=1 for *ROM</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setTapeOrROMFS</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">setTapeOrROMFS</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f137</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">double it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store it in filing system flag store</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">compare with 300 baud</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP4" class="function-link"><span class="ACME-function-syntax">setupTapeBaudRate</span></a><span class="ACME-plain-syntax">                              </span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Setup cassette options. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Called after power on, hard or soft BREAK.</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s2.html#SP11" class="internal">tapeOptionsByte</a><span class="ACME-plain-syntax"> for the details of the options.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Z set for 1200 baud</span>
<span class="ACME-plain-syntax">       Z clear for 300 baud</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setupTapeOptions</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">setupTapeOptions</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f140</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10100001</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set sequential access abort if</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">error, no messages</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeOptionsByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">set load/save retry if error, short</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">messages</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #25                                             </span><span class="ACME-comment-syntax">set interblock gap (2.5 seconds)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeSequentialAccessInterBlockGap</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">and store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. Set tape baud. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Z set for 300 baud</span>
<span class="ACME-plain-syntax">       Z clear for 1200 baud</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setupTapeBaudRate</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">setupTapeBaudRate</span></span>:<br/><a href="S-s18.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f14b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #6                                              </span><span class="ACME-comment-syntax">get close files command to FSCV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP13" class="function-link"><span class="ACME-function-syntax">passToCurrentFilingSystem</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">and FSCV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #6                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Z set on entry) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement X</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeBaudRate</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">set current baud rate: X=5 means</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">1200 baud; X=6 means 300 baud</span>


<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Reset the file based vectors (FILEV; ARGSV; BGETV; BPUTV; GBPBV; FINDV; FSCV) to default</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">values</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #14                                             </span><span class="ACME-comment-syntax">Loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP1" class="function-link"><span class="ACME-function-syntax">defaultFileSystemVectors</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorFILEV</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">} Reset vectors for file related</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} operations</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsReadProgressState</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">progress flag = 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallVectorsClaimed</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">set X to make a Paged ROM service</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">call 'Vectors Claimed'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">used after a new filing system</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">overwrites the current set of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">vectors.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. OSBYTE 143 - Pass service commands to sideways ROMs. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = command number, see .</span><a href="S-s2.html#SP7" class="internal">romServiceCallAbsoluteWorkspaceClaim</a>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = X = zero if a ROM chooses to handle the call; or 255 otherwise</span>
<span class="ACME-plain-syntax">       Y = result from ROM</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte143EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte143EntryPoint</span></span>:<br/>Chapter 7: Graphics cursor and soft character definitions - <a href="S-s7.html#SP2">&#167;2</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP18">&#167;18</a>, <a href="S-s10.html#SP19">&#167;19</a>, <a href="S-s10.html#SP22">&#167;22</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP2">&#167;2</a>, <a href="S-s11.html#SP12">&#167;12</a><br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP13">&#167;13</a><br/>Chapter 14: Star commands - <a href="S-s14.html#SP6">&#167;6</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a>, <a href="S-s15.html#SP24">&#167;24</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP20">&#167;20</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP30">&#167;30</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f168</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get current ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">command in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #15                                             </span><span class="ACME-comment-syntax">set X=15</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">send commands loop</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">romTypeTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">} read bit 7 of rom type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">romTypeTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">} which indicates if it has a</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} service routine</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  (all user ROMs except BASIC should</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">have a service routine)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not service routine) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(skips the BASIC ROM)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP26" class="function-link"><span class="ACME-function-syntax">romServiceEntry</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">and jump to the service entry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">on exit put A in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">romChecksFinished</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (zero, i.e. command recognised by</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">ROM) then branch (restore current</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">ROM selection and exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">point to next lower ROM</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">and go round loop again</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">romChecksFinished</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f186</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back original ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store it in Ram copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the original ROM into the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put X back in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. OSARGS - Read or write a file's attributes. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       In this default implementation, we only need to cover TAPE and ROM filing systems.</span>
<span class="ACME-plain-syntax">       We only implement A=0,Y=0, which returns the filing system number in A.</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = 0   no filing system present</span>
<span class="ACME-plain-syntax">       A = 1   1200 baud tape filing system</span>
<span class="ACME-plain-syntax">       A = 2   300 baud tape filing system</span>
<span class="ACME-plain-syntax">       A = 3   ROM filing system</span>

<span class="ACME-plain-syntax"> [ Note: Beyond the scope of this OS, implemented by optional Paged ROMs:</span>
<span class="ACME-plain-syntax">       A = 4   Disc file system</span>
<span class="ACME-plain-syntax">       A = 5   Econet (Networking) file system</span>
<span class="ACME-plain-syntax">       A = 6   Telesoftware (Teletext/Prestel) file system</span>
<span class="ACME-plain-syntax">       A = 7   IEEE filing system</span>
<span class="ACME-plain-syntax">       A = 8   ADFS filing system</span>
<span class="ACME-plain-syntax">       A = 9   Host filing system</span>
<span class="ACME-plain-syntax">       A = 10  Videodisc filing system</span>

<span class="ACME-plain-syntax"> See </span><a href="http://www.sprow.co.uk/bbc/library/fsids.txt" class="external">http://www.sprow.co.uk/bbc/library/fsids.txt</a><span class="ACME-plain-syntax"> for more filing system ids.</span>
<span class="ACME-plain-syntax"> ]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osargsEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">osargsEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f18e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP6" class="function-link"><span class="ACME-function-syntax">exit27</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (A != 0) then branch (return)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP6" class="function-link"><span class="ACME-function-syntax">exit27</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (Y != 0) then branch (return)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeBaudRate</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">get current baud rate:</span>
<span class="ACME-plain-syntax">                                                        </span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  1200 ; 300  ;  ROM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  baud ; baud ;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  tape ; tape ;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">    5  ;   6  ;   5</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">[Incidentally, this would do the same thing as below, but using four fewer bytes:</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">ORA .tapeOrROMSwitch                                    5  ;   6  ;   7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">AND #3                                                  1  ;   2  ;   3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">RTS]</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FB</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">    1  ;   2  ;   1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">    1  ;   2  ;   3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">    2  ;   4  ;   6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">    2  ;   4  ;   6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">    1  ;   2  ;   3</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit27</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">exit27</span></span>:<br/><a href="S-s18.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1a2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Filing system routine table. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The FSC routine (see below) jumps to the relevant address depending on the accumulator.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fileSystemControlRoutineTable</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">fileSystemControlRoutineTable</span></span>:<br/><a href="S-s18.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1a3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP36" class="function-link"><span class="ACME-function-syntax">starOptEntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">*OPT</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">checkEOFEntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">check EOF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP19" class="function-link"><span class="ACME-function-syntax">starRunEntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">*/</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">'Bad command' if ROMs and FS don't</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">want it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP19" class="function-link"><span class="ACME-function-syntax">starRunEntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">*RUN</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP21" class="function-link"><span class="ACME-function-syntax">starCatEntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">*CAT</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!word</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP6" class="function-link"><span class="ACME-function-syntax">osbyte119EntryPoint</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">osbyte 119 (close SPOOL and EXEC</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">files, to get ready for a new FS)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. FSC - File System Control. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry</span>
<span class="ACME-plain-syntax">       A is reason code. Only values 0-6 are handled:</span>

<span class="ACME-plain-syntax">         A=0    A *OPT command has been issued. X and Y are the 2 parameters</span>
<span class="ACME-plain-syntax">         A=1    EOF is being checked. On Entry: X=File handle On Exit: X=FF means EOF else 00</span>
<span class="ACME-plain-syntax">         A=2    A */ command has been issued</span>
<span class="ACME-plain-syntax">         A=3    An unrecognised OS command has been issued. X,Y point at command</span>
<span class="ACME-plain-syntax">         A=4    A *RUN command has been issued X,Y point at filename</span>
<span class="ACME-plain-syntax">         A=5    A *CAT cammand has been issued X,Y point to rest of command</span>
<span class="ACME-plain-syntax">         A=6    New filing system is about to take over. Close *SPOOL and *EXEC files</span>

<span class="ACME-plain-syntax"> Just for reference, these are not implemented in OS (to be implemented by Filing System</span>
<span class="ACME-plain-syntax"> Paged ROMs):</span>
<span class="ACME-plain-syntax">         A=7    return file handle range (X=minimum; Y=maximum)</span>
<span class="ACME-plain-syntax">         A=8    OS has received a star command</span>
<span class="ACME-plain-syntax">         A=9    *EX command</span>
<span class="ACME-plain-syntax">         A=10   *INFO</span>
<span class="ACME-plain-syntax">         A=11   *RUN command for library</span>
<span class="ACME-plain-syntax">         A=12   *RENAME command</span>

<span class="ACME-plain-syntax"> See NAUG Section 16.1.7, Page 256-7</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fscEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">fscEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a><br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP13">&#167;13</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1b1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP6" class="function-link"><span class="ACME-function-syntax">exit27</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">} if A&gt;=7 then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">save X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=A*2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=A to get offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP7" class="function-link"><span class="ACME-function-syntax">fileSystemControlRoutineTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">get high byte of address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP7" class="function-link"><span class="ACME-function-syntax">fileSystemControlRoutineTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">get low byte of address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">restore X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">this now jumps to (the address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">got from the table) + 1</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. *LOAD or *RUN a file. </b></p>

<p class="center-p"><img src="loading.png" alt="loading.png"></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A=0     *RUN the file</span>
<span class="ACME-plain-syntax">       A=$FF   *LOAD the named file and read its catalogue information</span>

<span class="ACME-plain-syntax"> See:</span>
</pre>
<div class="download-container">
	<p>
		<a href="LoadFromTape.pdf" download>
			<button class="download-button">
				<img src="../docs-assets/download.png" alt="download icon" height=16 width=16>
				Download <b>LoadFromTape.pdf</b> (Portable Document Format, 37.4kB)
			</button>
		</a>
	</p>
</div>


<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See:</span>
</pre>
<div class="download-container">
	<p>
		<a href="LoadFromROM.pdf" download>
			<button class="download-button">
				<img src="../docs-assets/download.png" alt="download icon" height=16 width=16>
				Download <b>LoadFromROM.pdf</b> (Portable Document Format, 36.9kB)
			</button>
		</a>
	</p>
</div>


<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">loadFile</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">loadFile</span></span>:<br/><a href="S-s18.html#SP17">&#167;17</a>, <a href="S-s18.html#SP19">&#167;19</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1c4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP6" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForLoadSave</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">claim serial system for cassette</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">we can't use the cassette and the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">RS-423 system at the same time</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">so we select the cassette here.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressLow</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">execution address low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP8" class="function-link"><span class="ACME-function-syntax">searchForFile</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">search for file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP10" class="function-link"><span class="ACME-function-syntax">checkFileAttributes</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (A = 0) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">X=3, loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$FF</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLoadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">get load address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">store it as current load address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">until all 4 bytes copied</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">[peculiarly, the code makes a special point to check for a load</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> address of $FFFFFFFF and signals an error if it occurs. Why?]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check if all the bytes of the load</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address are $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP10" class="function-link"><span class="ACME-function-syntax">checkFileAttributes</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (address is valid, i.e. not all</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">four bytes $FF) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(continue)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">handle error because load address is $FFFFFFFF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP1" class="function-link"><span class="ACME-function-syntax">beepAndCancelTapeOperation</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">sound bell, reset ACIA and motor off</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP5" class="function-link"><span class="ACME-function-syntax">brkBadAddress</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">show 'Bad address' error</span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. checkFileAttributes. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkFileAttributes</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">checkFileAttributes</span></span>:<br/><a href="S-s18.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1ed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry from bit 0 (file locked)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">checkAndSetEscapeEffect</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">if (A = 0) then branch (entry is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">from star run)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">loadOrRun</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (carry clear, i.e. not locked)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. File locked. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> A locked file is one with bit zero set on the block flag byte (see .</span><a href="S-s2.html#SP16" class="internal">fsBlockFlagByte</a><span class="ACME-plain-syntax">)</span>
<span class="ACME-plain-syntax"> Locked files can only be *RUN, not *LOADed. This is a form of copy protection on cassette</span>
<span class="ACME-plain-syntax"> tapes.</span>

<span class="ACME-plain-syntax"> See </span><a href="S-s18.html" class="internal">Chapter 18: Tape and ROM Filing systems</a><span class="ACME-plain-syntax"> for data format.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fileLocked</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">fileLocked</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f1f6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP2" class="function-link"><span class="ACME-function-syntax">cancelTapeOperationAndMotor</span></a><span class="ACME-plain-syntax">                    </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$D5</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Locked"</span><span class="ACME-plain-syntax">,0                                    </span><span class="ACME-comment-syntax">'Locked' error message and zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">terminator</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. checkAndSetEscapeEffect. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkAndSetEscapeEffect</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">checkAndSetEscapeEffect</span></span>:<br/><a href="S-s18.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f202</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">loadOrRun</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (carry clear) then branch (load)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">A=3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">escapeAndBreakEffect</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store to cause ESCAPE disable and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">memory clear on break</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">loadOrRun</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">loadOrRun</span></span>:<br/><a href="S-s18.html#SP10">&#167;10</a>, <a href="S-s18.html#SP14">&#167;14</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f209</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00110000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">check bits 4 and 5</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">See .</span><a href="S-s2.html#SP11" class="internal">tapeCurrentOptionsByte</a><span class="ACME-comment-syntax"> for description of the options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">check for 'ignore errors'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (ignore errors) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">checksumIsValidFlag</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get checksum result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">checksumFail</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (checksum failed) then branch</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP18" class="function-link"><span class="ACME-function-syntax">startSendToSecondProcessor</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">send to second processor if present</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP21" class="function-link"><span class="ACME-function-syntax">setStateForLoadingBlockDataOrReset</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">set state to read block data</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checksumFail</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f21d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP12" class="function-link"><span class="ACME-function-syntax">loadBlock</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">load block from tape</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP14" class="function-link"><span class="ACME-function-syntax">retryAfterFailure</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (not found) then branch (retry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP10" class="function-link"><span class="ACME-function-syntax">incrementBlockNumbers</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">increment current block number</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP13" class="function-link"><span class="ACME-function-syntax">reachedFinalBlock</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (bit 7 set, i.e. this is the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">final block) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP6" class="function-link"><span class="ACME-function-syntax">incrementLoadOrSaveAddress</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">increment current load address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP18" class="function-link"><span class="ACME-function-syntax">readBlockHeader</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">read block header</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">loadOrRun</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (non zero) then branch (loop back)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. Reached final block. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Stores the tape file length (low/high) and two zeros into the OSFILE parameter block. Note</span>
<span class="ACME-plain-syntax"> the bugs below though.</span>

<span class="ACME-plain-syntax"> John Kortink found a couple of bugs in this routine.</span>
<span class="ACME-plain-syntax"> See </span><a href="http://mdfs.net/Archive/BBCMicro/2006/10/14/174712.htm" class="external">http://mdfs.net/Archive/BBCMicro/2006/10/14/174712.htm</a>

<span class="ACME-plain-syntax"> People have unwittingly hit the second of these bugs:</span>
<span class="ACME-plain-syntax"> See </span><a href="https://stardot.org.uk/forums/viewtopic.php?f=54&t=13481" class="external">https://stardot.org.uk/forums/viewtopic.php?f=54&t=13481</a>
<span class="ACME-plain-syntax"> See </span><a href="http://www.retrosoftware.co.uk/forum/viewtopic.php?p=5687#p7655" class="external">http://www.retrosoftware.co.uk/forum/viewtopic.php?p=5687#p7655</a>

<span class="ACME-plain-syntax"> The first affects the ROM filing system only. In the previously executed .filenameDone</span>
<span class="ACME-plain-syntax"> routine (See .</span><a href="S-s20.html#SP3" class="internal">filenameDone</a><span class="ACME-plain-syntax">), the length of the file (.tapeFileLengthLow/High) only gets</span>
<span class="ACME-plain-syntax"> set if long messages are enabled, so the length returned from this routine may be wrong.</span>

<span class="ACME-plain-syntax"> The second (and more serious) affects both TAPE and ROM filing systems. The parameter block</span>
<span class="ACME-plain-syntax"> address (.osfileBlockAddressLow/High) is normally set up in .osfileEntryPoint</span>
<span class="ACME-plain-syntax"> (see .</span><a href="S-s18.html#SP17" class="internal">osfileEntryPoint</a><span class="ACME-plain-syntax">) but has not been set up if entered via a *RUN command. So four bytes</span>
<span class="ACME-plain-syntax"> of memory at an arbitrary address can be corrupted here! We may just about silently get away</span>
<span class="ACME-plain-syntax"> with it sometimes (cross fingers) if a previous OSFILE operation happens to have set them</span>
<span class="ACME-plain-syntax"> up to a benign value. For example, if we CHAIN a BASIC program first, then *RUN works.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">reachedFinalBlock</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">reachedFinalBlock</span></span>:<br/><a href="S-s18.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f232</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #10                                             </span><span class="ACME-comment-syntax">Y=10</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeFileLengthLow</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">file length counter low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">OSFILE parameter block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeFileLengthHigh</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">file length counter high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">OSFILE parameter block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">OSFILE parameter block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">OSFILE parameter block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">beepCancelAndPrintReturn</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">beepCancelAndPrintReturn</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP23">&#167;23</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f246</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP1" class="function-link"><span class="ACME-function-syntax">beepAndCancelTapeOperation</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">bell, reset ACIA and motor</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">printReturnSafely</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">printReturnSafely</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP13">&#167;13</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f249</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">current block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP13" class="function-link"><span class="ACME-function-syntax">exit28</span></a><span class="ACME-plain-syntax">                                         </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">saveFlagsPrintCR</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">saveFlagsPrintCR</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP18">&#167;18</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP20">&#167;20</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f24d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP16" class="function-link"><span class="ACME-function-syntax">safePrintFollowingMessage</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">print message following call (in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">this case a newline character)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charRETURN</span></a><span class="ACME-plain-syntax">, </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">message</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore flags from stack</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit28</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">exit28</span></span>:<br/><a href="S-s18.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f254</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. retryAfterFailure. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">retryAfterFailure</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">retryAfterFailure</span></span>:<br/><a href="S-s18.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f255</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP8" class="function-link"><span class="ACME-function-syntax">searchForSpecifiedBlock</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">search for a specified block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP12" class="function-link"><span class="ACME-function-syntax">loadOrRun</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">ALWAYS branch (try again)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. Copy filename from XY. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X and Y     source filename address (Low/High)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = 0</span>
<span class="ACME-plain-syntax">       The filename is copied into the buffer at .filenameToSearchFor</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">getFilenameFromXY</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="ACME-function-syntax">getFilenameFromXY</span></span>:<br/><a href="S-s18.html#SP17">&#167;17</a>, <a href="S-s18.html#SP19">&#167;19</a>, <a href="S-s18.html#SP29">&#167;29</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f25a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">stringInputBufferAddressLow</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">OS filename/command line pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">stringInputBufferAddressHigh</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">OS filename/command line pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP61" class="function-link"><span class="ACME-function-syntax">gsinitForFilenameParsing</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">initialise string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">X=0</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP63" class="function-link"><span class="ACME-function-syntax">gsreadEntryPoint</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">GSREAD call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP16" class="function-link"><span class="ACME-function-syntax">terminateFilename</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">if (end of character string) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP15" class="function-link"><span class="ACME-function-syntax">brkBadStringJumper</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (zero found) then break ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">string' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">filenameToSearchFor</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">store character in tape filename area</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #11                                             </span><span class="ACME-comment-syntax">check X with 11</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (X != 11) then branch (loop back)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">brkBadStringJumper</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="ACME-function-syntax">brkBadStringJumper</span></span>:<br/><a href="S-s18.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f274</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP64" class="function-link"><span class="ACME-function-syntax">brkBadString</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">Bad String error</span>

</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. terminateFilename. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">terminateFilename</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="ACME-function-syntax">terminateFilename</span></span>:<br/><a href="S-s18.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f277</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">terminate filename with 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">filenameToSearchFor</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. OSFILE. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> default handling for OSFILE (for cassette and ROM filing system)</span>

<span class="ACME-plain-syntax"> parameter block located by XY</span>
<span class="ACME-plain-syntax">   0-1     Address of Filename terminated by CR</span>
<span class="ACME-plain-syntax">   2-4     Load Address of File</span>
<span class="ACME-plain-syntax">   6-9     Execution Address of File</span>
<span class="ACME-plain-syntax">   10-13   Start address of data for write operations or length of file for read operations</span>
<span class="ACME-plain-syntax">   14-17   End address of Data (i.e. byte AFTER last byte to be written) or file attributes</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   Action is determined by value in A</span>

<span class="ACME-plain-syntax">   A=0     Save section of memory as named file, write catalogue information</span>
<span class="ACME-plain-syntax">   A=1     Write catalogue information for named file             (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=2     Write the LOAD       address (only) for the named File (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=3     Write the EXECUTION  address (only) for the named File (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=4     Write the ATTRIBUTES for the named File                (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=5     Read the catalogue information and put file type in A  (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=6     Delete the named file                                  (not supported in this FS)</span>
<span class="ACME-plain-syntax">   A=$FF   Load the named file and read its catalogue information</span>

<span class="ACME-plain-syntax">   XY = address of osfile block</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s18.html#SP18" class="internal">saveFileToTape</a><span class="ACME-plain-syntax"> for PDF showing the code path and how bytes are written to tape.</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s18.html#SP9" class="internal">loadFile</a><span class="ACME-plain-syntax"> for PDFs showing the code path and how bytes are read from tape and ROM.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osfileEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup25')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup25">Usage of <span class="code-font"><span class="ACME-function-syntax">osfileEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f27d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save action on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">osfile block pointer low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressHigh</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">osfile block pointer high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">get address of filename (low byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">get address of filename (high byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store in Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP15" class="function-link"><span class="ACME-function-syntax">getFilenameFromXY</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get filename from buffer at XY</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">Y=2</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">loop to copy load and execution addresses to .loadAddressLow</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">copy parameter block (load and exec</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">addresses)...</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLoadAddressLow</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">2,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">...     to .fsLoadAddressLow</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">loadAddressLow</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">2,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">... and to .loadAddressLow</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #10                                             </span><span class="ACME-comment-syntax">compare with limit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not done yet) then branch (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">get action code, and branch to save if A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A (action)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">saveFileToTape</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (A == 0) then branch (save file)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">if action is not $FF then exit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check A with 255</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP13" class="function-link"><span class="ACME-function-syntax">exit28</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (A != 255) then branch (exit,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">as cassette / ROM filing systems</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">have no other options)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">load a file from cassette or ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP9" class="function-link"><span class="ACME-function-syntax">loadFile</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">load file (with A=255; Y=0)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. Save a file to tape. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">   See </span><a href="S-s18.html" class="internal">Chapter 18: Tape and ROM Filing systems</a><span class="ACME-plain-syntax"> for Tape/ROM format.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = 0</span>
<span class="ACME-plain-syntax">       Y = 10 (offset in OSFILE Block)</span>

<span class="ACME-plain-syntax"> See:</span>
</pre>
<div class="download-container">
	<p>
		<a href="SaveToTape.pdf" download>
			<button class="download-button">
				<img src="../docs-assets/download.png" alt="download icon" height=16 width=16>
				Download <b>SaveToTape.pdf</b> (Portable Document Format, 31.3kB)
			</button>
		</a>
	</p>
</div>


<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">  for the code path and steps for writing to tape.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">saveFileToTape</span><button class="popup" onclick="togglePopup('usagePopup26')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup26">Usage of <span class="code-font"><span class="ACME-function-syntax">saveFileToTape</span></span>:<br/><a href="S-s18.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f2a7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">zero block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">zero block number high</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">copy start address, end address into zero page copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Note Y=10 (loop counter) at this point</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">osfileBlockAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">read from .OSFILE parameter block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressLow</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">10,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">store</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">data start and data end address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #10 </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">8</span><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">check for Y=18</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not finished) then branch (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP15" class="function-link"><span class="ACME-function-syntax">brkBadStringJumper</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (no filename found) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">('Bad string' error)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP6" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForLoadSave</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">claim serial system for load/save on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">cassette</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP5" class="function-link"><span class="ACME-function-syntax">promptToRecordOnTape</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">prompt to start recording</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0 (meaning read bytes from second</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">processor, aka:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">     'multiple single byte transfer:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">2nd processor to I/O processor')</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP18" class="function-link"><span class="ACME-function-syntax">secondProcessorTransfer</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">start transfer from 2nd processor</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(if present)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP20" class="function-link"><span class="ACME-function-syntax">setupForCassetteWrite</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">set up tape for write operation</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">saveToTapeLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f2c8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">calculate length to read</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FD</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X = loop counter (loops three times:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">X=$FD, $FE, $FF)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">loop to work out the amount of file remaining to save, to calculate block length</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">length = end address - current address</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveEndAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00FD</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">read end address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00FD</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">subtract current start address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$00FD</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">store at .fsBlockLengthLow/High and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.fsBlockFlagByte.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">we don't care about overwriting</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.fsBlockFlagByte with a length</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">calculation since we are about to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">set it anyway.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">at this point X = 0 (meaning by default it's not the last block, unless we overwrite X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">below)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">if high byte of length is non-zero, then save the full block length of $0100</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A (to set the zero flag if zero)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">setFullBlockLength</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (highest byte of subtracted value</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">is non zero) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">check the low and mid bytes of the length to see if this this the last block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">} compare X with zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$01</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">} calculate $0100 - block length</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">setFullBlockLength</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (fsBlockLength &gt;= $0100) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">yes, this is the last block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$80 (set last block flag)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">skipSettingBlockLength</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">ALWAYS branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setFullBlockLength</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f2e8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">} block length = $0100 (X=0 at this</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} point)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockLengthLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipSettingBlockLength</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f2f0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store the block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP23" class="function-link"><span class="ACME-function-syntax">saveABlockToTape</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">write block to tape</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP22" class="function-link"><span class="ACME-function-syntax">exit29</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (negative) then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP6" class="function-link"><span class="ACME-function-syntax">incrementLoadOrSaveAddress</span></a><span class="ACME-plain-syntax">                     </span><span class="ACME-comment-syntax">increment start save address by a</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">page</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">saveToTapeLoop</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (not 0) then branch (loop back</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">again)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP18" class="function-link"><span class="ACME-function-syntax">saveToTapeLoop</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">ALWAYS branch (since block number</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">high byte should never wrap around)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(loop back again)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. starRunEntryPoint. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starRunEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup27')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup27">Usage of <span class="code-font"><span class="ACME-function-syntax">starRunEntryPoint</span></span>:<br/><a href="S-s18.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f305</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP15" class="function-link"><span class="ACME-function-syntax">getFilenameFromXY</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get filename from buffer at XY</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressLow</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">store in low byte of execution</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP9" class="function-link"><span class="ACME-function-syntax">loadFile</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">load file (with A=0)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tubePresentFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check to see if Tube is present</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Tube is not present) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressMid2</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">execution address extend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressHigh</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">execution address extend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">check if all bits set</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP20" class="function-link"><span class="ACME-function-syntax">sendExecAddressToRunFromTube</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">if (top two bytes of exec address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">are not both $FF) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(execute on the Tube)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressLow</span></a><span class="ACME-plain-syntax">)                        </span><span class="ACME-comment-syntax">RUN file</span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. sendExecAddressToRunFromTube. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sendExecAddressToRunFromTube</span><button class="popup" onclick="togglePopup('usagePopup28')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup28">Usage of <span class="code-font"><span class="ACME-function-syntax">sendExecAddressToRunFromTube</span></span>:<br/><a href="S-s18.html#SP19">&#167;19</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f322</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressLow</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsExecutionAddressHigh</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">} point to execution address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">Tube service call 4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP18" class="function-link"><span class="ACME-function-syntax">secondProcessorCall</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">and issue to Tube to run file</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. starCatEntryPoint. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starCatEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup29')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup29">Usage of <span class="code-font"><span class="ACME-function-syntax">starCatEntryPoint</span></span>:<br/><a href="S-s18.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f32b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00001000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A=8 (set catalogue state)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP24" class="function-link"><span class="ACME-function-syntax">setTapeStatusBits</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">set ('OR' in) status bits</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP6" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForLoadSave</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">claim serial system for cassette</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0 (don't match filename and block</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">number)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP25" class="function-link"><span class="ACME-function-syntax">searchForBlockCheckFilingSystem</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">read data from tape/ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP2" class="function-link"><span class="ACME-function-syntax">cancelTapeOperation</span></a><span class="ACME-plain-syntax">                            </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">clearCatalogueStatus</span><button class="popup" onclick="togglePopup('usagePopup30')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup30">Usage of <span class="code-font"><span class="ACME-function-syntax">clearCatalogueStatus</span></span>:<br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP16">&#167;16</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f33b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%11110111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">clear bit 3 of file system status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit (catalogue status)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP22" class="paragraph-anchor"></a><b>&#167;22. Clear tape status bits. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A has the bits set that are to be cleared from the tape status byte</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X and Y preserved</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">clearTapeStatusBits</span><button class="popup" onclick="togglePopup('usagePopup31')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup31">Usage of <span class="code-font"><span class="ACME-function-syntax">clearTapeStatusBits</span></span>:<br/><a href="S-s18.html#SP29">&#167;29</a>, <a href="S-s18.html#SP31">&#167;31</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP16">&#167;16</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f33d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">storeTapeStatusByte</span><button class="popup" onclick="togglePopup('usagePopup32')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup32">Usage of <span class="code-font"><span class="ACME-function-syntax">storeTapeStatusByte</span></span>:<br/><a href="S-s18.html#SP24">&#167;24</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f33f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit29</span><button class="popup" onclick="togglePopup('usagePopup33')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup33">Usage of <span class="code-font"><span class="ACME-function-syntax">exit29</span></span>:<br/><a href="S-s18.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f341</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP23" class="paragraph-anchor"></a><b>&#167;23. setTapeEOFStatus. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setTapeEOFStatus</span><button class="popup" onclick="togglePopup('usagePopup34')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup34">Usage of <span class="code-font"><span class="ACME-function-syntax">setTapeEOFStatus</span></span>:<br/><a href="S-s18.html#SP29">&#167;29</a>, <a href="S-s18.html#SP33">&#167;33</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f342</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%01000000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set bit 6 of cassette status (EOF)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP24" class="paragraph-anchor"></a><b>&#167;24. Set tape status bits. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A has the bits set that are to be set on the tape status byte</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X and Y preserved</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setTapeStatusBits</span><button class="popup" onclick="togglePopup('usagePopup35')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup35">Usage of <span class="code-font"><span class="ACME-function-syntax">setTapeStatusBits</span></span>:<br/><a href="S-s18.html#SP21">&#167;21</a>, <a href="S-s18.html#SP29">&#167;29</a>, <a href="S-s18.html#SP30">&#167;30</a>, <a href="S-s18.html#SP33">&#167;33</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f344</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP22" class="function-link"><span class="ACME-function-syntax">storeTapeStatusByte</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">ALWAYS branch (store status byte)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP25" class="paragraph-anchor"></a><b>&#167;25. Search for the next block, checking for Tape or ROM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Used when loading a file or cataloguing a directory.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = $FF - must match the current filename and block number</span>
<span class="ACME-plain-syntax">       A = $00 - match anything (e.g. for catalogue)</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       V clear if final block</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">searchForBlockCheckFilingSystem</span><button class="popup" onclick="togglePopup('usagePopup36')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup36">Usage of <span class="code-font"><span class="ACME-function-syntax">searchForBlockCheckFilingSystem</span></span>:<br/><a href="S-s18.html#SP21">&#167;21</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f348</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system flag 0=Tape; 2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">searchForBlockReadHeaderAndCompare</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">if (tape filing system active) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">deal with search on ROM FS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s16.html#SP18" class="function-link"><span class="ACME-function-syntax">setInitialSpeechPHROMNumber</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">set current Filing System ROM/PHROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s16.html#SP19" class="function-link"><span class="ACME-function-syntax">readByteFromROMOrPHROM</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get byte from data ROM check type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">searchForBlockReadHeaderAndCompare</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">if (carry clear) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLV</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear overflow flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">pullAAndReturn</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">ALWAYS branch</span>
</pre>
<p class="commentary firstcommentary"><a id="SP26" class="paragraph-anchor"></a><b>&#167;26. searchForBlockReadHeaderAndCompare. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">searchForBlockReadHeaderAndCompare</span><button class="popup" onclick="togglePopup('usagePopup37')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup37">Usage of <span class="code-font"><span class="ACME-function-syntax">searchForBlockReadHeaderAndCompare</span></span>:<br/><a href="S-s18.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f359</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP18" class="function-link"><span class="ACME-function-syntax">readBlockHeader</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">read block header</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockNumberLow</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">current block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockNumberHigh</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">current block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLastBlockReadFlagsCopy</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">copy of last read block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentBlockHasDataErrorFlag</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">reset data error flag to zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">ALWAYS branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">searchForBlockLoop</span><button class="popup" onclick="togglePopup('usagePopup38')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup38">Usage of <span class="code-font"><span class="ACME-function-syntax">searchForBlockLoop</span></span>:<br/><a href="S-s18.html#SP27">&#167;27</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f370</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP10" class="function-link"><span class="ACME-function-syntax">incrementBlockNumbers</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">increment current block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP18" class="function-link"><span class="ACME-function-syntax">readBlockHeader</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">read block header</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get filing system flag 0=tape;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (tape filing system is active)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">pullAAndReturn</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (final block, on ROMFS) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit)</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A (match flag)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP27" class="function-link"><span class="ACME-function-syntax">finishReadingBlockAndContinue</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">if (A == 0, i.e. match anything)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP18" class="function-link"><span class="ACME-function-syntax">compareFilenames</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">check filename header block matches</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">searched Fn</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">messageAndFinishBlock</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (filenames don't match) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00110000</span><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">check bits 4/5 of current options,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">checking for 'ignore errors'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">pullAAndReturn</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (ignore errors) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">nextBlockNumberLow</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">next block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">messageAndFinishBlock</span></a><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">nextBlockNumberHigh</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">next block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">messageAndFinishBlock</span></a><span class="ACME-plain-syntax">                          </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullAAndReturn</span><button class="popup" onclick="togglePopup('usagePopup39')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup39">Usage of <span class="code-font"><span class="ACME-function-syntax">pullAAndReturn</span></span>:<br/><a href="S-s18.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f39a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">messageAndFinishBlock</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f39c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">filing system flag 0=tape; 2=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP27" class="function-link"><span class="ACME-function-syntax">finishReadingBlockAndContinue</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">if (tape filing system active) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipMessaging</span><button class="popup" onclick="togglePopup('usagePopup40')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup40">Usage of <span class="code-font"><span class="ACME-function-syntax">skipMessaging</span></span>:<br/><a href="S-s18.html#SP27">&#167;27</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3a1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s16.html#SP26" class="function-link"><span class="ACME-function-syntax">setROMOrPHROMAddress</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">set ROM address</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">resetBlockNumberAndContinue</span><button class="popup" onclick="togglePopup('usagePopup41')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup41">Usage of <span class="code-font"><span class="ACME-function-syntax">resetBlockNumberAndContinue</span></span>:<br/><a href="S-s18.html#SP27">&#167;27</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3a4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$FF to reset block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockNumberHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">searchForBlockLoop</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">ALWAYS branch</span>
</pre>
<p class="commentary firstcommentary"><a id="SP27" class="paragraph-anchor"></a><b>&#167;27. Finish reading block and continue. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       V set means reset file system state (occurs when reading the last block of a ROMFS file)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">finishReadingBlockAndContinue</span><button class="popup" onclick="togglePopup('usagePopup42')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup42">Usage of <span class="code-font"><span class="ACME-function-syntax">finishReadingBlockAndContinue</span></span>:<br/><a href="S-s18.html#SP26">&#167;26</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3ae</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (V clear) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$FF (searching)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP22" class="function-link"><span class="ACME-function-syntax">setCharAThenProgressState4OrReset</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">update to progress state 4 (if block</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">length &gt; 0)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">X=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP12" class="function-link"><span class="ACME-function-syntax">checkForChecksumError</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">report 'Data?' if necessary</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get current filing system</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (tape filing system) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeCurrentOptionsByte</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">check current options (bit 6)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">skipMessaging</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (no long messages) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(back)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsBlockFlagByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">block flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">resetBlockNumberAndContinue</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">if (-ve) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP26" class="function-link"><span class="ACME-function-syntax">searchForBlockLoop</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">ALWAYS branch (loop back and do it</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">again)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP28" class="paragraph-anchor"></a><b>&#167;28. OSFIND - Open or close a file. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> When opening a file, this returns a file handle ('channel') number:</span>

<span class="ACME-plain-syntax">   1 = input file on tape</span>
<span class="ACME-plain-syntax">   2 = output file on tape</span>
<span class="ACME-plain-syntax">   3 = input file from ROMFS</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A determines action</span>
<span class="ACME-plain-syntax">       Y may contain file handle (channel number)</span>
<span class="ACME-plain-syntax">       or XY is the address of the filename terminated by $0D</span>

<span class="ACME-plain-syntax">       A=0    closes file in channel Y; if Y = 0 closes all files</span>
<span class="ACME-plain-syntax">       A=$40  open a file for input  (reading) XY points to filename</span>
<span class="ACME-plain-syntax">       A=$80  open a file for output (writing) XY points to filename</span>
<span class="ACME-plain-syntax">       A=$C0  open a file for both input and output (random Access)</span>
<span class="ACME-plain-syntax">              (not supported by TAPE and ROM filing systems)</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = file handle of opened file or zero on error</span>
<span class="ACME-plain-syntax">       X,Y are preserved</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osfindEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup43')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup43">Usage of <span class="code-font"><span class="ACME-function-syntax">osfindEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3ca</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">save action in temporary store</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save X and Y on the stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">recall action</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP29" class="function-link"><span class="ACME-function-syntax">openAFile</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (A is non zero) then branch (open</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">a specific file)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">closeOneFile</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3d4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (A is not zero) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(close specified file)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP6" class="function-link"><span class="ACME-function-syntax">osbyte119EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">close all SPOOL/EXEC files using</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSBYTE 119</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP31" class="function-link"><span class="ACME-function-syntax">closeFileThatsOpenForOutput</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">close file open for output</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">shift right (bit zero into carry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">shift left (clear bit zero)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP28" class="function-link"><span class="ACME-function-syntax">finishWithError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (carry clear, i.e. no input file</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">open) then branch</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A contains file handle so shift bit</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">0 into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry set) then branch (close</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">input file)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">shift bit 1 into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP28" class="function-link"><span class="ACME-function-syntax">closeOutputFile</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (carry set) then branch (close</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">output file)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP17" class="function-link"><span class="ACME-function-syntax">channelError</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">report 'Channel error'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">as tape filing system can only</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">support one input and one output file</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">closeOutputFile</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3ec</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP31" class="function-link"><span class="ACME-function-syntax">closeFileThatsOpenForOutput</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">close file open for output</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">finishWithError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3ef</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">restoreRegistersAndExit</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">and exit</span>
</pre>
<p class="commentary firstcommentary"><a id="SP29" class="paragraph-anchor"></a><b>&#167;29. Open a file. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> A file is opened for input or output. The file handle ('channel') is returned in A.</span>

<span class="ACME-plain-syntax"> File handles returned:</span>
<span class="ACME-plain-syntax">   1 = input file on tape</span>
<span class="ACME-plain-syntax">   2 = output file on tape</span>
<span class="ACME-plain-syntax">   3 = input file from ROMFS</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       XY = address of zero terminated filename</span>
<span class="ACME-plain-syntax">       .fsTempStorage - action from .OSFIND (See .</span><a href="S-s18.html#SP28" class="internal">osfindEntryPoint</a><span class="ACME-plain-syntax">)</span>
<span class="ACME-plain-syntax">           bit 6 set to open for input</span>
<span class="ACME-plain-syntax">           bit 7 set to open for output</span>
<span class="ACME-plain-syntax">           (opening both for input and output is not supported on either tape or ROMFS)</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = file handle ('channel')</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">openAFile</span><button class="popup" onclick="togglePopup('usagePopup44')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup44">Usage of <span class="code-font"><span class="ACME-function-syntax">openAFile</span></span>:<br/><a href="S-s18.html#SP28">&#167;28</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f3f2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP15" class="function-link"><span class="ACME-function-syntax">getFilenameFromXY</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get filename from buffer at XY</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get action (OSFIND value of A on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">entry)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">openAFileForOutputOnly</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (bit 6 not set, i.e. it's to be</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">an output only file) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">open a file for input</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">it's an input file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bgetBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">BGET buffer offset for next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">nextBGETBlockLow</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">Expected BGET file block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">nextBGETBlockHigh</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">expected BGET file block number high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00111110</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP22" class="function-link"><span class="ACME-function-syntax">clearTapeStatusBits</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} clear 'input file open' bit; clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} 'EOF reached'; clear 'EOF warning</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} given'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP5" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForSequentialAccess</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">claim serial system and set OPTions</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP8" class="function-link"><span class="ACME-function-syntax">searchForFile</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">search for file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP12" class="function-link"><span class="ACME-function-syntax">checkLockedFlag</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check protection bit of block status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and respond</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=loop counter</span>

<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">copy file name character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bgetFilename</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">and store as BGET filename</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">until end of filename (zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">terminator)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00000001</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">A=1 to set bit for 'input file open'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP24" class="function-link"><span class="ACME-function-syntax">setTapeStatusBits</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">set status bit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeInputCurrentBlockSizeLow</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">tape filing system currently</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">resident file block length low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeInputCurrentBlockSizeHigh</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">tape filing system currently</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">resident file block length high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (block length is no zero) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP23" class="function-link"><span class="ACME-function-syntax">setTapeEOFStatus</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">set tape filing system status bit 6</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(EOF reached)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeOrROMSwitch</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">} get input file handle, 1 = tape;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} 3=ROMFS</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">returnAWithXYRestoredFromStack</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">ALWAYS branch (restore registers and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">exit)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP30" class="paragraph-anchor"></a><b>&#167;30. Open a file for output. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is length of filename</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">openAFileForOutputOnly</span><button class="popup" onclick="togglePopup('usagePopup45')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup45">Usage of <span class="code-font"><span class="ACME-function-syntax">openAFileForOutputOnly</span></span>:<br/><a href="S-s18.html#SP29">&#167;29</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f436</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (filename length is non-zero)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP64" class="function-link"><span class="ACME-function-syntax">brkBadString</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">output 'Bad String' error</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=$FF</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">copyFilenameLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f43e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">filenameToSearchFor</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">sought filename</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockHeaderStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">write it to BPUT file header block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">copyFilenameLoop</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">until A=0 (zero terminator at end of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">filename)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #8                                              </span><span class="ACME-comment-syntax">X=8</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockLoadAddressLow</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">set load and exec address to $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockNumberLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockHeaderStart</span></a><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">X=loop counter from $14 to $1E</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockHeaderStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">BPUT file header block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bgetBufferOffset</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockHeaderStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">this zeros BPUT block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockLengthHigh</span></a><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP6" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForLoadSave</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">claim serial system for cassette</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">load/save</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s20.html#SP5" class="function-link"><span class="ACME-function-syntax">promptToRecordOnTape</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">prompt to start recording</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP2" class="function-link"><span class="ACME-function-syntax">cancelTapeOperationAndMotor</span></a><span class="ACME-plain-syntax">                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00000010</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">} set the tape status bit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP24" class="function-link"><span class="ACME-function-syntax">setTapeStatusBits</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">} for 'output file open'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">A=2=file handle of (tape) file open</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for output</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">returnAWithXYRestoredFromStack</span><button class="popup" onclick="togglePopup('usagePopup46')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup46">Usage of <span class="code-font"><span class="ACME-function-syntax">returnAWithXYRestoredFromStack</span></span>:<br/><a href="S-s18.html#SP29">&#167;29</a>, <a href="S-s18.html#SP35">&#167;35</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f46f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store value of A temporarily</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">restoreRegistersAndExit</span><button class="popup" onclick="togglePopup('usagePopup47')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup47">Usage of <span class="code-font"><span class="ACME-function-syntax">restoreRegistersAndExit</span></span>:<br/><a href="S-s18.html#SP28">&#167;28</a>, <a href="S-s18.html#SP33">&#167;33</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f471</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Restore X and Y registers</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">recall temporary store into A</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit30</span><button class="popup" onclick="togglePopup('usagePopup48')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup48">Usage of <span class="code-font"><span class="ACME-function-syntax">exit30</span></span>:<br/><a href="S-s18.html#SP31">&#167;31</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f477</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP31" class="paragraph-anchor"></a><b>&#167;31. closeFileThatsOpenForOutput. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">closeFileThatsOpenForOutput</span><button class="popup" onclick="togglePopup('usagePopup49')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup49">Usage of <span class="code-font"><span class="ACME-function-syntax">closeFileThatsOpenForOutput</span></span>:<br/><a href="S-s18.html#SP28">&#167;28</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f478</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00000010</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">} clear all of tape status byte</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} except bit 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">exit30</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (output file not open) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">an output file is open</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockLengthHigh</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">setting block length to current</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">value of BPUT offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A=$80 (last block)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bputBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">get BPUT buffer offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockLengthLow</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">setting block length to current</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">value of BPUT offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockFlagByte</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">mark current block as last</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP32" class="function-link"><span class="ACME-function-syntax">saveSequentialAccessBlockToTape</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">save block to tape</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%11111101</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP22" class="function-link"><span class="ACME-function-syntax">clearTapeStatusBits</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} clear bit 1 of the tape status (no</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} file is open for output) and return</span>
</pre>
<p class="commentary firstcommentary"><a id="SP32" class="paragraph-anchor"></a><b>&#167;32. saveSequentialAccessBlockToTape. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Sequential access writes bytes instead of files. (As used by BGET and BPUT in BASIC).</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">saveSequentialAccessBlockToTape</span><button class="popup" onclick="togglePopup('usagePopup50')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup50">Usage of <span class="code-font"><span class="ACME-function-syntax">saveSequentialAccessBlockToTape</span></span>:<br/><a href="S-s18.html#SP31">&#167;31</a>, <a href="S-s18.html#SP35">&#167;35</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f496</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP5" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForSequentialAccess</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">claim serial system and set OPTions</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #17                                             </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockLoadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLoadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">} copy header block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">loop back until X=255</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">set load address to "FFFF0900"</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressMid2</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressHigh</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store $FF</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment X (to zero)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressLow</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">store $00</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$09</span><span class="ACME-plain-syntax">                                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeSaveStartAddressMid1</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store $09</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #(.</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockFilename</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">1) </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP15" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP13" class="function-link"><span class="ACME-function-syntax">copyToSoughtFilename</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">copy filename from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.tapeBlockFilename to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.filenameToSearchFor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">fsLastBlockReadFlagsCopy</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">set copy of last read block flag to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">zero</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP14" class="function-link"><span class="ACME-function-syntax">zeroFileHandleAndMotorOn</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">switch Motor On</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP20" class="function-link"><span class="ACME-function-syntax">setupForCassetteWrite</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">set up tape filing system for write</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">operation</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP23" class="function-link"><span class="ACME-function-syntax">saveABlockToTape</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">write block to tape</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">increment block number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockNumberLow</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">block number low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeBlockNumberHigh</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">block number high</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP33" class="paragraph-anchor"></a><b>&#167;33. OSBGET - get byte from file. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y contains channel number (file handle)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X and Y are preserved</span>
<span class="ACME-plain-syntax">       C=0 indicates valid character</span>
<span class="ACME-plain-syntax">       A contains character (or error) A=$FE End Of File</span>

<span class="ACME-plain-syntax"> See:</span>
</pre>
<div class="download-container">
	<p>
		<a href="LoadFromTape.pdf" download>
			<button class="download-button">
				<img src="../docs-assets/download.png" alt="download icon" height=16 width=16>
				Download <b>LoadFromTape.pdf</b> (Portable Document Format, 37.4kB)
			</button>
		</a>
	</p>
</div>


<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See:</span>
</pre>
<div class="download-container">
	<p>
		<a href="LoadFromROM.pdf" download>
			<button class="download-button">
				<img src="../docs-assets/download.png" alt="download icon" height=16 width=16>
				Download <b>LoadFromROM.pdf</b> (Portable Document Format, 36.9kB)
			</button>
		</a>
	</p>
</div>


<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbgetEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup51')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup51">Usage of <span class="code-font"><span class="ACME-function-syntax">osbgetEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f4c9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">A=1 (check file is open for reading)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP17" class="function-link"><span class="ACME-function-syntax">checkFileIsOpen</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check conditions for OSBGET are OK</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsStatusByte</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">tape/ROM FS status byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">shift bit 7 into carry (EOF warning</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">given)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP34" class="function-link"><span class="ACME-function-syntax">eofErrorMessage</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (carry set) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">shift bit 6 into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">notEOF</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (carry clear, i.e. EOF not</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">reached) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%10000000</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP24" class="function-link"><span class="ACME-function-syntax">setTapeStatusBits</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">} set bit 7 of status byte ('EOF</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} warning given')</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FE</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A = return value = $FE (end of file)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">storeFileStatus</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (carry set) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">notEOF</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f4e3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bgetBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">BGET buffer offset for next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeInputCurrentBlockSizeLow</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">tape filing system currently</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">resident file block length low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">readFromFSBufferAndContinue</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">if (not end of block) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(read a byte from buffer)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">blockFlagOfCurrentlyResidentBlock</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">block flag of currently resident</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">setEOF</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (this is the last block) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">lastCharacterOfCurrentlyResidentBlock</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">last character of currently resident</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP5" class="function-link"><span class="ACME-function-syntax">claimSerialSystemForSequentialAccess</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">claim serial system and set OPTions</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP12" class="function-link"><span class="ACME-function-syntax">bgetReadBlockAndHeader</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">read in a new block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store return value: last byte of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">blockFlagOfCurrentlyResidentBlock</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">block flag of currently resident</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">incrementAndFinish</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (not last block) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeInputCurrentBlockSizeLow</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">get block length</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">tapeInputCurrentBlockSizeHigh</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">OR with high byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">incrementAndFinish</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (block size not zero) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP23" class="function-link"><span class="ACME-function-syntax">setTapeEOFStatus</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">set tape filing system status bit 6</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(EOF reached)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP33" class="function-link"><span class="ACME-function-syntax">incrementAndFinish</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (not EOF) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setEOF</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f513</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP23" class="function-link"><span class="ACME-function-syntax">setTapeEOFStatus</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">set tape filing system status bit 6</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(EOF reached)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readFromFSBufferAndContinue</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f516</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X-1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBuffer</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">read byte from cassette buffer</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">storeFileStatus</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f51b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">fsTempStorage</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store return value temporarily</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">incrementAndFinish</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f51d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bgetBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">BGET buffer offset for next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">restoreRegistersAndExit</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">exit via .restoreRegistersAndExit</span>
</pre>
<p class="commentary firstcommentary"><a id="SP34" class="paragraph-anchor"></a><b>&#167;34. eofErrorMessage. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">eofErrorMessage</span><button class="popup" onclick="togglePopup('usagePopup52')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup52">Usage of <span class="code-font"><span class="ACME-function-syntax">eofErrorMessage</span></span>:<br/><a href="S-s18.html#SP33">&#167;33</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f523</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$DF</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"EOF"</span><span class="ACME-plain-syntax">,0                                       </span><span class="ACME-comment-syntax">string and zero terminator</span>
</pre>
<p class="commentary firstcommentary"><a id="SP35" class="paragraph-anchor"></a><b>&#167;35. OSBPUT - Write a byte to file. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is for the TAPE filing system only. The OS supplies filing system code for TAPE and</span>
<span class="ACME-plain-syntax"> ROM filing systems, and obviously you can't write into the ROM filing system.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y contains channel number (file handle)</span>
<span class="ACME-plain-syntax">       A contains byte to be written</span>

<span class="ACME-plain-syntax"> See .</span><a href="S-s18.html#SP18" class="internal">saveFileToTape</a><span class="ACME-plain-syntax"> for PDF showing the code path and how bytes are written to tape.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbputEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup53')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup53">Usage of <span class="code-font"><span class="ACME-function-syntax">osbputEntryPoint</span></span>:<br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP11">&#167;11</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f529</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeLastBputValue</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">store A in temporary store</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save XY on the stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">A=2 (meaning check file is open for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">writing)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP17" class="function-link"><span class="ACME-function-syntax">checkFileIsOpen</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check conditions necessary for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSBPUT are OK</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bputBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">BPUT buffer offset for next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeLastBputValue</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get back original value of A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423OutputBuffer</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">Write into cassette or RS-423 buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=X+1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not zero, buffer is not full)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP32" class="function-link"><span class="ACME-function-syntax">saveSequentialAccessBlockToTape</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">buffer is full so save block to tape</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s21.html#SP2" class="function-link"><span class="ACME-function-syntax">cancelTapeOperationAndMotor</span></a><span class="ACME-plain-syntax">                    </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">bputBufferOffset</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">BPUT buffer offset for next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeLastBputValue</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP30" class="function-link"><span class="ACME-function-syntax">returnAWithXYRestoredFromStack</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">and exit</span>
</pre>
<p class="commentary firstcommentary"><a id="SP36" class="paragraph-anchor"></a><b>&#167;36. *OPT X,Y. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>

<span class="ACME-plain-syntax">        X,Y</span>
<span class="ACME-plain-syntax">   *OPT 0,0  restore *OPT default message values</span>
<span class="ACME-plain-syntax">   *OPT 1,0  turn off filing system messages</span>
<span class="ACME-plain-syntax">   *OPT 1,1  turn on filing system messages (normal)</span>
<span class="ACME-plain-syntax">   *OPT 1,2  turn on filing system messages (extended)</span>
<span class="ACME-plain-syntax">   *OPT 2,0  ignore errors, though messages may be displayed</span>
<span class="ACME-plain-syntax">   *OPT 2,1  on error prompt for retry</span>
<span class="ACME-plain-syntax">   *OPT 2,2  on error, abort</span>
<span class="ACME-plain-syntax">   *OPT 3,n  set interblock gaps to n/10 seconds (for tape SAVE operations)</span>
<span class="ACME-plain-syntax">             if n&gt;127 then set default value</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starOptEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup54')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup54">Usage of <span class="code-font"><span class="ACME-function-syntax">starOptEntryPoint</span></span>:<br/><a href="S-s18.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f54d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP40" class="function-link"><span class="ACME-function-syntax">restoreDefaultOPTs</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (*OPT 0) then branch (set</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">defaults)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #3                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP39" class="function-link"><span class="ACME-function-syntax">tapeSetInterblockGap</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (*OPT 3) then branch (to set</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">interblock gap)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #3                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP36" class="function-link"><span class="ACME-function-syntax">issueBadCommand</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (Y &gt; 2) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP37" class="function-link"><span class="ACME-function-syntax">opt1</span></a><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">if (*OPT 1) then branch (set filing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">system message level)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP38" class="function-link"><span class="ACME-function-syntax">opt2</span></a><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">if (*OPT 2) then branch (response</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">level to errors)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">issueBadCommand</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f55e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">issue 'Bad command' error</span>

</pre>
<p class="commentary firstcommentary"><a id="SP37" class="paragraph-anchor"></a><b>&#167;37. opt1. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Set filing system message level</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">opt1</span><button class="popup" onclick="togglePopup('usagePopup55')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup55">Usage of <span class="code-font"><span class="ACME-function-syntax">opt1</span></span>:<br/><a href="S-s18.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f561</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00110011</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">set lower two bits of each nybble as</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">a MASK</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">this allows us to set the top two</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bits of each nybble (message type)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">still keep the existing values for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the bottom two bits</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of each nybble (ignore/retry/abort)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Y=Y+3 (offset into</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} .tapeOptByteTable)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP38" class="function-link"><span class="ACME-function-syntax">setOptWithMask</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">ALWAYS branch</span>
</pre>
<p class="commentary firstcommentary"><a id="SP38" class="paragraph-anchor"></a><b>&#167;38. opt2. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Set error levels</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">opt2</span><button class="popup" onclick="togglePopup('usagePopup56')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup56">Usage of <span class="code-font"><span class="ACME-function-syntax">opt2</span></span>:<br/><a href="S-s18.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f568</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%11001100</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">setting top two bits of each nybble</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">as a MASK</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">allows us to set the bottom two bits</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of each nybble (ignore/retry/abort)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">still keep the existing values for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the top two bits</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of each nybble (message type)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setOptWithMask</span><button class="popup" onclick="togglePopup('usagePopup57')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup57">Usage of <span class="code-font"><span class="ACME-function-syntax">setOptWithMask</span></span>:<br/><a href="S-s18.html#SP37">&#167;37</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f56a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=Y+1 (offset into .tapeOptByteTable)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeOptionsByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">keep bits set in MASK for keeping</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">current tape options</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">setOPTValueY</span><button class="popup" onclick="togglePopup('usagePopup58')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup58">Usage of <span class="code-font"><span class="ACME-function-syntax">setOPTValueY</span></span>:<br/><a href="S-s18.html#SP40">&#167;40</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f56d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP41" class="function-link"><span class="ACME-function-syntax">tapeOptByteTable</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">OR with table value to set new</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">options</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tapeOptionsByte</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP39" class="paragraph-anchor"></a><b>&#167;39. tapeSetInterblockGap. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tapeSetInterblockGap</span><button class="popup" onclick="togglePopup('usagePopup59')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup59">Usage of <span class="code-font"><span class="ACME-function-syntax">tapeSetInterblockGap</span></span>:<br/><a href="S-s18.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f573</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y (interblock gap)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (A &gt; 127) use default value</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP39" class="function-link"><span class="ACME-function-syntax">useGapDontUseDefaultValue</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">if (A != 0) then branch (don't use</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">default value)</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #25                                             </span><span class="ACME-comment-syntax">A=25 (2.5 seconds by default)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">useGapDontUseDefaultValue</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f57a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP16" class="function-link"><span class="ACME-function-syntax">tapeSequentialAccessInterBlockGap</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">sequential block gap</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP40" class="paragraph-anchor"></a><b>&#167;40. restoreDefaultOPTs. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">restoreDefaultOPTs</span><button class="popup" onclick="togglePopup('usagePopup60')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup60">Usage of <span class="code-font"><span class="ACME-function-syntax">restoreDefaultOPTs</span></span>:<br/><a href="S-s18.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f57e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP38" class="function-link"><span class="ACME-function-syntax">setOPTValueY</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">ALWAYS branch</span>
</pre>
<p class="commentary firstcommentary"><a id="SP41" class="paragraph-anchor"></a><b>&#167;41. Tape opt byte table. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Options are stored in top four bits (LOAD/SAVE) and bottom four bits (sequential access)</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s2.html#SP11" class="internal">tapeCurrentOptionsByte</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax">   bit 0/4 = Abort bit</span>
<span class="ACME-plain-syntax">   bit 1/5 = Retry bit</span>
<span class="ACME-plain-syntax">   bit 2/6 } Message type: 00 = no messages</span>
<span class="ACME-plain-syntax">   bit 3/7 }             : 10 = short messages</span>
<span class="ACME-plain-syntax">           }             : 11 = long messages</span>

<span class="ACME-plain-syntax"> 0000     Ignore errors         no messages</span>
<span class="ACME-plain-syntax"> 0001     Abort if error        no messages</span>
<span class="ACME-plain-syntax"> 0010     Retry after error     no messages</span>
<span class="ACME-plain-syntax"> 1000     Ignore error          short messages</span>
<span class="ACME-plain-syntax"> 1001     Abort if error        short messages</span>
<span class="ACME-plain-syntax"> 1010     Retry after error     short messages</span>
<span class="ACME-plain-syntax"> 1100     Ignore error          long messages</span>
<span class="ACME-plain-syntax"> 1101     Abort if error        long messages</span>
<span class="ACME-plain-syntax"> 1110     Retry after error     long messages</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">tapeOptByteTable</span><button class="popup" onclick="togglePopup('usagePopup61')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup61">Usage of <span class="code-font"><span class="ACME-function-syntax">tapeOptByteTable</span></span>:<br/><a href="S-s18.html#SP37">&#167;37</a>, <a href="S-s18.html#SP38">&#167;38</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP5">&#167;5</a>, <a href="S-s21.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $f581</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%10100001</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">default value:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">LOAD/SAVE: Retry; short messages</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">SEQUENTIAL: Abort; no messages</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%00000000</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">ignore error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%00100010</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">retry if error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%00010001</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">abort if error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%00000000</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">no messages</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%10001000</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">short messages</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">%11001100</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">long messages</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s17.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresscurrent">18</li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s19.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

