<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 14: Star commands</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><span class="unlink"><b>$E20E</b>: chapter 14</span></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$FF00</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 14: Star commands' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 14: Star commands</b></li></ul></div>
<p class="purpose">*LOAD; *SAVE; *SPOOL; *KEY; *FX; OSBYTE 119, 138, 145, 152, 153; Clear OSFILE address; Tables of buffer addresses; EVENT entry point; Remove from buffer (REMV); Insert into buffer (INSV) - 933 bytes (5.6%)</p>

<ul class="toc"><li><a href="S-s14.html#SP1">&#167;1. Clear four consecutive bytes in the OSFILE block</a></li><li><a href="S-s14.html#SP2">&#167;2. Shift one hex digit into an OSFILE address</a></li><li><a href="S-s14.html#SP3">&#167;3. *LOAD</a></li><li><a href="S-s14.html#SP4">&#167;4. *SAVE Entry (and *LOAD continued)</a></li><li><a href="S-s14.html#SP5">&#167;5. brkBadAddress</a></li><li><a href="S-s14.html#SP6">&#167;6. OSBYTE 119 - Close Spool / Exec files</a></li><li><a href="S-s14.html#SP7">&#167;7. *SPOOL</a></li><li><a href="S-s14.html#SP8">&#167;8. checkForErrorAndLoadFile</a></li><li><a href="S-s14.html#SP9">&#167;9. Read hex bytes into OSFILE address (start / end / load / exec address)</a></li><li><a href="S-s14.html#SP10">&#167;10. starSave</a></li><li><a href="S-s14.html#SP11">&#167;11. badCommandError</a></li><li><a href="S-s14.html#SP12">&#167;12. *KEY</a></li><li><a href="S-s14.html#SP13">&#167;13. *FX</a></li><li><a href="S-s14.html#SP14">&#167;14. Handle a range of star commands</a></li><li><a href="S-s14.html#SP15">&#167;15. Add a new *KEY string</a></li><li><a href="S-s14.html#SP16">&#167;16. Get *KEY string length</a></li><li><a href="S-s14.html#SP17">&#167;17. Compact *KEY strings</a></li><li><a href="S-s14.html#SP18">&#167;18. bufferAddressesHigh</a></li><li><a href="S-s14.html#SP19">&#167;19. bufferAddressesLow</a></li><li><a href="S-s14.html#SP20">&#167;20. emptyBufferStartOffset</a></li><li><a href="S-s14.html#SP21">&#167;21. Get buffer address</a></li><li><a href="S-s14.html#SP22">&#167;22. OSBYTE 152 - Examine buffer status</a></li><li><a href="S-s14.html#SP23">&#167;23. OSBYTE 145 - Get byte from buffer</a></li><li><a href="S-s14.html#SP24">&#167;24. REMV - default entry point for remove from/examine buffer vector</a></li><li><a href="S-s14.html#SP25">&#167;25. Trigger an event</a></li><li><a href="S-s14.html#SP26">&#167;26. generateEventAndPutByteIntoBuffer</a></li><li><a href="S-s14.html#SP27">&#167;27. OSBYTE 138 - Put byte into buffer</a></li><li><a href="S-s14.html#SP28">&#167;28. INSV - insert value into buffer - default handler</a></li><li><a href="S-s14.html#SP29">&#167;29. Check for a letter (A-Z or a-z)</a></li><li><a href="S-s14.html#SP30">&#167;30. insertByteIntoKeyboardBuffer</a></li><li><a href="S-s14.html#SP31">&#167;31. OSBYTE 153 - Put byte in input buffer</a></li><li><a href="S-s14.html#SP32">&#167;32. Handle cursor, COPY and soft keys for non-zero cursor editing type</a></li><li><a href="S-s14.html#SP33">&#167;33. errorOnReadingCharacterFromScreen</a></li><li><a href="S-s14.html#SP34">&#167;34. Read from input buffer X (0 = keyboard; 1 = RS-423)</a></li><li><a href="S-s14.html#SP35">&#167;35. Expand Soft Key (*KEY expansion)</a></li><li><a href="S-s14.html#SP36">&#167;36. handleCOPYkeyToReadCharacterFromScreen</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Clear four consecutive bytes in the OSFILE block. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The data required by the OSFILE call is stored at .osfileBlockStart, is 18 bytes long, and</span>
<span class="ACME-plain-syntax"> is as follows:</span>

<span class="ACME-plain-syntax">       byte      description</span>
<span class="ACME-plain-syntax">       0-1       address of filename</span>
<span class="ACME-plain-syntax">       2-5       load address</span>
<span class="ACME-plain-syntax">       6-9       execution address</span>
<span class="ACME-plain-syntax">       10-13     start address (or length)</span>
<span class="ACME-plain-syntax">       14-17     end address (or file attributes)</span>

<span class="ACME-plain-syntax"> This call clears one of these 4 byte addresses.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the start offset within the OSFILE block</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       Preserves A,X,Y</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">clearOSFILEAddress</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">clearOSFILEAddress</span></span>:<br/><a href="S-s14.html#SP4">&#167;4</a>, <a href="S-s14.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e20e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">clear osfile control block workspace</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">2</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">3</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Shift one hex digit into an OSFILE address. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Used as part of .readOSFILEAddress</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A contains hex digit 0-15</span>
<span class="ACME-plain-syntax">       X contains the offset into the .osfileBlockStart for the address to be updated</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       The four byte address at .osfileBlockStart+X is shifted four binary bits and the new</span>
<span class="ACME-plain-syntax">       digit is inserted at the least significant end.</span>
<span class="ACME-plain-syntax">       Preserves Y</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">shiftDigitIntoAddress</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">shiftDigitIntoAddress</span></span>:<br/><a href="S-s14.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e21f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">remember Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=A*2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">*4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">*8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">*16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">Y=loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=A*32</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">shift bit 7 of A into shift register</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">and</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">2</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">shift</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">3</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">along</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP5" class="function-link"><span class="ACME-function-syntax">brkBadAddress</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (carry set on exit, i.e. register</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">has overflowed) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Y &gt; 0) then branch (do another</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">shift)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">recall original Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. *LOAD. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       XY = address of rest of command line</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starLoad</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">starLoad</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e23c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">signal that load is being performed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. *SAVE Entry (and *LOAD continued). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A=0         for *SAVE</span>
<span class="ACME-plain-syntax">       A=non-zero  for *LOAD</span>
<span class="ACME-plain-syntax">       XY = address of rest of command line</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starLoadSave</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">starLoadSave</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e23e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">stringInputBufferAddressLow</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">store address of rest of command line</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">stringInputBufferAddressHigh</span></a><span class="ACME-plain-syntax">                   </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileFilenameAddressLow</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">X and Y are stored in OSfile control</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileFilenameAddressHigh</span></a><span class="ACME-plain-syntax">                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileLoadAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">X=2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP1" class="function-link"><span class="ACME-function-syntax">clearOSFILEAddress</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">clear the load address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">Y=255</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileExecAddressLow</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store $FF in exec address low byte</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">For a *LOAD (A=$FF) this byte (.osfileExecAddressLow) is used as a flag (it's available</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">since we don't need the executable address when just loading a file). Zero means use the</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">specified load address. Non-zero means use the load address from the file. This is</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">OSFILE behaviour.</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP61" class="function-link"><span class="ACME-function-syntax">gsinitForFilenameParsing</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">and call GSINIT to prepare for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">reading text line</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP63" class="function-link"><span class="ACME-function-syntax">gsreadEntryPoint</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">read a byte from text line</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">until end of line reached</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall original A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP10" class="function-link"><span class="ACME-function-syntax">starSave</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if (A=0, i.e. *SAVE) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">loading</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">readOSFILEAddress</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">read hex byte into start address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP8" class="function-link"><span class="ACME-function-syntax">checkForErrorAndLoadFile</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">if (success) then branch (load using</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSFILE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP8" class="function-link"><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">if (end of line found) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. brkBadAddress. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">brkBadAddress</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">brkBadAddress</span></span>:<br/><a href="S-s14.html#SP2">&#167;2</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP9">&#167;9</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e267</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FC</span><span class="ACME-plain-syntax">                                           </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Bad address"</span><span class="ACME-plain-syntax">, </span><span class="ACME-constant-syntax">0</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">error</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. OSBYTE 119 - Close Spool / Exec files. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte119EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte119EntryPoint</span></span>:<br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP7">&#167;7</a>, <a href="S-s18.html#SP28">&#167;28</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e275</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP7" class="function-link"><span class="ACME-function-syntax">romServiceCallSpoolExecClosureWarning</span></a><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">} let the paged ROMs know about</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s18.html#SP5" class="function-link"><span class="ACME-function-syntax">osbyte143EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} the closure of SPOOL/EXEC file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP7" class="function-link"><span class="ACME-function-syntax">exit19</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (a ROM accepts and closes it)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (return)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP10" class="function-link"><span class="ACME-function-syntax">closeSpoolOrExecFile</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">close the current file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">A=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. *SPOOL. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = 0 (and carry clear) to close the currently SPOOLed file, OR</span>
<span class="ACME-plain-syntax">       A = file handle to start SPOOLing</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       if closing a spooled file:</span>
<span class="ACME-plain-syntax">           A, X and Y are preserved</span>
<span class="ACME-plain-syntax">       if opening a spooled file:</span>
<span class="ACME-plain-syntax">          A = Y = file handle for spooled file</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starSpool</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">starSpool</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e281</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">remember Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">spoolFileHandle</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get file handle</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">spoolFileHandle</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store A as file handle</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (Y is zero) then branch (skip</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">forward)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSFIND</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">close the file using OSFIND</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">recall Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP7" class="function-link"><span class="ACME-function-syntax">exit19</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (A = 0 on entry) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(exit, we are done)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">A is value for 'open file for output'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSFIND</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">open file XY for output using OSFIND</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A=file handle for *SPOOLed file</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (result is zero) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">('Bad command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">spoolFileHandle</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store new file handle</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit19</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">exit19</span></span>:<br/><a href="S-s14.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e29f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. checkForErrorAndLoadFile. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkForErrorAndLoadFile</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">checkForErrorAndLoadFile</span></span>:<br/><a href="S-s14.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2a0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (not end of command line) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (show 'Bad command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileExecAddressLow</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">increment execution address low</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">byte to zero (when A=255 as OSFILE</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">parameter, zero means use specified</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span></span>:<br/><a href="S-s14.html#SP4">&#167;4</a>, <a href="S-s14.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2a5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #&lt;.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #&gt;.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">} XY = address of OSFILE parameter</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} block</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSFILE</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">and JUMP to OSFILE</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Read hex bytes into OSFILE address (start / end / load / exec address). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the offset to the address to write to</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       C set on success</span>
<span class="ACME-plain-syntax">       Z set if end of line found</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readOSFILEAddress</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="ACME-function-syntax">readOSFILEAddress</span></span>:<br/><a href="S-s14.html#SP4">&#167;4</a>, <a href="S-s14.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2ad</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP16" class="function-link"><span class="ACME-function-syntax">skipSpacesAndCheckForCRInStringInput</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">look for NEWline</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP22" class="function-link"><span class="ACME-function-syntax">readHexDigit</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">carry is set if it finds hex digit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">exit20</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">so exit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP1" class="function-link"><span class="ACME-function-syntax">clearOSFILEAddress</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">clear start address in OSFILE block</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP2" class="function-link"><span class="ACME-function-syntax">shiftDigitIntoAddress</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">shift lower nybble of A into shift</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">register</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP22" class="function-link"><span class="ACME-function-syntax">readHexDigit</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">then check for Hex digit</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (found digit) then branch (do it</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">again)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit20</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2c1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. starSave. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starSave</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="ACME-function-syntax">starSave</span></span>:<br/><a href="S-s14.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2c2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileStartAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">     </span><span class="ACME-comment-syntax">X=offset into OSFILE block to clear</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">start address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">readOSFILEAddress</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (no start address found) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit via 'Bad command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLV</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear bit 6</span>

<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">check for '+' to indicate a length rather than the end address</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">stringInputBufferAddressLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">read next byte from text line</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charPLUS</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">is it '+'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not '+') then branch (it's the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">end address)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">allBitsSet</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">set V flag (it's the length)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment Y to point to hex group</span>
<span class="ACME-identifier-syntax">+</span>

<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">read file length/end address from command line string</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileEndAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">X=offset into OSFILE block for end</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">readOSFILEAddress</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (carry clear, i.e. no hex byte</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">found) then branch ('Bad command'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP10" class="function-link"><span class="ACME-function-syntax">explicitEndAddressFound</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">if (V clear; i.e. explicit end</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address found; i.e. no '+') then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">add start address and length, and store as end address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FC</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">X=loop counter, from $FC</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">incrementing to $00 (4 bytes copied)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileStartAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FC</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">Get start address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">page2Start</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">add length</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">page2Start</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">store as end address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">loop until X=0</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">explicitEndAddressFound</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e2ed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #3                                              </span><span class="ACME-comment-syntax">X=loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileStartAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileExecAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileLoadAddressLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">} copy start adddress to load and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} execution addresses</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP8" class="function-link"><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">if (end of command line reached)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch to do OSFILE</span>

<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">read command line for execution address</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileExecAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">X=offset into OSFILE block for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">execution address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">readOSFILEAddress</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (error) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP8" class="function-link"><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">if (end of line reached) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(do OSFILE)</span>

<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">read command line for load address</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileLoadAddressLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">osfileBlockStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">X=offset into OSFILE block for load</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP9" class="function-link"><span class="ACME-function-syntax">readOSFILEAddress</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (error) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP8" class="function-link"><span class="ACME-function-syntax">callOSFILEWithParameterBlockForLoadSave</span></a><span class="ACME-plain-syntax">        </span><span class="ACME-comment-syntax">if (end of line) then branch (do</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSFILE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through... (anything else is an error!)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11" class="paragraph-anchor"></a><b>&#167;11. badCommandError. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">badCommandError</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="ACME-function-syntax">badCommandError</span></span>:<br/><a href="S-s14.html#SP7">&#167;7</a>, <a href="S-s14.html#SP8">&#167;8</a>, <a href="S-s14.html#SP10">&#167;10</a>, <a href="S-s14.html#SP13">&#167;13</a>, <a href="S-s14.html#SP14">&#167;14</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP7">&#167;7</a>, <a href="S-s18.html#SP36">&#167;36</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e310</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FE</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Bad command"</span><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">error string. The following BRK</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">instruction is also the zero</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">terminator for this string.</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">badKeyError</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="ACME-function-syntax">badKeyError</span></span>:<br/><a href="S-s14.html#SP12">&#167;12</a>, <a href="S-s14.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e31d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FB</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Bad key"</span><span class="ACME-plain-syntax">,0                                   </span><span class="ACME-comment-syntax">string with zero terminator</span>
</pre>
<p class="commentary firstcommentary"><a id="SP12" class="paragraph-anchor"></a><b>&#167;12. *KEY. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> The *KEY &lt;number&gt; &lt;string&gt; command defines one of 16 strings. These strings are associated</span>
<span class="ACME-plain-syntax"> with keys on the keyboard. When the key is pressed, the contents of the string are entered</span>
<span class="ACME-plain-syntax"> into the input buffer ('expanded'). These are also known as 'soft key' definitions.</span>

<span class="ACME-plain-syntax">       *KEY number     Definition</span>
<span class="ACME-plain-syntax">           0-9         Function keys f0-f9</span>
<span class="ACME-plain-syntax">            10         When BREAK is pressed, the contents of the string are played</span>
<span class="ACME-plain-syntax">            11         COPY key</span>
<span class="ACME-plain-syntax">            12         LEFT key</span>
<span class="ACME-plain-syntax">            13         RIGHT key</span>
<span class="ACME-plain-syntax">            14         DOWN key</span>
<span class="ACME-plain-syntax">            15         UP key</span>

<span class="ACME-plain-syntax"> Whether the soft keys are expanded is controlled by OSBYTE 225 (See .</span><a href="S-s2.html#SP14" class="internal">functionAndCursorKeyCodes</a><span class="ACME-plain-syntax">)</span>
<span class="ACME-plain-syntax"> For the COPY key and cursor keys to be expanded, they must also be enabled using OSBYTE 4</span>
<span class="ACME-plain-syntax"> with X = 2 (see .</span><a href="S-s15.html#SP50" class="internal">osbyte4EntryPoint</a><span class="ACME-plain-syntax">) which is translated into a call to OSBYTE 237, which</span>
<span class="ACME-plain-syntax"> updates memory location .cursorEditingType. (See .</span><a href="S-s2.html#SP14" class="internal">cursorEditingType</a><span class="ACME-plain-syntax">)</span>

<span class="ACME-plain-syntax"> Memory</span>
<span class="ACME-plain-syntax"> Soft key definitions are stored in $0B00-$0BFF (See .</span><a href="S-s2.html#SP22" class="internal">softKeyPage</a><span class="ACME-plain-syntax">). The first 16 bytes</span>
<span class="ACME-plain-syntax"> ($0B00-$0B0F) are a table of byte offsets from $0B01 to the start of the string definition</span>
<span class="ACME-plain-syntax"> for that soft key.</span>

<span class="ACME-plain-syntax"> The seventeenth byte (at $0B10) is the offset from $0B01 to the first free byte after all</span>
<span class="ACME-plain-syntax"> soft key definitions (See .</span><a href="S-s2.html#SP22" class="internal">softKeysCurrentEndOffset</a><span class="ACME-plain-syntax">). If a key has no definition, it's</span>
<span class="ACME-plain-syntax"> offset also points to the first free byte.</span>

<span class="ACME-plain-syntax"> The string definitions follow (with no terminators).</span>

<span class="ACME-plain-syntax"> When a new key is defined (or undefined using *KEY &lt;number&gt;) the existing strings are</span>
<span class="ACME-plain-syntax"> compacted (shuffled down in memory to leave no gaps) with the old definition removed so the</span>
<span class="ACME-plain-syntax"> new definition can be added on the end. (See .</span><a href="S-s14.html#SP17" class="internal">compactStarKeyStrings</a><span class="ACME-plain-syntax">). Thus the string</span>
<span class="ACME-plain-syntax"> definitions always appear in memory in the order they are defined, with the latest *KEY</span>
<span class="ACME-plain-syntax"> definition showing last.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   Y = offset to source string of command line</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starKey</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="ACME-function-syntax">starKey</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e327</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP18" class="function-link"><span class="ACME-function-syntax">parseDecimalNumberFromString</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">set up key number in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badKeyError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (not valid number) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">('Bad key' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">compare key number with 16</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badKeyError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (key number is 16 or more) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch ('Bad key' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP17" class="function-link"><span class="ACME-function-syntax">skipSpacesAndCommaValid</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">skip commas, and check for CR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags for later (remember Z =</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">CR found)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeysCurrentEndOffset</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get pointer to top of existing key</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">strings</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save Y to preserve text pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP17" class="function-link"><span class="ACME-function-syntax">compactStarKeyStrings</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">compact soft key definitions</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} restore Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore flags (recalls Z = CR found)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP15" class="function-link"><span class="ACME-function-syntax">addStarKeyString</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (CR not found) then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">set up new string)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">return (sets empty string)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP13" class="paragraph-anchor"></a><b>&#167;13. *FX. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> This is the entry point for the OSCLI call to execute "*FX &lt;A&gt;,&lt;X&gt;,&lt;Y&gt;". We parse the first</span>
<span class="ACME-plain-syntax"> numeric parameter ('A') then fall through to the version that parses a range of other star</span>
<span class="ACME-plain-syntax"> commands with 'X' and 'Y' parameters, each implemented with an OSBYTE call.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">fxEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="ACME-function-syntax">fxEntryPoint</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e342</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP18" class="function-link"><span class="ACME-function-syntax">parseDecimalNumberFromString</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">convert the number to binary</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (bad number) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put the parsed first parameter in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP14" class="paragraph-anchor"></a><b>&#167;14. Handle a range of star commands. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = $88     *CODE</span>
<span class="ACME-plain-syntax">       A = $89     *MOTOR</span>
<span class="ACME-plain-syntax">       A = $8B     *OPT</span>
<span class="ACME-plain-syntax">       A = $8C     *TAPE</span>
<span class="ACME-plain-syntax">       A = $8D     *ROM</span>
<span class="ACME-plain-syntax">       A = $90     *TV</span>
<span class="ACME-plain-syntax">       A = any     *FX     (when falling through from .fxEntryPoint above)</span>

<span class="ACME-plain-syntax"> Parses star commands with one or two numeric (0-255) parameters 'X' and 'Y' (space and/or</span>
<span class="ACME-plain-syntax"> comma separated) then calls OSBYTE with A as above.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">starCommandsForSpecificOSBYTEs</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="ACME-function-syntax">starCommandsForSpecificOSBYTEs</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e348</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandXParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">} clear the X/Y parameters for the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} upcoming OSBYTE call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandYParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP17" class="function-link"><span class="ACME-function-syntax">skipSpacesAndComma</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">skip commas and check for newline</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(CR)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP14" class="function-link"><span class="ACME-function-syntax">parsedParameters</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (CR found) then branch (to call</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">appropriate OSBYTE)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP18" class="function-link"><span class="ACME-function-syntax">parseDecimalNumberFromString</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">parse first parameter (X Parameter</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for OSBYTE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (bad character) then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">give bad command error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandXParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">store as X parameter for OSBYTE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP17" class="function-link"><span class="ACME-function-syntax">skipSpacesAndCommaValid</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">skip comma and check CR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP14" class="function-link"><span class="ACME-function-syntax">parsedParameters</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">if (CR found) then branch (to call</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">appropriate OSBYTE)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP18" class="function-link"><span class="ACME-function-syntax">parseDecimalNumberFromString</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">parse second parameter (Y Parameter</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for OSBYTE)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (error) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandYParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">store as Y parameter for OSBYTE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP16" class="function-link"><span class="ACME-function-syntax">skipSpacesAndCheckForCRInStringInput</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">now we must have a CR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (no CR) then branch ('Bad</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">command' error)</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">parsedParameters</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e36c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandYParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">Y = OSBYTE parameter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">starCommandXParameter</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">X = OSBYTE parameter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A = OSBYTE parameter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP6" class="function-link"><span class="ACME-function-syntax">OSBYTE</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">call OSBYTE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badCommandError</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">if (V set on return) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">('Bad command' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP15" class="paragraph-anchor"></a><b>&#167;15. Add a new *KEY string. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See .</span><a href="S-s14.html#SP12" class="internal">starKey</a><span class="ACME-plain-syntax">.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">addStarKeyString</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="ACME-function-syntax">addStarKeyString</span></span>:<br/><a href="S-s14.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e377</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry (meaning: check for '"'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">marks around string)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP62" class="function-link"><span class="ACME-function-syntax">gsinitEntryPoint</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">start reading string</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">copy string into *KEY buffer</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP63" class="function-link"><span class="ACME-function-syntax">gsreadEntryPoint</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">read string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (end of string reached) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (deal with end of string)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">point to first byte of new key</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">definition</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badKeyError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (X=0, i.e. buffer overflow) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit with 'Bad Key' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store character</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not end of line) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(loop to copy next byte)</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP11" class="function-link"><span class="ACME-function-syntax">badKeyError</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (parsing error) then branch (show</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'Bad Key' error)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP17" class="function-link"><span class="ACME-function-syntax">compactStarKeyStrings</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">compact *KEY definitions with the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">stored string definition</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Update the array of offsets that point to the start of each string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$10</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">set loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">check for key already being defined</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP15" class="function-link"><span class="ACME-function-syntax">skipRestOfLoop</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (key already being defined) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (skip rest of loop)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get start of string X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">compare with start of string Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP15" class="function-link"><span class="ACME-function-syntax">skipRestOfLoop</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (not the same) then branch (skip</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">rest of loop)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeysCurrentEndOffset</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">store top of string definition</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">in designated key pointer</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipRestOfLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e3a3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">decrement loop pointer X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">and do it all again</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP16" class="paragraph-anchor"></a><b>&#167;16. Get *KEY string length. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Get the length of a soft key definition. See .</span><a href="S-s14.html#SP12" class="internal">starKey</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y = *KEY number</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A = string length</span>
<span class="ACME-plain-syntax">       Preserves X</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">getStarKeyStringLength</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="ACME-function-syntax">getStarKeyStringLength</span></span>:<br/><a href="S-s14.html#SP17">&#167;17</a>, <a href="S-s14.html#SP35">&#167;35</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e3a8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeysCurrentEndOffset</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get top of currently defined strings</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">subtract to get the number of bytes</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">in strings above end of string Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store this</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$10</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">and X=16</span>

<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get start offset (from .softKeyPage)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of key string X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">subtract offset of string we are</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">working on</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry clear, i.e. .softKeyPage+Y</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">&gt; .softKeyPage+X) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(forward)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (result in A=0) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(forward)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">check against number of bytes above</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">string we are working on</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (&gt;= number of bytes above string</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">we are working on) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store A in .tempStoreFB</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">point to next lower key offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not negative) then branch (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back and do it again)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back value of X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">get back latest value of A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP17" class="paragraph-anchor"></a><b>&#167;17. Compact *KEY strings. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Remove an existing definition, and move the remaining definitions down in memory (so that</span>
<span class="ACME-plain-syntax"> we can add a new definition on the end).</span>
<span class="ACME-plain-syntax"> See .</span><a href="S-s14.html#SP12" class="internal">starKey</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       .tempWorkspaceE6 = key number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X is preserved</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">compactStarKeyStrings</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="ACME-function-syntax">compactStarKeyStrings</span></span>:<br/><a href="S-s14.html#SP12">&#167;12</a>, <a href="S-s14.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e3d1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get key number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP16" class="function-link"><span class="ACME-function-syntax">getStarKeyStringLength</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">and set up .tempStoreFB to length of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">existing string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get start of string Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put it in Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">add number of bytes for existing</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X = new end position</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">and store it in .tempStoreFA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyStringLength</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">check to see if we are already</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">defining a *KEY string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (key is not already being</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">defined) branch</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">keyInUseError</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e3e9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BRK</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">definition expanded) so error.  This</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">stops *KEY 1 "*key1 FRED" etc.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$FA</span><span class="ACME-plain-syntax">                                           </span><span class="ACME-comment-syntax">error number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Key in use"</span><span class="ACME-plain-syntax">,0                                </span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyConsistencyFlag</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">decrement consistency flag to $FF to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">warn that key definitions are being</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">changed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">subtract .tempStoreFA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">and re store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (zero) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">move string from offset X to offset Y</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">read byte from offset X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">write character to offset Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">decrement loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not done yet) then branch (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back)</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">store end of moved string(s)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempWorkspaceE6</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">get back key number</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">adjust the offset to each KEY now we have moved one</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$10</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">point at top of last string</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get this value</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">compare it with start of new or re</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">defined key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (less) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (equal) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">shift key definitions accordingly</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">store new offset to KEY X</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">point to next lowest string def</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (X=&gt;0) then branch (loop back and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">do it again)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeysCurrentEndOffset</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">make top of key definitions</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">the start of our key def</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get new end of strings</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeysCurrentEndOffset</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">and store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put A in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyConsistencyFlag</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">reset consistency flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

</pre>
<p class="commentary firstcommentary"><a id="SP18" class="paragraph-anchor"></a><b>&#167;18. bufferAddressesHigh. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">bufferAddressesHigh</span><button class="popup" onclick="togglePopup('usagePopup21')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup21">Usage of <span class="code-font"><span class="ACME-function-syntax">bufferAddressesHigh</span></span>:<br/><a href="S-s14.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e435</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP17" class="function-link"><span class="ACME-function-syntax">keyboardInputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">keyboardInputBufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">0 = Keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBufferOffset</span></a><span class="ACME-plain-syntax">) </span><span class="ACME-comment-syntax">1 = tape/RS-423 Input</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423OutputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">rs423OutputBufferOffset</span></a><span class="ACME-plain-syntax">)     </span><span class="ACME-comment-syntax">2 = RS-423 output</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">printerBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">printerBufferOffset</span></a><span class="ACME-plain-syntax">)                   </span><span class="ACME-comment-syntax">3 = printer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel0Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel0BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">4 = sound channel 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel1Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel1BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">5 = sound channel 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel2Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel2BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">6 = sound channel 2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel3Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel3BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">7 = sound channel 3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &gt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">speechBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">speechBufferOffset</span></a><span class="ACME-plain-syntax">)                     </span><span class="ACME-comment-syntax">8 = speech</span>
</pre>
<p class="commentary firstcommentary"><a id="SP19" class="paragraph-anchor"></a><b>&#167;19. bufferAddressesLow. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">bufferAddressesLow</span><button class="popup" onclick="togglePopup('usagePopup22')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup22">Usage of <span class="code-font"><span class="ACME-function-syntax">bufferAddressesLow</span></span>:<br/><a href="S-s14.html#SP21">&#167;21</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e43e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP17" class="function-link"><span class="ACME-function-syntax">keyboardInputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">keyboardInputBufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">0 = Keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBufferOffset</span></a><span class="ACME-plain-syntax">) </span><span class="ACME-comment-syntax">1 = tape/RS-423 Input</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">tapeOrRS423OutputBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">rs423OutputBufferOffset</span></a><span class="ACME-plain-syntax">)     </span><span class="ACME-comment-syntax">2 = RS-423 output</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">printerBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">printerBufferOffset</span></a><span class="ACME-plain-syntax">)                   </span><span class="ACME-comment-syntax">3 = printer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel0Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel0BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">4 = sound channel 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel1Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel1BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">5 = sound channel 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel2Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel2BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">6 = sound channel 2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP20" class="function-link"><span class="ACME-function-syntax">soundChannel3Buffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel3BufferOffset</span></a><span class="ACME-plain-syntax">)       </span><span class="ACME-comment-syntax">7 = sound channel 3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> &lt;(.</span><a href="S-s2.html#SP21" class="function-link"><span class="ACME-function-syntax">speechBuffer</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">speechBufferOffset</span></a><span class="ACME-plain-syntax">)                     </span><span class="ACME-comment-syntax">8 = speech</span>
</pre>
<p class="commentary firstcommentary"><a id="SP20" class="paragraph-anchor"></a><b>&#167;20. emptyBufferStartOffset. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">emptyBufferStartOffset</span><button class="popup" onclick="togglePopup('usagePopup23')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup23">Usage of <span class="code-font"><span class="ACME-function-syntax">emptyBufferStartOffset</span></span>:<br/><a href="S-s14.html#SP24">&#167;24</a>, <a href="S-s14.html#SP28">&#167;28</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP11">&#167;11</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e447</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">keyboardInputBufferOffset</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">0 = Keyboard</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">tapeOrRS423InputBufferOffset</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">1 = tape/RS-423 Input</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">rs423OutputBufferOffset</span></a><span class="ACME-plain-syntax">                      </span><span class="ACME-comment-syntax">2 = RS-423 output</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">printerBufferOffset</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">3 = printer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel0BufferOffset</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">4 = sound channel 0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel1BufferOffset</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">5 = sound channel 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel2BufferOffset</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">6 = sound channel 2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">soundChannel3BufferOffset</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">7 = sound channel 3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!byte</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">speechBufferOffset</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">8 = speech</span>
</pre>
<p class="commentary firstcommentary"><a id="SP21" class="paragraph-anchor"></a><b>&#167;21. Get buffer address. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> For buffer numbers, see .</span><a href="S-s2.html#SP4" class="internal">bufferNumberKeyboard</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X=buffer number</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">getBufferAddress</span><button class="popup" onclick="togglePopup('usagePopup24')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup24">Usage of <span class="code-font"><span class="ACME-function-syntax">getBufferAddress</span></span>:<br/><a href="S-s14.html#SP24">&#167;24</a>, <a href="S-s14.html#SP28">&#167;28</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e450</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP19" class="function-link"><span class="ACME-function-syntax">bufferAddressesLow</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get buffer base address low</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP18" class="function-link"><span class="ACME-function-syntax">bufferAddressesHigh</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">get buffer base address high</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFB</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP22" class="paragraph-anchor"></a><b>&#167;22. OSBYTE 152 - Examine buffer status. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = buffer number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X preserved</span>
<span class="ACME-plain-syntax">       if buffer is empty C=1, Y is preserved</span>
<span class="ACME-plain-syntax">                     else C=0, Y is offset to next character in buffer at $FA/B</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte152EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup25')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup25">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte152EntryPoint</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP15">&#167;15</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP1">&#167;1</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP10">&#167;10</a>, <a href="S-s16.html#SP12">&#167;12</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e45b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s10.html#SP2" class="function-link"><span class="ACME-function-syntax">allBitsSet</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">set V flag (meaning examine buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP23" class="function-link"><span class="ACME-function-syntax">remJumper</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">ALWAYS branch (see .</span><a href="S-s14.html#SP24" class="internal">remEntryPoint</a>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">for default entry point)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP23" class="paragraph-anchor"></a><b>&#167;23. OSBYTE 145 - Get byte from buffer. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = buffer number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       X preserved</span>
<span class="ACME-plain-syntax">       Y = character extracted</span>
<span class="ACME-plain-syntax">       if buffer is empty C=1, else C=0</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte145EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup26')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup26">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte145EntryPoint</span></span>:<br/><a href="S-s14.html#SP34">&#167;34</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP10">&#167;10</a>, <a href="S-s11.html#SP15">&#167;15</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP3">&#167;3</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP15">&#167;15</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e460</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLV</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear V</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">remJumper</span><button class="popup" onclick="togglePopup('usagePopup27')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup27">Usage of <span class="code-font"><span class="ACME-function-syntax">remJumper</span></span>:<br/><a href="S-s14.html#SP22">&#167;22</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e461</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorREMV</span></a><span class="ACME-plain-syntax">)                                   </span><span class="ACME-comment-syntax">Jump via REMV. Default destination</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">is .remEntryPoint below</span>
</pre>
<p class="commentary firstcommentary"><a id="SP24" class="paragraph-anchor"></a><b>&#167;24. REMV - default entry point for remove from/examine buffer vector. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X = buffer number</span>
<span class="ACME-plain-syntax">       V = 1 if only examination is requested</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       Examination Only:   A = next byte to be removed</span>
<span class="ACME-plain-syntax">                           X preserved</span>
<span class="ACME-plain-syntax">                           Y = offset to next character in buffer at $FA/B</span>

<span class="ACME-plain-syntax">       Removal:            A undefined</span>
<span class="ACME-plain-syntax">                           X preserved</span>
<span class="ACME-plain-syntax">                           Y = value of the byte removed</span>

<span class="ACME-plain-syntax">       if buffer was already empty C=1</span>
<span class="ACME-plain-syntax">                              else C=0</span>

<span class="ACME-plain-syntax"> Used by: OSBYTE 152 - examine buffer status</span>
<span class="ACME-plain-syntax">      and OSBYTE 145 - get byte from buffer</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">remEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup28')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup28">Usage of <span class="code-font"><span class="ACME-function-syntax">remEntryPoint</span></span>:<br/><a href="S-s14.html#SP22">&#167;22</a>, <a href="S-s14.html#SP23">&#167;23</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e464</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferStartIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get output pointer for buffer X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferEndIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">compare to input pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP28" class="function-link"><span class="ACME-function-syntax">pullSetCarryAndExit</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (equal, i.e. buffer is empty)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y = buffer start position</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP21" class="function-link"><span class="ACME-function-syntax">getBufferAddress</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">and get buffer pointer into</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.tempStoreFA/B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">read byte from buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP24" class="function-link"><span class="ACME-function-syntax">pullClearCarryAndExit</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (V is set, i.e. only examination)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (exit with CARRY clear)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">OSBYTE 152 has been done</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">must be OSBYTE 145 so save byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (end of buffer not reached) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP20" class="function-link"><span class="ACME-function-syntax">emptyBufferStartOffset</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get pointer start from offset table</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferStartIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">set buffer output pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #2                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP24" class="function-link"><span class="ACME-function-syntax">recallAndExit</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (buffer is input; 0=keyboard or</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">1=RS-423 input) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferEndIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">for output buffers compare with</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">buffer start</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP24" class="function-link"><span class="ACME-function-syntax">recallAndExit</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (not the same, i.e. buffer is not</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">empty) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP5" class="function-link"><span class="ACME-function-syntax">eventOutputBufferBecomesEmpty</span></a><span class="ACME-plain-syntax">                 </span><span class="ACME-comment-syntax">buffer is empty so Y=0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP25" class="function-link"><span class="ACME-function-syntax">eventEntryPoint</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">and enter EVENT routine to signal</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">EVENT 0 - buffer becoming empty</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">recallAndExit</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e48f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back byte from buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put it in Y</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullClearCarryAndExit</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e491</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry to indicate success</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP25" class="paragraph-anchor"></a><b>&#167;25. Trigger an event. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Events</span>

<span class="ACME-plain-syntax"> Events are a slightly simpler way for users to use an interrupt. Events are disabled by</span>
<span class="ACME-plain-syntax"> default, but can be enabled via OSBYTE 14 (see .</span><a href="S-s15.html#SP14" class="internal">osbyte14EntryPoint</a><span class="ACME-plain-syntax">). Different event types</span>
<span class="ACME-plain-syntax"> can be individually enabled or disabled. For the list of different event types,</span>
<span class="ACME-plain-syntax"> see .</span><a href="S-s2.html#SP5" class="internal">eventOutputBufferBecomesEmpty</a><span class="ACME-plain-syntax">.</span>

<span class="ACME-plain-syntax"> Most events are generated from the default IRQ handling code. When a relevant interrupt</span>
<span class="ACME-plain-syntax"> happens .eventEntryPoint is called with the event type. If enabled, this calls the EVNTV</span>
<span class="ACME-plain-syntax"> vector with the event type in the accumulator. The default implementation of the EVNTV</span>
<span class="ACME-plain-syntax"> vector does nothing, but the user can intercept this vector and do their own processing.</span>

<span class="ACME-plain-syntax"> This provides a simpler (and more limited) interface to handling interrupts than</span>
<span class="ACME-plain-syntax"> intercepting the IRQ1 or IRQ2 vectors directly. Events can't override the default interrupt</span>
<span class="ACME-plain-syntax"> handling, but are executed in addition.</span>

<span class="ACME-plain-syntax"> As with regular interrupt code, event handling code must not enable interrupts, and should</span>
<span class="ACME-plain-syntax"> be brief (The Acorn User Guide suggests "one millisecond maximum", 2000 clock cycles,</span>
<span class="ACME-plain-syntax"> whereas the New Advanced User Guide suggests it should "not last for more than about 2ms").</span>

<span class="ACME-plain-syntax"> The user can generate their own events by calling .OSEVEN with A=9 (.eventUserEvent)</span>

<span class="ACME-plain-syntax"> (See NAUG Section 7, Page 119)</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = parameter to pass into EVENV vector in Y</span>
<span class="ACME-plain-syntax">       X = parameter to pass into EVENV vector in X</span>
<span class="ACME-plain-syntax">       Y = event type</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A is preserved.</span>
<span class="ACME-plain-syntax">       Flags are preserved except for carry:</span>
<span class="ACME-plain-syntax">       Carry clear indicates the event was called successfully because it was enabled.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">eventEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup29')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup29">Usage of <span class="code-font"><span class="ACME-function-syntax">eventEntryPoint</span></span>:<br/><a href="S-s14.html#SP24">&#167;24</a>, <a href="S-s14.html#SP26">&#167;26</a>, <a href="S-s14.html#SP28">&#167;28</a>, <a href="S-s14.html#SP31">&#167;31</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP9">&#167;9</a>, <a href="S-s11.html#SP13">&#167;13</a>, <a href="S-s11.html#SP16">&#167;16</a>, <a href="S-s11.html#SP17">&#167;17</a><br/>Chapter 24: OS entry points; Tube; FRED; JIM; SHEILA - <a href="S-s24.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e494</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">.tempStoreFA = A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">eventEnabledFlags</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get enable event flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP28" class="function-link"><span class="ACME-function-syntax">pullTwiceSetCarryAndExit</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">if (event is not enabled) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit with carry set)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y = event enabled flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">Y = original A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s17.html#SP27" class="function-link"><span class="ACME-function-syntax">eventJumper</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">call the EVENV vector</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry for success</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP26" class="paragraph-anchor"></a><b>&#167;26. generateEventAndPutByteIntoBuffer. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">generateEventAndPutByteIntoBuffer</span><button class="popup" onclick="togglePopup('usagePopup30')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup30">Usage of <span class="code-font"><span class="ACME-function-syntax">generateEventAndPutByteIntoBuffer</span></span>:<br/><a href="S-s14.html#SP31">&#167;31</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4a8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP5" class="function-link"><span class="ACME-function-syntax">eventCharacterEnteringInputBuffer</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">Y=2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP25" class="function-link"><span class="ACME-function-syntax">eventEntryPoint</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">send event</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP27" class="paragraph-anchor"></a><b>&#167;27. OSBYTE 138 - Put byte into buffer. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is buffer number</span>
<span class="ACME-plain-syntax">       Y is character to be written</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte138EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup31')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup31">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte138EntryPoint</span></span>:<br/><a href="S-s14.html#SP31">&#167;31</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4af</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">insJumper</span><button class="popup" onclick="togglePopup('usagePopup32')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup32">Usage of <span class="code-font"><span class="ACME-function-syntax">insJumper</span></span>:<br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP12">&#167;12</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP33">&#167;33</a>, <a href="S-s15.html#SP35">&#167;35</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4b0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorINSV</span></a><span class="ACME-plain-syntax">)                                   </span><span class="ACME-comment-syntax">jump to INSV</span>
</pre>
<p class="commentary firstcommentary"><a id="SP28" class="paragraph-anchor"></a><b>&#167;28. INSV - insert value into buffer - default handler. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A is value to write</span>
<span class="ACME-plain-syntax">       X is buffer number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A preserved</span>
<span class="ACME-plain-syntax">       X preserved</span>
<span class="ACME-plain-syntax">       C clear on success</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">insEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup33')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup33">Usage of <span class="code-font"><span class="ACME-function-syntax">insEntryPoint</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4b3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">disable interrupts</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferEndIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">get buffer input pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">increment Y to next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not reached the end index) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (skip forward)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP20" class="function-link"><span class="ACME-function-syntax">emptyBufferStartOffset</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">set back to the start index</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">put it in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferStartIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">compare it with input pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP28" class="function-link"><span class="ACME-function-syntax">insertIntoFullBuffer</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (buffer is full) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferEndIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">get buffer end in Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">bufferEndIndices</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">set new offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP21" class="function-link"><span class="ACME-function-syntax">getBufferAddress</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">and point .tempStoreFA/B at it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back value to write</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">tempStoreFA</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">write it in buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">pull flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry for success</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">insertIntoFullBuffer</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4d4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP28" class="function-link"><span class="ACME-function-syntax">pullSetCarryAndExit</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} if we are working on output buffer</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP5" class="function-link"><span class="ACME-function-syntax">eventInputBufferBecomesFull</span></a><span class="ACME-plain-syntax">                   </span><span class="ACME-comment-syntax">input buffer is full</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP25" class="function-link"><span class="ACME-function-syntax">eventEntryPoint</span></a><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">to service input buffer full event</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push A</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullTwiceSetCarryAndExit</span><button class="popup" onclick="togglePopup('usagePopup34')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup34">Usage of <span class="code-font"><span class="ACME-function-syntax">pullTwiceSetCarryAndExit</span></span>:<br/><a href="S-s14.html#SP25">&#167;25</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4df</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore A</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullSetCarryAndExit</span><button class="popup" onclick="togglePopup('usagePopup35')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup35">Usage of <span class="code-font"><span class="ACME-function-syntax">pullSetCarryAndExit</span></span>:<br/><a href="S-s14.html#SP24">&#167;24</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4e0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore flags</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP29" class="paragraph-anchor"></a><b>&#167;29. Check for a letter (A-Z or a-z). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = character to check</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       Preserves A</span>
<span class="ACME-plain-syntax">       Carry clear if character is an upper or lower case letter (A-Z or a-z)</span>
<span class="ACME-plain-syntax">       otherwise carry set</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">isLetter</span><button class="popup" onclick="togglePopup('usagePopup36')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup36">Usage of <span class="code-font"><span class="ACME-function-syntax">isLetter</span></span>:<br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP7">&#167;7</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP10">&#167;10</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP18">&#167;18</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4e3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$DF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">convert lower to upper case</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charA</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">compare with 'A'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP29" class="function-link"><span class="ACME-function-syntax">noLetter</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if (lower than 'A') then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(exit routine with carry set)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charZ</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">compare with 'Z' + 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP29" class="function-link"><span class="ACME-function-syntax">yesLetter</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (no larger than 'Z') then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(exit with carry clear)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">noLetter</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4ee</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">yesLetter</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4ef</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore original value of A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-comment-syntax">[ Alternatively this would use four fewer bytes...</span>
<span class="ACME-comment-syntax">.isLetter</span>
<span class="ACME-comment-syntax">   PHA                                                ; Save A</span>
<span class="ACME-comment-syntax">   AND #$DF                                           ; convert lower to upper case</span>
<span class="ACME-comment-syntax">   SEC                                                ;</span>
<span class="ACME-comment-syntax">   SBC #.charA                                        ; 'A'-'Z' maps to 0-25</span>
<span class="ACME-comment-syntax">   CMP #26                                            ; check if in range 0-25</span>
<span class="ACME-comment-syntax">   PLA                                                ;</span>
<span class="ACME-comment-syntax">   RTS                                                ; ]</span>
</pre>
<p class="commentary firstcommentary"><a id="SP30" class="paragraph-anchor"></a><b>&#167;30. insertByteIntoKeyboardBuffer. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">insertByteIntoKeyboardBuffer</span><button class="popup" onclick="togglePopup('usagePopup37')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup37">Usage of <span class="code-font"><span class="ACME-function-syntax">insertByteIntoKeyboardBuffer</span></span>:<br/>Chapter 10: Resets - <a href="S-s10.html#SP17">&#167;17</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP10">&#167;10</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4f1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">X=0 to indicate keyboard buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP31" class="paragraph-anchor"></a><b>&#167;31. OSBYTE 153 - Put byte in input buffer. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is buffer number:</span>
<span class="ACME-plain-syntax">           1 is RS-423 input</span>
<span class="ACME-plain-syntax">           0 is Keyboard</span>
<span class="ACME-plain-syntax">       Y is character to be written</span>

<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       Carry clear</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">osbyte153EntryPoint</span><button class="popup" onclick="togglePopup('usagePopup38')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup38">Usage of <span class="code-font"><span class="ACME-function-syntax">osbyte153EntryPoint</span></span>:<br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP5">&#167;5</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e4f3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=buffer number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">rs423Mode</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">AND with RS-423 mode:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(0 = treat as keyboard;</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax"> 1 = ignore Escapes, no events, no</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">soft keys)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP27" class="function-link"><span class="ACME-function-syntax">osbyte138EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (RS-423 input buffer) AND (RS-423</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">in normal mode) then branch (enter</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">byte into buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=character to write</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">asciiCodeThatGeneratesESCAPEAction</span></a><span class="ACME-plain-syntax">             </span><span class="ACME-comment-syntax">compare with current escape ASCII</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">code (0=match)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">escapeAction</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">or with current ESCAPE status</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(0=ESC, 1=ASCII)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP26" class="function-link"><span class="ACME-function-syntax">generateEventAndPutByteIntoBuffer</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">if (not ESCAPE character) OR (ESCAPE</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">action says ASCII) then branch (to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">enter byte in buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">escapeAndBreakEffect</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get ESCAPE/BREAK effect byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Rotate to get ESCAPE bit into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get character back in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP31" class="function-link"><span class="ACME-function-syntax">exitWithCarryClear</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (escape effect disabled) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit with carry clear)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP5" class="function-link"><span class="ACME-function-syntax">eventESCAPEConditionDetected</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">signal event "Escape condition</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">detected"</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP25" class="function-link"><span class="ACME-function-syntax">eventEntryPoint</span></a><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP31" class="function-link"><span class="ACME-function-syntax">exitWithCarryClear</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (event handles ESCAPE) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (exit with carry clear)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP6" class="function-link"><span class="ACME-function-syntax">osbyte125EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">set ESCAPE flag</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exitWithCarryClear</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e513</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP32" class="paragraph-anchor"></a><b>&#167;32. Handle cursor, COPY and soft keys for non-zero cursor editing type. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       A = cursor editing type</span>
<span class="ACME-plain-syntax">           1 = return $87 - $8B (codes for COPY, LEFT, RIGHT, DOWN, UP)</span>
<span class="ACME-plain-syntax">           2 = use cursor keys as soft keys 11-15</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">handleCursorKeysAndCOPY</span><button class="popup" onclick="togglePopup('usagePopup39')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup39">Usage of <span class="code-font"><span class="ACME-function-syntax">handleCursorKeysAndCOPY</span></span>:<br/><a href="S-s14.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e515</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get bit 0 of cursor editing type</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">into carry</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">carry is set means cursor keys return codes $87-$8B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">carry  clear means cursor keys and COPY key are soft keys 11=COPY,12=LEFT,13=RIGHT,</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">                                                          14=DOWN,15=UP</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back character A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">exitWithCarryClear2</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (carry set) then branch (exit)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">cursor keys are 'soft'</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">handleFunctionKeyPress</span><button class="popup" onclick="togglePopup('usagePopup40')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup40">Usage of <span class="code-font"><span class="ACME-function-syntax">handleFunctionKeyPress</span></span>:<br/><a href="S-s14.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e519</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=Y get back original key code</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">($80-$FF)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">PUSH A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} shift high nybble down into low</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} nybble</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">A=$08 - $0F</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">invert bit 2</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$08 becomes $0C</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$09 becomes $0D</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0A becomes $0E</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0B becomes $0F</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0C becomes $08</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0D becomes $09</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0E becomes $0A</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0F becomes $0B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">functionAndCursorKeyCodes</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">8</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">read key interpretation</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Key interpretation:</span>
<span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">    0 = ignore key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">    1 = expand as 'soft' key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">2-$FF = add this to base for 'ASCII' code note that provision is made for keypad</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">operation as codes $C0-$FF cannot be generated from keyboard but are recognised</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">by OS</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">is it 1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP35" class="function-link"><span class="ACME-function-syntax">expandSoftKey</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (expand as 'soft' key required)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch (expand as 'soft' key)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back original byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">readFromInputBufferX</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (zero, i.e. ignore key) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">add base value to get 'ASCII' code</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$0F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">add ASCII to BASE key number so</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">clear high nybble</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">functionAndCursorKeyCodes</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">8</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">add ASCII base</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP33" class="paragraph-anchor"></a><b>&#167;33. errorOnReadingCharacterFromScreen. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">errorOnReadingCharacterFromScreen</span><button class="popup" onclick="togglePopup('usagePopup41')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup41">Usage of <span class="code-font"><span class="ACME-function-syntax">errorOnReadingCharacterFromScreen</span></span>:<br/><a href="S-s14.html#SP36">&#167;36</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e534</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP33" class="function-link"><span class="ACME-function-syntax">vdu7EntryPoint</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">produce bell</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A, buffer number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=buffer number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP34" class="paragraph-anchor"></a><b>&#167;34. Read from input buffer X (0 = keyboard; 1 = RS-423). </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readFromInputBufferX</span><button class="popup" onclick="togglePopup('usagePopup42')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup42">Usage of <span class="code-font"><span class="ACME-function-syntax">readFromInputBufferX</span></span>:<br/><a href="S-s14.html#SP32">&#167;32</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e539</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP23" class="function-link"><span class="ACME-function-syntax">osbyte145EntryPoint</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get byte from buffer X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">exit21</span></a><span class="ACME-plain-syntax">                                         </span><span class="ACME-comment-syntax">if (buffer is empty) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(return)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push byte received</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">bufferNumberRS423Input</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">check for RS-423 Input buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not RS-423 input buffer) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s13.html#SP4" class="function-link"><span class="ACME-function-syntax">setRS423Active</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP4" class="function-link"><span class="ACME-function-syntax">bufferNumberRS423Input</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">X=RS-423 input buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">set carry</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back original byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (carry clear, i.e. X=0, the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">keyboard buffer) then branch forward</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">rs423Mode</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">Y=RS-423 mode</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  0 means treat RS-423 input same as</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">keyboard</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">  1 means ESCAPE is ignored; soft</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">keys are not expanded; no events are</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">triggered</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">exitWithCarryClear2</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (normal RS-423 mode) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(exit)</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=original character to add to buffer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">exitWithCarryClear2</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (code is less than $80) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch (it's simple, so exit)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">%00001111</span><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">clear high nybble</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #11                                             </span><span class="ACME-comment-syntax">compare with 11</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP32" class="function-link"><span class="ACME-function-syntax">handleFunctionKeyPress</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (less than 11, i.e. function key)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$7B</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">add $7C ($7B+Carry) to convert codes</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">$0B-$0F to $87-$8B</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">cursorEditingType</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get cursor editing type</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP32" class="function-link"><span class="ACME-function-syntax">handleCursorKeysAndCOPY</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">if (standard cursor key editing is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">disabled) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">characterDestinationsAvailableFlags</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">get character destination status</span>

<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 0 - enable RS-423 driver</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 1 - disable VDU driver</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 2 - disable printer driver</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 3 - enable printer, independent</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of CTRL-B/C</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 4 - disable SPOOLed output</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 5 - not used</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 6 - disable printer driver</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(unless preceded by VDU 1)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bit 7 - not used</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get bit 1 into carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">readFromInputBufferX</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (carry is set, i.e. VDU disabled)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> #.</span><a href="S-s2.html#SP2" class="function-link"><span class="ACME-function-syntax">charCOPY</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">check for COPY key</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP36" class="function-link"><span class="ACME-function-syntax">handleCOPYkeyToReadCharacterFromScreen</span></a><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">if (COPY key pressed) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(handle COPY key)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP7" class="function-link"><span class="ACME-function-syntax">splitIntoTwoCursors</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">Split into the WRITE and READ cursors</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readFromEconetOrSoftKeyOrInputBufferA</span><button class="popup" onclick="togglePopup('usagePopup43')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup43">Usage of <span class="code-font"><span class="ACME-function-syntax">readFromEconetOrSoftKeyOrInputBufferA</span></span>:<br/><a href="S-s14.html#SP35">&#167;35</a><br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e577</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">econetReadCharacterInterceptionFlag</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">check Econet RDCH flag</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">readFromSoftKeyOrInputBufferA</span></a><span class="ACME-plain-syntax">                  </span><span class="ACME-comment-syntax">if (not set) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #6                                              </span><span class="ACME-comment-syntax">Econet function 6</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">netvJumper</span><button class="popup" onclick="togglePopup('usagePopup44')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup44">Usage of <span class="code-font"><span class="ACME-function-syntax">netvJumper</span></span>:<br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP1">&#167;1</a>, <a href="S-s13.html#SP9">&#167;9</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP22">&#167;22</a>, <a href="S-s15.html#SP45">&#167;45</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e57e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> (.</span><a href="S-s2.html#SP13" class="function-link"><span class="ACME-function-syntax">vectorNETV</span></a><span class="ACME-plain-syntax">)                                   </span><span class="ACME-comment-syntax">to the Econet vector</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">readFromSoftKeyOrInputBufferA</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e581</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyStringLength</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">get length of *KEY string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">readFromInputBufferX</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (no soft key) then branch (get a</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">character from the buffer)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyExpansionPointer</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get soft key expansion pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">get character from string</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyExpansionPointer</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">increment pointer</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyStringLength</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">decrement length</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exitWithCarryClear2</span><button class="popup" onclick="togglePopup('usagePopup45')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup45">Usage of <span class="code-font"><span class="ACME-function-syntax">exitWithCarryClear2</span></span>:<br/><a href="S-s14.html#SP32">&#167;32</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e592</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">exit21</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e593</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP35" class="paragraph-anchor"></a><b>&#167;35. Expand Soft Key (*KEY expansion). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       Y=pointer to string number</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">expandSoftKey</span><button class="popup" onclick="togglePopup('usagePopup46')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup46">Usage of <span class="code-font"><span class="ACME-function-syntax">expandSoftKey</span></span>:<br/><a href="S-s14.html#SP32">&#167;32</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e594</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore original code</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$0F</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">get low nybble (key string number)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP16" class="function-link"><span class="ACME-function-syntax">getStarKeyStringLength</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">get string length in A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyStringLength</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP22" class="function-link"><span class="ACME-function-syntax">softKeyPage</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">get start point</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP14" class="function-link"><span class="ACME-function-syntax">softKeyExpansionPointer</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">store it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP34" class="function-link"><span class="ACME-function-syntax">readFromEconetOrSoftKeyOrInputBufferA</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">ALWAYS branch (get byte and exit)</span>
</pre>
<p class="commentary firstcommentary"><a id="SP36" class="paragraph-anchor"></a><b>&#167;36. handleCOPYkeyToReadCharacterFromScreen. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">handleCOPYkeyToReadCharacterFromScreen</span><button class="popup" onclick="togglePopup('usagePopup47')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup47">Usage of <span class="code-font"><span class="ACME-function-syntax">handleCOPYkeyToReadCharacterFromScreen</span></span>:<br/><a href="S-s14.html#SP34">&#167;34</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $e5a6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s9.html#SP8" class="function-link"><span class="ACME-function-syntax">readCharacterFromScreenAndCursorRight</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">read a character from the screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">Y=A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP33" class="function-link"><span class="ACME-function-syntax">errorOnReadingCharacterFromScreen</span></a><span class="ACME-plain-syntax">              </span><span class="ACME-comment-syntax">if (A=0, i.e. not valid) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(beep)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">restore X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">and Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">clear carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s13.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresscurrent">14</li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s15.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

