<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 23: Extended vectors</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*CAT</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory-mapped i/o</a></li>
<li><a href="S-s4.html"><b>$C000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$C4C0</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$CB1D</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$CCF8</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$D060</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$D7C2</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$D940</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$DC1C</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$DEC5</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$E0A4</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$E20E</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$E5B3</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$EB03</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$EEDA</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$F135</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$F588</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$F8A9</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$FAE8</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$FC00</b>: chapter 22</a></li>
<li><span class="unlink"><b>$FF00</b>: chapter 23</span></li>
<li><a href="S-s24.html"><b>$FFA7</b>: chapter 24</a></li>
<li><a href="S-s25.html">appendix</a></li>
<li><a href="S-s26.html">index</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 23: Extended vectors' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">MOS 1.20</a></li><li><b>Chapter 23: Extended vectors</b></li></ul></div>
<p class="purpose">Extended vector entry points table; Extended vector handler - 167 bytes (1%)</p>

<ul class="toc"><li><a href="S-s23.html#SP1">&#167;1. Extended Vector Entry Points</a></li><li><a href="S-s23.html#SP2">&#167;2. extendedVectorEntryPoint</a></li><li><a href="S-s23.html#SP3">&#167;3. returnFromROM</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Extended Vector Entry Points. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> See NAUG Section 17.4.3 - Extended Vectors, Page 312</span>

<span class="ACME-plain-syntax"> There is a mechanism by which Paged ROMs can intercept the standard vectors at $0200</span>
<span class="ACME-plain-syntax"> upwards, instead getting them to point to a specific address *in a specified ROM*.</span>

<span class="ACME-plain-syntax"> To intercept vector N:</span>

<span class="ACME-plain-syntax">   - Disable interrupts during this change over</span>
<span class="ACME-plain-syntax">   - Get memory base address (call it V) using OSBYTE 168</span>
<span class="ACME-plain-syntax">           (V is address '.extendedVectorSpace' in this particular version of the ROM)</span>
<span class="ACME-plain-syntax">   - Store desired ROM address for routine at the two byte starting at V+3*N</span>
<span class="ACME-plain-syntax">   - Store desired ROM number in the following byte</span>
<span class="ACME-plain-syntax">   - Make a copy of the original contents of the vector at $0200+2*N if needed</span>
<span class="ACME-plain-syntax">   - Store the address '$FF00+3*N' in OS vector at '$0200+2*N'</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">extendedVectorTable</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ff00</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_USERV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_BRKV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_IRQ1V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_IRQ2V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_CLIV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_BYTEV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_WORDV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_WRCHV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_RDCHV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_FILEV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_ARGSV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_BGETV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_BPUTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_GBPBV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_FINDV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_FSCV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_EVENTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_UPTV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_NETV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_VDUV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_KEYV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_INSV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_REMV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_CNPV</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_IND1V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_IND2V</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s23.html#SP2" class="function-link"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">E_IND3V</span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. extendedVectorEntryPoint. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">extendedVectorEntryPoint</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">extendedVectorEntryPoint</span></span>:<br/><a href="S-s23.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ff51</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack - make space for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">currently selected ROM (address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'$109,X' in code below)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack - make space for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">return address low     (address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'$108,X' in code below)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack - make space for</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">return address high    (address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'$107,X' in code below)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack - make space for ROM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address low        (address '$106,X'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">in code below)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">save A on stack - make space for ROM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address high       (address '$105,X'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">in code below)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save Flags,A,X,Y to the stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TSX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get stack pointer into X</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&gt;(.</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">returnFromROM</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">1)                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">8</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #&lt;(.</span><a href="S-s23.html#SP3" class="function-link"><span class="ACME-function-syntax">returnFromROM</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">1)                            </span><span class="ACME-comment-syntax">} store return address in the stack</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} (the .returnFromROM routine below)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">7</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">10</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">Y=3*N+2 (low byte of caller address)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP24" class="function-link"><span class="ACME-function-syntax">extendedVectorSpace</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">2,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get low byte of action address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">5</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store it on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP24" class="function-link"><span class="ACME-function-syntax">extendedVectorSpace</span></a><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">get high byte of action address</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">6</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store it on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">get the current ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">9</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">store it on stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP24" class="function-link"><span class="ACME-function-syntax">extendedVectorSpace</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">get new ROM number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store RAM copy of current ROM</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Restore Y,X,A from stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTI</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">the RTI instruction restores the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">flags, and jumps to the (ROM)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">address we've put on the stack.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">i.e. this jumps to the ROM routine.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">When that returns, the address on</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the stack jumps us to the routine</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">below.</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. returnFromROM. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Return from ROM</span>

<span class="ACME-plain-syntax"> Once the ROM routine from above is finished, the return address takes us here, which restores</span>
<span class="ACME-plain-syntax"> the registers and returns to the proper calling routine.</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">returnFromROM</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">returnFromROM</span></span>:<br/><a href="S-s23.html#SP2">&#167;2</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ff89</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} save Flags,A,X to the stack</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TSX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">2</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">5</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">3</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">} store real return address onto</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} stack (ready for RTS)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP12" class="function-link"><span class="ACME-function-syntax">stackPage</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">6</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} recall X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall A - lose these 2 bytes. They</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">are the address of this routine.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall A - lose these 2 bytes. They</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">are the address of this routine.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A (original ROM number)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s2.html#SP11" class="function-link"><span class="ACME-function-syntax">currentlySelectedROM</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">store it as RAM copy of current ROM</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">number</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP9" class="function-link"><span class="ACME-function-syntax">romSelectRegister</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">switch the ROM into the memory map</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLP</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">get back flags</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">return</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">return</span></span>:<br/><a href="S-s23.html#SP2">&#167;2</a><br/>Chapter 2: Memory Layout and Constants - <a href="S-s2.html#SP11">&#167;11</a>, <a href="S-s2.html#SP14">&#167;14</a><br/>Chapter 5: VDU and OSWORD routines - <a href="S-s5.html#SP17">&#167;17</a>, <a href="S-s5.html#SP18">&#167;18</a>, <a href="S-s5.html#SP33">&#167;33</a>, <a href="S-s5.html#SP53">&#167;53</a><br/>Chapter 7: Graphics cursor and soft character definitions - <a href="S-s7.html#SP2">&#167;2</a>, <a href="S-s7.html#SP3">&#167;3</a>, <a href="S-s7.html#SP15">&#167;15</a>, <a href="S-s7.html#SP16">&#167;16</a>, <a href="S-s7.html#SP20">&#167;20</a>, <a href="S-s7.html#SP30">&#167;30</a><br/>Chapter 8: PLOT - <a href="S-s8.html#SP13">&#167;13</a>, <a href="S-s8.html#SP22">&#167;22</a>, <a href="S-s8.html#SP37">&#167;37</a>, <a href="S-s8.html#SP47">&#167;47</a>, <a href="S-s8.html#SP60">&#167;60</a>, <a href="S-s8.html#SP62">&#167;62</a><br/>Chapter 9: Cursor editing mode - <a href="S-s9.html#SP7">&#167;7</a>, <a href="S-s9.html#SP11">&#167;11</a><br/>Chapter 10: Resets - <a href="S-s10.html#SP1">&#167;1</a><br/>Chapter 11: Interrupt processing - <a href="S-s11.html#SP5">&#167;5</a>, <a href="S-s11.html#SP6">&#167;6</a>, <a href="S-s11.html#SP7">&#167;7</a>, <a href="S-s11.html#SP15">&#167;15</a>, <a href="S-s11.html#SP18">&#167;18</a>, <a href="S-s11.html#SP20">&#167;20</a><br/>Chapter 12: Command Line Interpreter (star commands) - <a href="S-s12.html#SP5">&#167;5</a>, <a href="S-s12.html#SP18">&#167;18</a><br/>Chapter 13: Writing characters; printer; buffers - <a href="S-s13.html#SP3">&#167;3</a>, <a href="S-s13.html#SP4">&#167;4</a>, <a href="S-s13.html#SP12">&#167;12</a><br/>Chapter 14: Star commands - <a href="S-s14.html#SP6">&#167;6</a>, <a href="S-s14.html#SP12">&#167;12</a>, <a href="S-s14.html#SP14">&#167;14</a>, <a href="S-s14.html#SP32">&#167;32</a>, <a href="S-s14.html#SP34">&#167;34</a><br/>Chapter 15: OSBYTE and OSWORD - <a href="S-s15.html#SP1">&#167;1</a>, <a href="S-s15.html#SP14">&#167;14</a>, <a href="S-s15.html#SP16">&#167;16</a>, <a href="S-s15.html#SP45">&#167;45</a>, <a href="S-s15.html#SP65">&#167;65</a>, <a href="S-s15.html#SP66">&#167;66</a>, <a href="S-s15.html#SP68">&#167;68</a><br/>Chapter 16: Sound and Speech - <a href="S-s16.html#SP6">&#167;6</a>, <a href="S-s16.html#SP26">&#167;26</a><br/>Chapter 17: Keyboard processing - <a href="S-s17.html#SP10">&#167;10</a>, <a href="S-s17.html#SP30">&#167;30</a><br/>Chapter 18: Tape and ROM Filing systems - <a href="S-s18.html#SP6">&#167;6</a>, <a href="S-s18.html#SP31">&#167;31</a>, <a href="S-s18.html#SP33">&#167;33</a><br/>Chapter 19: Low Level Tape Operations - <a href="S-s19.html#SP2">&#167;2</a>, <a href="S-s19.html#SP3">&#167;3</a>, <a href="S-s19.html#SP5">&#167;5</a><br/>Chapter 20: Filing System Messaging and Error Reporting - <a href="S-s20.html#SP2">&#167;2</a>, <a href="S-s20.html#SP3">&#167;3</a>, <a href="S-s20.html#SP5">&#167;5</a>, <a href="S-s20.html#SP8">&#167;8</a>, <a href="S-s20.html#SP17">&#167;17</a>, <a href="S-s20.html#SP21">&#167;21</a><br/>Chapter 21: More Low Level Tape Operations - <a href="S-s21.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $ffa6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">return (pulls real return address</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">from stack)</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s22.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresscurrent">23</li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progresssection"><a href="S-s26.html">26</a></li><li class="progressnext"><a href="S-s24.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

